/*
 * Copyright (C) 2009-2014 SAP SE or an SAP affiliate company. All rights reserved
 */
jQuery.sap.require("sap.ca.scfld.md.controller.BaseFullscreenController");jQuery.sap.require("cus.crm.myaccounts.util.formatter");sap.ca.scfld.md.controller.BaseFullscreenController.extend("cus.crm.myaccounts.view.S4Attachments",{onInit:function(){this.oRouter.attachRouteMatched(this.handleNavTo,this)},handleNavTo:function(e){if(e.getParameter("name")==="AccountAttachments"){var v=this.getView();var c=e.getParameter("arguments").contextPath;var m=this.getView().getModel();var p='/'+e.getParameter("arguments").contextPath;var a=new sap.ui.model.Context(m,'/'+e.getParameter("arguments").contextPath);var b=function(){v.setBindingContext(a)};m.createBindingContext(p,"",{expand:'Attachments'},b,true);var m=this.getView().getModel();var t=this;if(m instanceof sap.ui.model.odata.ODataModel){m.read(c+"/Attachments",null,null,true,function(d,r){var f=JSON.parse(JSON.stringify(d));var g={Attachments:[]};$.each(f.results,function(i,h){var o={name:h.name,size:h.fileSize,url:cus.crm.myaccounts.util.formatter.urlFormatter(h.__metadata.media_src),uploadedDate:h.createdAt,contributor:h.createdBy,fileExtension:cus.crm.myaccounts.util.formatter.mimeTypeFormatter(h.mimeType),fileId:h.documentId};g.Attachments.push(o)});t.byId('fileupload').setModel(new sap.ui.model.json.JSONModel(g))})}}},handleNavBack:function(e){window.history.back()},_refresh:function(c,e,d){var t=this;if(d&&d.context){this.getView().setBindingContext(d.context);var m=this.getView().getModel();if(m instanceof sap.ui.model.odata.ODataModel){m.read(d.context.getPath()+"/Attachments",null,null,true,function(D,r){var a=JSON.parse(JSON.stringify(D));var d={Attachments:[]};$.each(a.results,function(i,v){var o={name:v.name,size:v.fileSize,url:cus.crm.myaccounts.util.formatter.getRelativePathFromURL(v.__metadata.media_src),uploadedDate:cus.crm.mycontacts.formatter.ReleaseFormatter.dateFormatter(v.createdAt),contributor:v.createdBy,fileExtension:cus.crm.mycontacts.formatter.ReleaseFormatter.mimeTypeFormatter(v.mimeType),fileId:v.documentId};d.Attachments.push(o)});t.byId('fileupload').setModel(new sap.ui.model.json.JSONModel(d))})}}},});
