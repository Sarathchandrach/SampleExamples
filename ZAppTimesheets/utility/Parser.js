/*
 * Copyright (C) 2009-2014 SAP SE or an SAP affiliate company. All rights reserved
 */
jQuery.sap.declare("hcm.mgr.approve.timesheet.utility.Parser");jQuery.sap.require("sap.ca.ui.model.format.DateFormat");hcm.mgr.approve.timesheet.utility.Parser=(function(){if(!this.oApplication){this.oApplication=sap.ca.scfld.md.app.Application.getImpl()}var b=this.oApplication.getResourceBundle();var _=null;var a=null;return{setCachedData:function(d){_=d},getCachedData:function(d){return _},setControllerInstance:function(c){a=c},getControllerInstance:function(){return a},EmployeeData:function(m){var t=m;var E=[];if(t.length>0){var e={"EmpName":t[0].Empname,"Pernr":t[0].Pernr,"Posname":t[0].Posname,"Completion":"","NumberState":"","Weeks":[{"Weeknr":t[0].Weeknr,"Weekstart":t[0].Weekstart,"Weekend":t[0].Weekend,"Plannedhours":t[0].Plannedhours,"Actualhours":t[0].Actualhours,"Percentage":"","Overtime":"","Days":[{"Workdate":t[0].Workdate,"Conr":t[0].Conr,"Cotype":t[0].Cotype,"Codesc":t[0].Codesc,"Counter":t[0].Counter,"Catstype":t[0].Catstype,"Catsdesc":t[0].Catsdesc,"CatsText":t[0].CatsText,"Actualhours":t[0].Actualhours,"Plannedhours":t[0].Plannedhours,"TimeText":t[0].Awart,"Status":"A","Lstar":t[0].Lstar,"Lgart":t[0].Lgart,"RejectionReason":"","RejectionReasonText":"",}],}]};E.push(e);for(var c=1;c<t.length;c++){for(var i in E){if(E[i].Pernr===t[c].Pernr){var W=E[i].Weeks;for(var j in W){if(W[j].Weeknr===t[c].Weeknr){var D=E[i].Weeks[j].Days;var d=parseFloat(E[i].Weeks[j].Actualhours)+parseFloat(t[c].Actualhours);var p=parseFloat(E[i].Weeks[j].Plannedhours)+parseFloat(t[c].Plannedhours);E[i].Weeks[j].Actualhours=d;E[i].Weeks[j].Plannedhours=p;if(D.length===0){E[i].Weeks[j].Actualhours=0;E[i].Weeks[j].Plannedhours=0}var f={};f.Workdate=t[c].Workdate;f.Conr=t[c].Conr;f.Cotype=t[c].Cotype;f.Codesc=t[c].Codesc;f.Counter=t[c].Counter;f.Catstype=t[c].Catstype;f.Catsdesc=t[c].Catsdesc;f.CatsText=t[c].CatsText;f.Actualhours=t[c].Actualhours;f.Plannedhours=t[c].Plannedhours;f.TimeText=t[c].Awart;f.Lstar=t[c].Lstar;f.Lgart=t[c].Lgart;f.Status="A";f.RejectionReason="";f.RejectionReasonText="";E[i].Weeks[j].Days.push(f);break}else{var g=0;for(var k in W){if(W[k].Weeknr===t[c].Weeknr){g=1}}if(g===0){var w={};w.Weeknr=t[c].Weeknr;w.Weekstart=t[c].Weekstart;w.Weekend=t[c].Weekend;w.Plannedhours=t[c].Plannedhours;w.Actualhours=t[c].Actualhours;w.Weekstart=t[c].Weekstart;w.Percentage="";w.Overtime="";var f={};f.Workdate=t[c].Workdate;f.Cotype=t[c].Cotype;f.Codesc=t[c].Codesc;f.Catstype=t[c].Catstype;f.Catsdesc=t[c].Catsdesc;f.CatsText=t[c].CatsText;f.Counter=t[c].Counter;f.Actualhours=t[c].Actualhours;f.Plannedhours=t[c].Plannedhours;f.TimeText=t[c].Awart;f.Lstar=t[c].Lstar;f.Lgart=t[c].Lgart;f.Status="A";f.RejectionReason="";f.RejectionReasonText="";w.Days=[];w.Days.push(f);E[i].Weeks.push(w)}}}}else{var g=0;for(var h in E){if(E[h].Pernr===t[c].Pernr)g=1}if(g===0){var e={"EmpName":t[c].Empname,"Pernr":t[c].Pernr,"Posname":t[c].Posname,"Completion":"","Weeks":[{"Weeknr":t[c].Weeknr,"Weekstart":t[c].Weekstart,"Weekend":t[c].Weekend,"Actualhours":t[c].Actualhours,"Plannedhours":t[c].Plannedhours,"Percentage":"","Overtime":"","Days":[{"Workdate":t[c].Workdate,"Conr":t[c].Conr,"Cotype":t[c].Cotype,"Codesc":t[c].Codesc,"Counter":t[c].Counter,"Catstype":t[c].Catstype,"Catsdesc":t[c].Catsdesc,"CatsText":t[c].CatsText,"Actualhours":t[c].Actualhours,"Plannedhours":t[c].Plannedhours,"TimeText":t[c].Awart,"Lstar":t[c].Lstar,"Lgart":t[c].Lgart,"Status":"A","RejectionReason":"","RejectionReasonText":"",}]}]};E.push(e)}}}}}for(var l in E){var n=0;var o=0;var q=0;var M=E[l].Weeks;for(var i in M){o=(parseFloat(M[i].Actualhours)/parseFloat(M[i].Plannedhours))*100;var O=parseFloat(M[i].Actualhours)-parseFloat(M[i].Plannedhours);if(o>100)o=100;n=o+n;if(O>0){q=q+O;E[l].Weeks[i].Overtime=this.overtimeFormatter(O)+" "+b.getText("TSA_OVERTIME")}else{E[l].Weeks[i].Overtime=""}E[l].Weeks[i].Percentage=parseInt(o,0)+"%";E[l].Weeks[i].DayVisible=false;E[l].Weeks[i].DayVisibleText=b.getText("TSA_SHOW")}if(q>0){E[l].Overtime=this.overtimeFormatter(q)+" "+b.getText("TSA_OVERTIME")}else{E[l].Overtime=""}E[l].Completion=parseInt(n/E[l].Weeks.length,0)+"%";E[l].NumberState=(E[l].Completion==="100%")?sap.ui.core.ValueState.Success:sap.ui.core.ValueState.Error;var r=b.getText("TSA_WEEK");if(E[l].Weeks.length>1){r=b.getText("TSA_WEEKS")}E[l].No_Week=E[l].Weeks.length+" "+r}return E},CostAssignmentData:function(m){var t=m;var C=[];if(t.length>0){var c={"Conr":t[0].Conr,"Cotype":t[0].Cotype,"Codesc":t[0].Codesc,"No_People":"","Peoples":[{"EmpName":t[0].Empname,"Pernr":t[0].Pernr,"Posname":t[0].Posname,"Actualhours":t[0].Actualhours,"Plannedhours":t[0].Plannedhours,"Completion":"","Overtime":"","Days":[{"Workdate":t[0].Workdate,"Catstype":t[0].Catstype,"Catsdesc":t[0].Catsdesc,"CatsText":t[0].CatsText,"Counter":t[0].Counter,"Actualhours":t[0].Actualhours,"Plannedhours":t[0].Plannedhours,"TimeText":t[0].Awart,"Lstar":t[0].Lstar,"Lgart":t[0].Lgart,"Status":"A","RejectionReason":"","RejectionReasonText":"",}]}]};C.push(c);for(var d=1;d<t.length;d++){for(var i in C){if(C[i].Conr===t[d].Conr){var P=C[i].Peoples;for(var j in P){if(P[j].Pernr===t[d].Pernr){var D=C[i].Peoples[j].Days;if(D.length===0||D===undefined){C[i].Peoples[j].Actualhours=0;C[i].Peoples[j].Plannedhours=0}var e=parseFloat(C[i].Peoples[j].Actualhours)+parseFloat(t[d].Actualhours);var p=parseFloat(C[i].Peoples[j].Plannedhours)+parseFloat(t[d].Plannedhours);C[i].Peoples[j].Actualhours=e;C[i].Peoples[j].Plannedhours=p;var f={};f.Workdate=t[d].Workdate;f.Conr=t[d].Conr;f.Cotype=t[d].Cotype;f.Codesc=t[d].Codesc;f.Catstype=t[d].Catstype;f.Catsdesc=t[d].Catsdesc;f.CatsText=t[d].CatsText;f.Counter=t[d].Counter;f.Actualhours=t[d].Actualhours;f.Plannedhours=t[d].Plannedhours;f.TimeText=t[d].Awart;f.Lstar=t[d].Lstar;f.Lgart=t[d].Lgart;f.Status="A";f.RejectionReason="";f.RejectionReasonText="";C[i].Peoples[j].Days.push(f);break}else{var g=0;for(var k in P){if(P[k].Pernr===t[d].Pernr){g=1}}if(g===0){var h={};h.EmpName=t[d].Empname;h.Pernr=t[d].Pernr;h.Posname=t[d].Posname;h.Actualhours=t[d].Actualhours;h.Plannedhours=t[d].Plannedhours;h.Completion="";h.Overtime="";var f={};f.Workdate=t[d].Workdate;f.Conr=t[d].Conr;f.Cotype=t[d].Cotype;f.Codesc=t[d].Codesc;f.Catstype=t[d].Catstype;f.Catsdesc=t[d].Catsdesc;f.CatsText=t[d].CatsText;f.Counter=t[d].Counter;f.Actualhours=t[d].Actualhours;f.Plannedhours=t[d].Plannedhours;f.TimeText=t[d].Awart;f.Lstar=t[d].Lstar;f.Lgart=t[d].Lgart;f.Status="A";f.RejectionReason="";f.RejectionReasonText="";h.Days=[];h.Days.push(f);C[i].Peoples.push(h)}}}}else{var g=0;for(var l in C){if(C[l].Conr===t[d].Conr){g=1}}if(g===0){var c={"Conr":t[d].Conr,"Cotype":t[d].Cotype,"Codesc":t[d].Codesc,"No_People":"","Peoples":[{"EmpName":t[d].Empname,"Pernr":t[d].Pernr,"Posname":t[d].Posname,"Actualhours":t[d].Actualhours,"Plannedhours":t[d].Plannedhours,"Completion":"","Overtime":"","Days":[{"Workdate":t[d].Workdate,"Catstype":t[d].Catstype,"Catsdesc":t[d].Catsdesc,"CatsText":t[d].CatsText,"Counter":t[d].Counter,"Actualhours":t[d].Actualhours,"Plannedhours":t[d].Plannedhours,"TimeText":t[d].Awart,"Lstar":t[d].Lstar,"Lgart":t[d].Lgart,"Status":"A","RejectionReason":"","RejectionReasonText":"",}]}]};C.push(c)}}}}}for(var n in C){var o=0;var q=0;var r=0;var M=C[n].Peoples;for(var i in M){q=(parseFloat(M[i].Actualhours)/parseFloat(M[i].Plannedhours))*100;var O=parseFloat(M[i].Actualhours)-parseFloat(M[i].Plannedhours);if(q>100)q=100;o=q+o;if(O>0){r=r+O;C[n].Peoples[i].Overtime=this.overtimeFormatter(O)+" "+b.getText("TSA_OVERTIME")}else{C[n].Peoples[i].Overtime=""}C[n].Peoples[i].Completion=parseInt(q,0)+"%";C[n].Peoples[i].DayVisible=false;C[n].Peoples[i].DayVisibleText=b.getText("TSA_SHOW")}if(r>0){C[n].Overtime=this.overtimeFormatter(r)+" "+b.getText("TSA_OVERTIME")}else{C[n].Overtime=""}C[n].No_People=C[n].Peoples.length}return C},overtimeFormatter:function(c){var d=parseInt(c,0);var e=(c-d)*60;var h=b.getText("TSA_HOUR_SHORT");var m=b.getText("TSA_MIN_SHORT");return(d+h+" "+e+m)},parseDateWeek:function(s,e){var f=sap.ca.ui.model.format.DateFormat.getDateInstance({pattern:"YYYYMMdd"});return f.parse(s).toDateString().substring(4,16)+" - "+f.parse(e).toDateString().substring(4,16)},parseTimeDisplay:function(d){if(d!=undefined&&d!==""){var h=parseInt(d);var m=parseInt((d-h)*60);var c=b.getText("TSA_HOUR_SHORT");var e=b.getText("TSA_MIN_SHORT");return h+c+" "+m+e}else return""},parseDateDay:function(d){if(d!==undefined&&d!==null){var f=sap.ui.core.format.DateFormat.getDateInstance({pattern:"YYYYMMdd"});return f.parse(d).toDateString()}},projectCode:function(C,c){return C+" - "+c},projectTitle:function(c,d){return c+':'+d},statusToBoolean:function(s){return s=="A"?true:false},parseOverTime:function(d){if(d!==null&&d.length!==0){var v=d.split(" ");var m=b.getText("TSA_MIN_SHORT");return v[0]+" "+parseInt(v[1])+m+" "+v[2]}else{return d}}}}());
