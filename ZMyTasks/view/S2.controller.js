/*
 * Copyright (C) 2009-2014 SAP SE or an SAP affiliate company. All rights reserved
 */
jQuery.sap.require("sap.ca.scfld.md.controller.ScfldMasterController");sap.ca.scfld.md.controller.ScfldMasterController.extend("cus.crm.mytasks.view.S2",{_sSearchPattern:"",aLastFilters:undefined,aLastSorters:undefined,_bIsRefreshRequested:false,_timestampCompletedTask:undefined,accountID:undefined,accountName:undefined,scrollTo:undefined,scrollToCounter:0,scrollMax:false,SCROLL_TO_BOTTOM:-1,bIsFirstCallInTasksApp:false,oMHFOptions:{sI18NMasterTitle:"LIST_PAGE_TITLE_WITH_NUMBER"},oStatusDDLB:{bNotRetrieved:false,errorObj:null},onInit:function(){jQuery.sap.log.debug("BEGINN onInit s2");sap.ca.scfld.md.controller.ScfldMasterController.prototype.onInit.call(this);var c=new sap.ui.model.json.JSONModel({s2Controller:this,s3Controller:undefined,s4Controller:undefined});this.oApplicationFacade.setApplicationModel("controllers",c);var C=cus.crm.mytasks.util,v=this.getView(),m=v.getModel(),o=C.Schema;if(!o.getServiceVersion())o.initServiceSchemaVersion(m,"Task");this._getTechAndPrioListInfo(m);this.overrideDefineFooter();this.overrideCreateMasterPullToRefresh();this.overrideRefreshHandling();var a=sap.ui.component(sap.ui.core.Component.getOwnerIdFor(v)),r=jQuery.proxy(function(e){cus.crm.mytasks.util.Util.logObjectToConsole("Resize Event: ",e);if(e.size&&e.size.height!=0&&e.size.width!=0)this.fixDisplayOfDirectInput()},this),p=undefined;if(a&&a.getComponentData())p=a.getComponentData().startupParameters;this.oRouter.attachRouteMatched(jQuery.proxy(this.handleNavigationWithTaskList,this,p));this.resizeHandlerDeRegisterToken=sap.ui.core.ResizeHandler.register(this.getPage(),r);this.bIsFirstCallInTasksApp=true;jQuery.sap.log.debug("END onInit s2")},handleNavigationWithTaskList:function(p,e){var r=e.getParameter("name");switch(r){case"taskList":if(p){jQuery.sap.log.debug("startup parameters of CRM-MyTasks are "+JSON.stringify(p));if(p.processType)this.processType=p.processType.toString();if(p.accountID)this.accountID=p.accountID.toString()}if(this.bIsFirstCallInTasksApp){this.getView().getModel().attachRequestCompleted(this._onRequestCompleted,this).attachRequestSent(this._onRequestSent,this).attachRequestFailed(this._onRequestFailed,this);this.getList().attachUpdateFinished(this._onListUpdateFinished,this).attachUpdateStarted(this._onListUpdateStarted,this);this.setInitialFilters();this.bIsFirstCallInTasksApp=false}break;case"fullScreen":this.getList().attachUpdateFinished(this.scrollToPositionAfterUpdate,this);break}},onBeforeRendering:function(){},onAfterRendering:function(){jQuery.sap.log.debug("on after render s2");this.scrollToPosition();cus.crm.mytasks.util.Util.releaseBusyDialog()},onExit:function(){},isBackendSearch:function(){return true},getHeaderFooterOptions:function(){return this.oMHFOptions},applyBackendSearchPattern:function(f,b){this._sSearchPattern=f;this.handleFilter()},overrideCreateMasterPullToRefresh:function(){var m=this.oApplicationFacade.oApplicationImplementation.oMHFHelper;this.superCreatePTR=m.createMasterPullToRefresh;m.createMasterPullToRefresh=jQuery.proxy(this.injectPTRToScrollContainer,m)},injectPTRToScrollContainer:function(c,p){var s=c.byId("scroll");c.superCreatePTR.call(this,c,s)},overrideRefreshHandling:function(){var m=this.oApplicationFacade.oApplicationImplementation.oMHFHelper;m.handleMasterSearch=jQuery.proxy(this.injectRefreshList,m)},injectRefreshList:function(c,i){this.refreshList(c,false)},overrideDefineFooter:function(){var m=this.oApplicationFacade.oApplicationImplementation.oMHFHelper;m.defineFooter=jQuery.proxy(this.injectGenericSettingsButtonToMyTaskFooter,m)},onDataLoaded:function(){jQuery.sap.log.debug("dataload");var l=["cus.crm.mytasks.customizing","cus.crm.mytasks"];for(var i=-1,c;c=sap.ui.getCore().getModel(l[++i]);)cus.crm.mytasks.util.Util.logObjectToConsole("Model with name '"+l[i]+"': ",c,"info")},injectGenericSettingsButtonToMyTaskFooter:function(c,p){var b=c.byId("dummyFooter");c._oControlStore.oButtonListHelper.oBar=b;var C={};if(b){C=b.getContentLeft();b.removeAllContentLeft()}this.defineSettingsButton(c);for(var i=0;i<C.length;i++){var o=C[i];if(this.oApplicationImplementation.bIsPhone)b.addContentRight(o);else b.addContentLeft(o)}if(b){var p=c.byId("page");p.setFooter(b)}},_onListUpdateFinished:function(e){cus.crm.mytasks.util.Util.releaseBusyDialog();this.fixDisplayOfDirectInput()},_onListUpdateStarted:function(e){cus.crm.mytasks.util.Util.requestBusyDialog()},_onRequestCompleted:function(e){var c=cus.crm.mytasks.util,C=c.Util,o=c.Formatter,b=o.getResourceBundle(),l="Operation successful: Executing Task oData service.";C.logObjectToConsole(l,e.getSource());var n=this.getList().getBinding('items').getLength();jQuery.sap.log.debug("# objects="+n);this.oApplicationFacade.oApplicationImplementation.oMHFHelper.setMasterTitle(this,n);if(this.accountID){var i=cus.crm.myaccounts&&cus.crm.myaccounts.NavigationHelper&&cus.crm.myaccounts.NavigationHelper.qty;if(i&&cus.crm.myaccounts.NavigationHelper.qty>n){var p=[n,cus.crm.myaccounts.NavigationHelper.qty],m=b.getText("LIST_FILTERED_BY_MYITEMS",p);sap.m.MessageToast.show(m,{closeOnBrowserNavigation:false});cus.crm.myaccounts.NavigationHelper.qty=undefined}var t=e.getSource().oData,T=Object.getOwnPropertyNames(t);if(T&&T.length>0){this.accountName=t[T[0]].AccountName;var f=this.getView().byId("filterLabel");f.setText(b.getText("LIST_FILTER_BAR_ACCOUNT",this.accountName))}}C.releaseBusyDialog()},_onRequestSent:function(e){jQuery.sap.log.debug("Firing oData");cus.crm.mytasks.util.Util.requestBusyDialog()},_onRequestFailed:function(e){cus.crm.mytasks.util.Util.onRequestFailed(e,"Operation failed: Executing Task oData service.")},setInitialFilters:function(){jQuery.sap.log.debug("setInitialFilters");var s=this.getView().byId("filterSelect");s.setSelectedKey(this.getDefaultFilterKey());this.applyDefaultFilter()},refreshTaskList:function(){var l=this._timestampCompletedTask+1500;var a=new Date().getTime();if(l>a){var d=l-a;jQuery.sap.log.debug("Delay Refresh list by "+d+"ms: "+l+" > "+a);jQuery.sap.delayedCall(d,this,this.refreshTaskList)}else{jQuery.sap.log.debug("Execute Refresh list: "+l+" < "+a);this.rememberScrollPosition();this.getList().attachUpdateFinished(this.scrollToPositionAfterUpdate,this);this.getView().getModel().refresh();this._bIsRefreshRequested=false}},fixDisplayOfDirectInput:function(){var x=["scroll","taskInput","dummyFooter"],d=[];for(var i=-1,c;c=x[++i];)d.push(this.getJQueryElemtById(c));var s=d[0].offset().top,n=d[1].height(),w=$(window).height();var f=d[2]?d[2].height():48;var a=s+f;if(this.getView().byId(x[1]).getVisible())a+=n;var b=w-a;var v=[s,n,f,w];jQuery.sap.log.debug("Values for calculating size: "+v);this.getView().byId(x[0]).setHeight((b/16)+"rem");jQuery.sap.log.debug("Setting new Scroll box height: "+b+"px")},getJQueryElemtById:function(i){var e=this.getView().byId(i);if(!e)return undefined;var I=e.sId;return $("#"+I)},rememberScrollPosition:function(m){this.resetScrolling();var s=this.getView().byId("scroll").getScrollDelegate();this.scrollTo=m?s.getMaxScrollTop():s.getScrollTop();this.scrollMax=m;jQuery.sap.log.debug("scroll position: "+this.scrollTo)},scrollToPosition:function(){if((this.scrollTo&&this.scrollTo>0)||this.scrollMax){jQuery.sap.log.debug("scrollTo="+this.scrollTo+"; scrollMax="+this.scrollMax);this.ensureScrolling()}},scrollToPositionAfterUpdate:function(){if(sap.ui.Device.support.touch)this.byId("scroll").getContent()[0].hide();this.getList().detachUpdateFinished(this.scrollToPositionAfterUpdate,this);this.scrollToPosition()},ensureScrolling:function(){this.scrollToCounter++;var s=this.getView().byId("scroll"),S=s.getScrollDelegate(),m=S.getMaxScrollTop();if(this.scrollMax&&m>this.scrollTo)this.scrollTo=m;s.scrollTo(0,this.scrollTo,0);var o=S.getScrollTop(),i=this.scrollTo&&o!=this.scrollTo,I=this.scrollMax&&m<0,b=this.scrollToCounter<20;(I||i)&&b?jQuery.sap.delayedCall(250,this,this.ensureScrolling):this.resetScrolling()},resetScrolling:function(){this.scrollTo=undefined;this.scrollToCounter=0;this.scrollMax=false},markTaskCompleted:function(e){var l=e.getParameter("listItem");var c=l.getBindingContext().getObject();if(c.Completed)cus.crm.mytasks.util.Util.logObjectToConsole("Task is already completed: ",c);else{this._timestampCompletedTaskCompletedTask=new Date().getTime();jQuery.sap.log.debug("completed pressed:"+this._timestampCompletedTask);this._greyOutItem(l);this.rememberScrollPosition();this._completeSelectedTask(c,l);if(!this._bIsRefreshRequested){this._bIsRefreshRequested=true;jQuery.sap.delayedCall(1500,this,this.refreshTaskList)}}},_completeSelectedTask:function(t,l){var c=cus.crm.mytasks.util.Util;c.requestBusyDialog();t.Completed=true;c.logObjectToConsole("Mark Task as completed: ",t);var s=function(t,d,r,E){var C=cus.crm.mytasks.util,c=C.Util;if(E&&E.length>0)c.onRequestFailed(E[0],"Operation failed: Delete Task");else{var R=C.Formatter.getResourceBundle(),m=["'",t.Description,"'"].join(""),a=R.getText("LIST_COMPLETE_CONFIRMATION",[m]);c.logObjectToConsole("Operation successful: Complete Task",t);sap.ca.ui.message.showMessageToast(a);c.releaseBusyDialog()}},e=function(E){cus.crm.mytasks.util.Util.onRequestFailed(E,"Operation failed: Complete Task");this.getView().getModel().refresh()};c.saveTaskAndUpdateTaskList(false,t,l,jQuery.proxy(s,this,t),jQuery.proxy(e,this))},_greyOutItem:function(i){var b=sap.ui.core.theming.Parameters.get("sapUiExtraLightBG");i.$().css("background-color",b);var t=sap.ui.core.theming.Parameters.get("sapUiExtraLightText");i.$().find("span").css("color",t);i.$().find("span").css("opacity","0.8")},handleListItemPress:function(e){var c=cus.crm.mytasks.util.Util,l=e.getSource(),C=l.getBindingContext(),p=C.getPath(),t=C.getObject();c.requestBusyDialog();if(t.Completed)c.logObjectToConsole("No nav to completed Task: ",t);else{this.rememberScrollPosition();c.logObjectToConsole("Selected Task: ",t);this.oRouter.navTo("taskOverview",{contextPath:p.substr(1)})}},quickCreateTask:function(e){var c=cus.crm.mytasks.util,C=c.Util,o=c.Schema,v=this.getView();C.requestBusyDialog();v.byId("taskInput").setEnabled(false);this.rememberScrollPosition(true);this.setPartialLoad(false);var t={accountID:this.accountID,accountName:this.accountName,desc:e.getParameter("newValue"),},T=C.createEmptyTaskObject(o,t),v=this.getView(),s=function(d,r,a){var C=cus.crm.mytasks.util.Util;if(a&&a.length>0)C.onRequestFailed(a[0],"Operation failed: Quick Create Task");else{C.logObjectToConsole("Operation successful: Quick Create Task",d);C.releaseBusyDialog()}},E=function(a){cus.crm.mytasks.util.Util.onRequestFailed(a,"Operation failed: Quick Create Task")};v.byId("taskInput").setEnabled(false);this.getList().attachUpdateFinished(this.scrollToPositionAfterUpdate,this);C.saveTaskAndUpdateTaskList(true,T,v,jQuery.proxy(s,this),jQuery.proxy(E,this));v.byId("taskInput").setEnabled(true).setValue("")},getDefaultFilterKey:function(){if(this.extHookGetDefaultFilterKey)return this.extHookGetDefaultFilterKey();else return"open"},applyDefaultFilter:function(){if(this.extHookApplyDefaultFilter)this.extHookApplyDefaultFilter();else this.filterTasksOpen()},createDefaultFilters:function(){var d={SearchField:this._sSearchPattern.length>0?new sap.ui.model.Filter("Description",sap.ui.model.FilterOperator.EQ,this._sSearchPattern):null,Account:this.accountID?new sap.ui.model.Filter("AccountId",sap.ui.model.FilterOperator.EQ,this.accountID):null,MyTask:new sap.ui.model.Filter("MyTask",sap.ui.model.FilterOperator.EQ,true)},f=[];for(var p in d)if(d[p])f.push(d[p]);return f},handleFilter:function(){cus.crm.mytasks.util.Util.requestBusyDialog();this.setPartialLoad(true);var s=this.getView().byId("filterSelect");var a=s.getSelectedKey();jQuery.sap.log.debug("Selected Filter:"+a);this.resetScrolling();switch(a){case"open":jQuery.sap.log.debug("filter tasks open");this.filterTasksOpen();break;case"dueToday":jQuery.sap.log.debug("filter tasks due today");this.filterTasksToday();break;case"dueThisWeek":jQuery.sap.log.debug("filter tasks due this week");this.filterTasksThisWeek();break;case"completed":jQuery.sap.log.debug("filter tasks due this week");this.filterTasksCompleted();break;case this.getDefaultFilterKey():jQuery.sap.log.debug("default filter");this.applyDefaultFilter();break;default:jQuery.sap.log.debug("custom filter");if(this.extHookHandleCustomFilter)this.extHookHandleCustomFilter(a);break}},filterTasksOpen:function(){var s=[new sap.ui.model.Sorter("CreatedAt")];var f=this.createDefaultFilters();f.push(new sap.ui.model.Filter("Completed",sap.ui.model.FilterOperator.EQ,false));var r=this.handleAccountNameForDefaultFilter();this.setUiMode(true,true,true,r.title,r.filterBarLabel,r.aFilterBarLabelParams);this._applyFilters(f,s)},filterTasksCompleted:function(){var g=function(c){var d=c.getProperty("ChangedAt");var a=cus.crm.mytasks.util.Formatter.formatDate(d);return a};var s=[new sap.ui.model.Sorter("ChangedAt",true,g)];var f=this.createDefaultFilters();f.push(new sap.ui.model.Filter("Completed",sap.ui.model.FilterOperator.EQ,true));this.setUiMode(false,false,false,"LIST_FILTER_TITLE_COMPLETED","LIST_FILTER_BAR_COMPLETED");this._applyFilters(f,s)},filterTasksToday:function(e){var s=[new sap.ui.model.Sorter("DueDate")];var f=this.createDefaultFilters();f.push(new sap.ui.model.Filter("Completed",sap.ui.model.FilterOperator.EQ,false));var t=cus.crm.mytasks.util.Formatter.getCurrentDate();t=this.setToEndOfDay(t);f.push(new sap.ui.model.Filter("DueDate",sap.ui.model.FilterOperator.LE,t));this.setUiMode(true,false,false,"LIST_FILTER_TITLE_TODAY","LIST_FILTER_BAR_TODAY");this._applyFilters(f,s)},filterTasksThisWeek:function(e){var s=[new sap.ui.model.Sorter("DueDate")];var f=this.createDefaultFilters();f.push(new sap.ui.model.Filter("Completed",sap.ui.model.FilterOperator.EQ,false));var a=cus.crm.mytasks.util.Formatter.getDateEndOfTheWeek();a=this.setToEndOfDay(a);f.push(new sap.ui.model.Filter("DueDate",sap.ui.model.FilterOperator.LE,a));this.setUiMode(true,false,false,"LIST_FILTER_TITLE_THIS_WEEK","LIST_FILTER_BAR_THIS_WEEK");this._applyFilters(f,s)},_applyFilters:function(f,s){cus.crm.mytasks.util.Util.logObjectToConsole("Applying Filtering with Sorting: ",{filters:f,sorters:s});if(this._haveFiltersOrSortersChanged(f,s)){this.setPartialLoad(true);this.resetScrolling();var l=this.getList();if(!this.template)this.template=l.getItems()[0].clone();var t=this.template.clone();jQuery.sap.log.debug("creating new binding for task list");l.bindAggregation("items",{path:"/Tasks",template:t,sorter:s,filters:f,})}else{jQuery.sap.log.debug("refreshing existing task list");this.rememberScrollPosition();this.getList().attachUpdateFinished(this.scrollToPositionAfterUpdate,this);this.getView().getModel().refresh(true)}},handleAccountNameForDefaultFilter:function(){var r={title:"LIST_PAGE_TITLE_WITH_NUMBER",filterBarLabel:undefined,aFilterBarLabelParams:undefined,};if(this.accountID){r.filterBarLabel="LIST_FILTER_BAR_ACCOUNT";if(this.accountName)r.aFilterBarLabelParams=[this.accountName];else if(cus.crm.myaccounts&&cus.crm.myaccounts.NavigationHelper&&cus.crm.myaccounts.NavigationHelper.accountName){this.accountName=cus.crm.myaccounts.NavigationHelper.accountName;r.aFilterBarLabelParams=[this.accountName];cus.crm.myaccounts.NavigationHelper.accountName=undefined}else r.aFilterBarLabelParams=[this.accountID]}return r},_haveFiltersOrSortersChanged:function(f,s){if(!s)s=[];if(!f)f=[];var i;if(!this.aLastFilters||!this.aLastSorters){jQuery.sap.log.debug("initial call");i=true}else i=this._hasArrayChanged(this.aLastFilters,f)||this._hasArrayChanged(this.aLastSorters,s);this.aLastFilters=f;this.aLastSorters=s;jQuery.sap.log.debug("filters- or sorters changed: "+i);return i},_hasArrayChanged:function(l,a){var i=false;if(l.length!=a.length){i=true;cus.crm.mytasks.util.Util.logObjectToConsole("Arrays have different size ",[l,a])}else for(var b=0;b<a.length;b++){var e=a[b],L=l[b];if(JSON.stringify(L)!=JSON.stringify(e)){i=true;cus.crm.mytasks.util.Util.logObjectToConsole("Array Elements are different",[L,e]);break}}if(!i)cus.crm.mytasks.util.Util.logObjectToConsole("Arrays aren't different",[l,a]);return i},setUiMode:function(n,q,f,m,a,F){var l=this.getList(),v=this.getView(),o=v.byId("filterToolBar");if(n)l.setMode(sap.m.ListMode.MultiSelect);else l.setMode(sap.m.ListMode.None);v.byId("taskInput").setVisible(q);v.byId("showEmptyTask").setVisible(q);if(a){jQuery.sap.log.debug("show filter");o.setVisible(true);var b=cus.crm.mytasks.util.Formatter.getResourceBundle();v.byId("filterLabel").setText(b.getText(a,F))}else{jQuery.sap.log.debug("hide filter");o.setVisible(false)}if(f)v.byId("filterSelect").setSelectedKey(this.getDefaultFilterKey());this.oMHFOptions.sI18NMasterTitle=m},removeFilter:function(e){this.accountID=undefined;this.accountName=undefined;this.resetScrolling();this.applyDefaultFilter()},setToEndOfDay:function(d){d.setHours(23);d.setMinutes(59);return d},showEmptyTask:function(e){var c=cus.crm.mytasks.util,C=c.Schema,o=c.TechnicalInfoUtil;if(C.getServiceVersion()==1&&C.getServiceSchemaVersion()>=2){this.oActionSheet=sap.ui.xmlfragment("cus.crm.mytasks.view.ProcessTypeDialog",this);this.oActionSheet.setModel(this.getView().getModel("i18n"),"i18n");var d=null,j=new sap.ui.model.json.JSONModel(),m=this.getView().getModel(),s=function(D,r){d={ProcessTypes:r.data.results}},E=function(a){cus.crm.mytasks.util.Util.onRequestFailed(a,"Reading Transaction types failed")},p=C.getServiceSchemaVersion()>=4?"TransactionTypes":"TaskTransTypes";m.read(p,null,null,false,jQuery.proxy(s,this),jQuery.proxy(E,this));if(d.ProcessTypes.length==1){this.processType=d.ProcessTypes[0].ProcessTypeCode;this.processTypeDesc=d.ProcessTypes[0].Description;if(C.getServiceSchemaVersion()>=3)o.setPrivacyForSelectedTask(d.ProcessTypes[0].PrivateFlag);if(C.getServiceSchemaVersion()>=4)this.processTypePrio=d.ProcessTypes[0].Priority;this.selectProcess()}else this.oActionSheet.open();j.setData(d);this.oActionSheet.setModel(j,"json");this.oActionSheet._searchField.setPlaceholder(sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText("SEARCH"));this.oActionSheet._list.setGrowingScrollToLoad(true);this.oActionSheet._dialog.setVerticalScrolling(true)}else{if(!this.accountID)this.oRouter.navTo("newTask",{processType:"noProcType"});else this.oRouter.navTo("newTaskWithAccount",{processType:"noProcType",accountName:this.accountName})}},setPartialLoad:function(l){var L=this.getList();L.setGrowing(l)},selectProcess:function(e){var c=cus.crm.mytasks.util,C=c.Schema,o=c.TechnicalInfoUtil,a=c.Util;if(e){var s=e.getParameter("selectedItem");if(s){this.processType=s.data("ProcessTypeCode");this.processTypeDesc=s.data("ProcessTypeDescription");if(C.getServiceVersion()==1){if(C.getServiceSchemaVersion()>=3)o.setPrivacyForSelectedTask(s.data("PrivacyAllowed"));if(C.getServiceSchemaVersion()>=4)this.processTypePrio=s.data("Priority")}}}a.requestBusyDialog();this.setPartialLoad(false);this.rememberScrollPosition(true);var E=false;if(C.getServiceVersion()==1&&C.getServiceSchemaVersion()==3)E=this._getStatusValues(c);if(!E){if(!this.accountID)this.oRouter.navTo("newTask",{processType:this.processType});else this.oRouter.navTo("newTaskWithAccount",{processType:this.processType,accountName:this.accountName});a.releaseBusyDialog()}},searchProcess:function(e){var v=e.getParameter("value"),i=e.getParameter("itemsBinding"),f=[];if(v&&v!="")f.push(new sap.ui.model.Filter("Description",sap.ui.model.FilterOperator.Contains,v));i.aApplicationFilters=[];i.filter(f,sap.ui.model.FilterType.Application)},_getStatusValues:function(c){var C=c.StatusListUtil,o=c.Schema,a=c.Util,r=false;if(o.getServiceVersion()==1&&o.getServiceSchemaVersion()>=3){C.getStatusValues(this,{procType:this.processType,bIsNew:true});if(this.oStatusDDLB.bNotRetrieved){a.onRequestFailed(this.oStatusDDLB.errorObj,"Operation failed: Read status customizing.");this.oStatusDDLB.errorObj=null;this.oStatusDDLB.bNotRetrieved=false;r=true}}return r},_getTechAndPrioListInfo:function(m){var c=cus.crm.mytasks.util,C=c.Util,o=c.Schema;C.requestBusyDialog();var s=function(d,r,E){var c=cus.crm.mytasks.util;if(E&&E.length>0)c.Util.onRequestFailed(E[0],"Operation failed: Priority list and Technical Information");else{for(var i=-1,a;a=d.__batchResponses[++i];)switch(i){case 0:if(c.Schema.getServiceVersion()==1&&c.Schema.getServiceSchemaVersion()>=4)c.TechnicalInfoUtil.parseTechInfoOData({retrieveTaskTech:jQuery.extend({},a.data.results[0],true)});else c.TechnicalInfoUtil.parseTechInfoOData(a.data);break;case 1:c.PriorityListUtil.parsePrioListOData(a.data);break;case 2:c.StatusListUtil.setStatusValuesAgainstTransactionType(jQuery.extend([],a.data.results,true));break;default:break}c.Util.releaseBusyDialog()}},e=function(E){cus.crm.mytasks.util.Util.onRequestFailed(E,"Operation failed: Priority list and Technical Information")},p=o.getServiceVersion()==1&&o.getServiceSchemaVersion()>=4?["TechnicalDetails","UserPriorities","UserStatuses"]:["retrieveTaskTech","retrieveTaskPrioCustomizing"];C.getAllPrerequisites(m,p,{success:s,error:e,async:false});C.bindCustomizingModel(this.getView())}});
