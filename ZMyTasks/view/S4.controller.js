/*
 * Copyright (C) 2009-2014 SAP SE or an SAP affiliate company. All rights reserved
 */
jQuery.sap.require("sap.ca.scfld.md.controller.BaseFullscreenController");sap.ca.scfld.md.controller.BaseFullscreenController.extend("cus.crm.mytasks.view.S4",{navFromAccounts:false,_sETag:"",onInit:function(){jQuery.sap.log.debug("begin on init s4");sap.ca.scfld.md.controller.BaseFullscreenController.prototype.onInit.call(this);this._getApplicationModel().setProperty("/s4Controller",this);var c=cus.crm.mytasks.util,v=this.getView(),m=v.getModel();if(!c.Schema.getServiceVersion())c.Schema.initServiceSchemaVersion(m,"Task");this._checkIfPrerequisitesExist(v,c);var s=undefined,a=sap.ui.component(sap.ui.core.Component.getOwnerIdFor(this.getView()));if(a&&a.getComponentData())s=a.getComponentData().startupParameters;this.oRouter.attachRouteMatched(jQuery.proxy(this.handleNavigationWithTaskOverview,this,s));c.Util.logObjectToConsole("S4 View Model after init: ",m);jQuery.sap.log.debug("end on init s4")},onBeforeRendering:function(){jQuery.sap.log.debug("on before render s4")},onAfterRendering:function(){jQuery.sap.log.debug("on after render s4")},onExit:function(){jQuery.sap.log.debug("on exit s4")},handleNavigationWithTaskOverview:function(s,e){jQuery.sap.log.debug("on route matched s3");var c=cus.crm.mytasks.util,C=undefined,v=this.getView(),m=v.getModel(),o=c.Util,r=e.getParameter("name"),a=c.Schema,A=e.getParameter("arguments");switch(r){case"taskOverview":C=new sap.ui.model.Context(m,'/'+A.contextPath);v.setBindingContext(C);this.oOverviewTask=C.getObject();if(s&&s.fromAccount&&s.fromAccount[0])this.navFromAccounts=true;if(!this.oOverviewTask){jQuery.sap.log.debug("S4 page called via bookmark");this._getOverviewTask(false)}else{if(a.getServiceVersion()==1&&a.getServiceSchemaVersion()>=4){this._getRelatedInformationOfTask(C);this._sETag=this.oOverviewTask.Etag}this.initializeOverviewPage(this.oOverviewTask)}break;default:break}o.releaseBusyDialog()},getHeaderFooterOptions:function(){var m={sId:"error",sI18nBtnTxt:"DETAILS_FOOTER_BUTTON_MESSAGE",onBtnPressed:jQuery.proxy(this.showTaskErrors,this),},d={sId:"deleteTask",sI18nBtnTxt:"DETAILS_FOOTER_BUTTON_DELETE",onBtnPressed:jQuery.proxy(this.confirmDeleteTask,this)},f={sId:"followupOptions",sI18nBtnTxt:"DETAILS_BUTTONS_FOLLOWUP",onBtnPressed:jQuery.proxy(this.openFollowupActivity,this),},c=cus.crm.mytasks.util.Schema,o={oEditBtn:{sId:"editTask",sI18nBtnTxt:"S4_FOOTER_BUTTON_EDIT",onBtnPressed:jQuery.proxy(this.editTask,this),},buttonList:[d,f],bSuppressBookmarkButton:true,onBack:jQuery.proxy(this.navBackOverview,this)};if(!c.getServiceVersion())c.initServiceSchemaVersion(this.getView().getModel(),"Task");if(c.getServiceVersion()==1&&c.getServiceSchemaVersion()>=4)o.buttonList.splice(0,0,m);return o},_checkIfPrerequisitesExist:function(v,c){var C=c.Util.getCustomizingModel(),s=function(D,r,E){var c=cus.crm.mytasks.util;if(E&&E.length>0)c.Util.onRequestFailed(E[0],"Operation failed: Priority list and Technical Information");else{for(var i=-1,o;o=D.__batchResponses[++i];)switch(i){case 0:if(c.Schema.getServiceVersion()==1&&c.Schema.getServiceSchemaVersion()>=4)c.TechnicalInfoUtil.parseTechInfoOData({retrieveTaskTech:jQuery.extend({},o.data.results[0],true)});else c.TechnicalInfoUtil.parseTechInfoOData(o.data);break;case 1:c.PriorityListUtil.parsePrioListOData(o.data);break;case 2:c.StatusListUtil.setStatusValuesAgainstTransactionType(jQuery.extend([],o.data.results,true));break;case 3:this._sETag=o.data.Etag;break;default:break}c.Util.releaseBusyDialog()}},e=function(E){cus.crm.mytasks.util.Util.onRequestFailed(E,"Operation failed: Priority list and Technical Information")},p=[],d=sap.ushell.Container.getService("URLParsing").getHash(location).split("/");if(!C.getProperty("/techInfo")&&!C.getProperty("/prioList"))p=c.Schema.getServiceVersion()==1&&c.Schema.getServiceSchemaVersion()>=4?["TechnicalDetails","UserPriorities","UserStatuses",d[d.length-1]]:["retrieveTaskTech","retrieveTaskPrioCustomizing"];c.Util.getAllPrerequisites(this.getView().getModel(),p,{success:jQuery.proxy(s,this),error:e,async:false});c.Util.bindCustomizingModel(v)},initializeOverviewPage:function(t){var c=cus.crm.mytasks.util,C=c.Schema,v=this.getView();this._setFullScreenTitle(t);if(t.Note!==""){v.byId("notesS4").setVisible(true);v.byId("notesS4").setValue(t.Note)}else v.byId("notesS4").setVisible(false);v.byId("osStatus").setVisible(false);v.byId("oaTaskType").setVisible(false);v.byId("attachmentData").setVisible(false);if(C.getServiceVersion()==1&&C.getServiceSchemaVersion()>=3){v.byId("osStatus").setVisible(true);v.byId("oaTaskType").setVisible(true)}c.Attachments.OverviewPage.showOrHidePanel(v);c.DocumentHistory.showOrHidePanel(v)},navBackOverview:function(e){var s=this._getApplicationModel().getProperty("/s3Controller");if(s&&s.createdfromNotes){s.createdfromNotes=false;this._navBack()}else if(s&&s.bIsFollowupFromTasks){if(this.bIsBookmarkUsed)this.bIsBookmarkUsed=false;if(this.navFromAccounts){this.navFromAccounts=false;sap.ui.getCore().getEventBus().publish("cus.crm.mytasks","followUpTaskCreated")}s.bIsFollowupFromTasks=false;s.oParamsToPass=undefined;this._navBack()}else{if(s&&s.bIsFollowupFromOthers)s.bIsFollowupFromOthers=false;if(this.navFromAccounts){this.navFromAccounts=false;var c={contextPath:this.getView().getBindingContext().getPath()};sap.ui.getCore().getEventBus().publish("cus.crm.mytasks","taskChanged",c)}this._navBack()}},_setFullScreenTitle:function(t){var a=cus.crm.mytasks.util.Formatter.showTaskTitle(t.Description,t.Id);this._oControlStore.oTitle.setText(a)},_getApplicationModel:function(){var a=this.oApplicationFacade.getApplicationModel("controllers");if(!a){var m=new sap.ui.model.json.JSONModel({s2Controller:undefined,s3Controller:undefined,s4Controller:this,});this.oApplicationFacade.setApplicationModel("controllers",m);a=this.oApplicationFacade.getApplicationModel("controllers")}return a},_getRelatedInformationOfTask:function(c){var v=this.getView(),m=c?c.getModel():v.getModel(),s=function(E,d,R,a){if(a&&a.length>0)cus.crm.mytasks.util.Util.onRequestFailed(a[0],"Reading related information of tasks failed");else{var n=E.navlinks,o={};for(var i=-1,b;b=d.__batchResponses[++i];)o[n[i]]=b.data.results;this._bindRelatedInformationOfTask(o)}},e=function(E){cus.crm.mytasks.util.Util.onRequestFailed(E,"Reading related information of tasks failed")},C=cus.crm.mytasks.util,r=[],n=[C.Attachments.NAVLINK,C.DocumentHistory.NAVLINK,"TaskLogSet","TaskStatuses"];for(var i=0;i<n.length;i++)if(n[i])r.push([c.getPath(),n[i]].join("/"));v.byId("attachmentOverview").setBusy(true);v.byId("tabDocHistory").setBusy(true);C.Util.getAllPrerequisites(m,r,{success:jQuery.proxy(s,this,{navlinks:n,paths:r}),error:e,basync:true})},_bindRelatedInformationOfTask:function(f){var c=cus.crm.mytasks.util,p=undefined,v=this.getView(),C=c.Attachments,o=c.DocumentHistory;for(var P in f){p={bExpandCall:false,curResults:f[P]};switch(P){case C.NAVLINK:v.byId("attachmentOverview").setBusy(false);C.OverviewPage.bindData(this,p);break;case o.NAVLINK:v.byId("tabDocHistory").setBusy(false);o.bindDataToTable(this,p);break;case"TaskLogSet":this.bindTaskErrors(p);break;case"TaskStatuses":c.StatusListUtil.bindStatusValuesToTask(this.getView().getModel(),p);break;default:p={bExpandCall:false,curResults:f[P]};break}}},editTask:function(e){var c=cus.crm.mytasks.util.Util,v=this.getView(),p=v.getBindingContext().getPath();c.requestBusyDialog();this.oRouter.navTo("taskDetail",{contextPath:p.substr(1)},true)},showAccountOverview:function(e){var c=cus.crm.mytasks.util.Util,v=this.getView(),m=v.getModel(),C=v.getBindingContext().getObject(),p="/AccountCollection('"+C.AccountId+"')",P={"$expand":""},E=function(o){cus.crm.mytasks.util.Util.onRequestFailed(o,"Operation failed: Read data for business card. ")},s=function(d,r){cus.crm.mytasks.util.Util.logObjectToConsole("Operation successful: Read data for business card. ",d);this.openBusinessCardCompany(d,r)};P["$expand"]=this.extHookGetS4AccountPhoto?this.extHookGetS4AccountPhoto()?["MainAddress","MainContact/WorkAddress","Logo"].join(","):["MainAddress","MainContact/WorkAddress"].join(","):["MainAddress","MainContact/WorkAddress","Logo"].join(",");jQuery.sap.log.debug("oData request to be fired:"+p);c.requestBusyDialog();m.read(p,null,P,true,jQuery.proxy(s,this),jQuery.proxy(E,this))},openBusinessCardCompany:function(d,r){var c=cus.crm.mytasks.util,v=this.getView(),C=c.Util,a=c.AccountF4.getFilterString(),o=c.Formatter;C.logObjectToConsole("open Business card with this data: ",d);var A={},f=jQuery.proxy(function(E){var k=["'","'"].join(d.accountID);return{target:{semanticObject:"Account",action:["MyAccounts&/detail/AccountCollection(",")"].join(k)}}},this);A.title=o.getResourceBundle().getText("DETAILS_BCARD_ACCOUNT");A.imgurl=o.logoUrlFormatter(d.Logo);A.companyname=d[a];if(d.MainAddress){var m=d.MainAddress;A.companyphone=m.phone;A.companyaddress=m.address}if(d.MainContact){var M=d.MainContact,b=M.WorkAddress;A.maincontactname=M.fullName;if(b){A.maincontactphone=b.phone;A.maincontactmobile=b.mobilePhone;A.maincontactemail=b.email}}A.beforeExtNav=f;var e=new sap.ca.ui.quickoverview.CompanyLaunch(A),O=v.byId("oaAccount");e.openBy(O);C.releaseBusyDialog()},showContactOverview:function(e){var c=cus.crm.mytasks.util.Util,v=this.getView(),m=v.getModel(),C=v.getBindingContext().getObject(),p="/ContactCollection(contactID='"+C.ContactId+"',accountID='"+C.AccountId+"')",P={"$expand":""},E=function(o){cus.crm.mytasks.util.Util.onRequestFailed(o,"Operation failed: Read data for business card of Contact. ")},s=function(d,r){var o=cus.crm.mytasks.util;o.Util.logObjectToConsole("Operation successful: Read data for business card of Contact. ",d);if(d.accountID!==""&&d.contactID!=="")this.openBusinessCardContact(d,r);else{sap.m.MessageToast.show(o.Formatter.getResourceBundle().getText("S4_ACCOUNT_CONTACT_NOREL"));o.Util.releaseBusyDialog()}};P["$expand"]=this.extHookGetS4ContactPhoto?this.extHookGetS4ContactPhoto()?["WorkAddress","Photo"].join(","):"WorkAddress":["WorkAddress","Photo"].join(",");jQuery.sap.log.debug("oData request to be fired:"+p);c.requestBusyDialog();m.read(p,null,P,true,jQuery.proxy(s,this),jQuery.proxy(E,this))},openBusinessCardContact:function(d,r){var c=cus.crm.mytasks.util,C=c.Util,o=c.Formatter;var a={},f=jQuery.proxy(function(e){var k=[["accountID='","'"].join(d.accountID),["contactID='","'"].join(d.contactID)].join(",");return{target:{semanticObject:"ContactPerson",action:["MyContacts&/display/ContactCollection(",")"].join(k)}}},this);a.title=o.getResourceBundle().getText("DETAILS_BCARD_CONTACT");a.name=d.fullName;a.imgurl=o.photoUrlFormatter(d.Photo);a.department=d.department;a.companyname=d.company;if(d.WorkAddress){var w=d.WorkAddress;a.companyaddress=w.address;a.contactemail=w.email;a.contactphone=w.phone;a.contactmobile=w.mobilePhone}a.beforeExtNav=f;var b=new sap.ca.ui.quickoverview.EmployeeLaunch(a),O=this.getView().byId("oaContact");b.openBy(O);C.releaseBusyDialog()},confirmDeleteTask:function(e){var r=cus.crm.mytasks.util.Formatter.getResourceBundle();var c=jQuery.proxy(function(a){if(a===sap.m.MessageBox.Action.OK)this.deleteTask(a);else jQuery.sap.log.debug("delete task: cancelled")},this);var q=r.getText("DETAILS_MESSAGEBOX_TEXT"),o={icon:sap.m.MessageBox.Icon.QUESTION,title:r.getText("DETAILS_MESSAGEBOX_TITLE"),actions:[sap.m.MessageBox.Action.OK,sap.m.MessageBox.Action.CANCEL],onClose:c};sap.m.MessageBox.confirm(q,o)},deleteTask:function(a){var c=cus.crm.mytasks.util,C=c.Util;C.requestBusyDialog();var o=this.getView().getBindingContext(),t=o.getObject();if(c.Schema.getServiceVersion()==1&&c.Schema.getServiceSchemaVersion()>=4){var n=[c.Attachments.NAVLINK,c.DocumentHistory.NAVLINK,"TaskLogSet","TaskStatuses"];for(var i=-1,N;N=n[++i];)t[N]=C.getDeferredObject(o.getPath().substr(1),N)}C.logObjectToConsole("delete task: started",t);C.deleteTaskAndUpdateTaskList(t,this)},openFollowupActivity:function(e){if(!this._oFollowupAS){var c=cus.crm.mytasks.util,b=c.Formatter.getResourceBundle(),f=["S4_BUTTONS_FOLLOWUPTOTASK","S4_BUTTONS_FOLLOWUPTOOPPT","S4_BUTTONS_FOLLOWUPTOAPPT"],B=[];if(this.extHookAddAdditionalFollowupTypes){this.extHookAddAdditionalFollowupTypes(f)}for(var i=0,j=f.length;i<j;i++)B.push(new sap.m.Button({text:b.getText(f[i]),press:jQuery.proxy(this.createFollowUpObject,this)}));this._oFollowupAS=new sap.m.ActionSheet({placement:sap.m.PlacementType.Top,buttons:B})}this._oFollowupAS.openBy(e.getSource())},createFollowUpObject:function(e){var c=cus.crm.mytasks.util,C=c.Formatter,v=this.getView(),m=v.getModel(),p=undefined,b=e.getSource().getText(),o={curTask:v.getBindingContext().getObject(),followupType:b},B=C.getResourceBundle();c.Util.requestBusyDialog();switch(b){case B.getText("S4_BUTTONS_FOLLOWUPTOTASK"):p="TaskFollowupTransTypes";break;case B.getText("S4_BUTTONS_FOLLOWUPTOOPPT"):p="OpptFollowupTransTypes";break;case B.getText("S4_BUTTONS_FOLLOWUPTOAPPT"):p="AppFollowupTransTypes";break;default:if(this.extHookCreateFollowupObject)this.extHookCreateFollowupObject(e);break}if(p){var t=undefined,P={key:"",value:"",privateEnabled:"",},s=function(d,r){t=d.results;cus.crm.mytasks.util.Util.releaseBusyDialog()},E=function(o,d){var c=cus.crm.mytasks.util,f=c.Schema,r=c.Formatter.getResourceBundle(),M=["'",o.curTask.Description,"'"].join(""),F={sv:f.getServiceVersion(),ssv:f.getServiceSchemaVersion(),msg:r.getText("FOLLOWUP_ERROR_MSG",[M])};c.Util.onRequestFailed(d,"Operation Failed: Read Transaction Types for '"+o.followupType+"'.",F)},a={Guid:m.formatValue(o.curTask.Guid,C.EDM_GUID),TransactionType:m.formatValue(o.curTask.TransactionType,C.EDM_STRING)};m.read(p,null,a,false,jQuery.proxy(s,this),jQuery.proxy(E,this,o));if(!this._oDlFollowupTT){this._oDlFollowupTT=new sap.ui.xmlfragment("cus.crm.mytasks.view.FollowupDialog",this);this._oDlFollowupTT.setModel(v.getModel("i18n"),"i18n")}if(Array.isArray(t))if(t.length==1){P.key=t[0].ProcessTypeCode;P.value=t[0].Description;P.privateEnabled=t[0].PrivateFlag}else{this._oDlFollowupTT.setModel(new sap.ui.model.json.JSONModel(t),"FollowupTypes");this._oDlFollowupTT._sFollowupType=o.followupType;this._oDlFollowupTT.open()}if(P.key!=="")this._onSelectedFollowUpType(P,o)}else jQuery.sap.log.debug("## Incorrect way to perform a Follow up ##")},liveSearchFollowUpType:function(e){var v=e.getParameter("value");if(v.length==0||(v&&v.length>3))this._commonSearchForFollowUpType(v,[],e.getParameter("itemsBinding"))},searchFollowUpType:function(e){var v=e.getParameter("value");this._commonSearchForFollowUpType(v,[],e.getParameter("itemsBinding"))},_commonSearchForFollowUpType:function(v,f,i){if(v!=="")f.push(new sap.ui.model.Filter("Description",sap.ui.model.FilterOperator.Contains,v));i.aApplicationFilters=[];i.filter(f,sap.ui.model.FilterType.Application)},selectFollowUpType:function(e){var c=this.getView().getBindingContext(),C=c.getObject(),s=e.getParameter("selectedItem"),o={curTask:C,followupType:e.getSource()._sFollowupType},p={key:s.getDescription(),value:s.getTitle(),privateEnabled:s.data("PrivacyAllowed")};this._onSelectedFollowUpType(p,o)},_onSelectedFollowUpType:function(p,c){var b=cus.crm.mytasks.util.Formatter.getResourceBundle(),C=this.getView().getBindingContext(),s=["S4_BUTTONS_FOLLOWUPTOTASK","S4_BUTTONS_FOLLOWUPTOOPPT","S4_BUTTONS_FOLLOWUPTOAPPT"],a=[];for(var i=0;i<s.length;i++)a.push(b.getText(s[i]));switch(c.followupType){case a[0]:this.oParamsToPass={FUT:"X",AccountID:c.curTask.AccountId,AccountName:c.curTask.AccountName,Note:c.curTask.Note,ContactID:c.curTask.ContactId,ContactName:c.curTask.ContactName,priority:c.curTask.Priority,title:c.curTask.Description,taskId:c.curTask.Id,taskGuid:c.curTask.Guid,ProcessTypeDescription:p.value,privateFlag:p.privateEnabled,};this.oRouter.navTo("newTask",{processType:p.key});break;case a[1]:case a[2]:var S=undefined,A=undefined,d=undefined,P=undefined;if(c.followupType===a[1]){S="Opportunity";A="manageOpportunity";d=["&","followupfromtask",C.getPath().substr(1),p.key].join("/");P={FUO:"X",AccountID:c.curTask.AccountId,ContactID:c.curTask.ContactId,title:c.curTask.Description,taskId:c.curTask.Id,taskGuid:c.curTask.Guid,}}else{S="Appointment";A="myAppointments";d=["&","newappointmentfromtask",(new Date()).toJSON().split("T")[0].replace(/-/g,""),p.key].join("/");P={FUA:"X",AccountID:c.curTask.AccountId,ContactID:c.curTask.ContactId,title:c.curTask.Description,taskId:c.curTask.Id,taskGuid:c.curTask.Guid,}}var g=sap&&sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService&&sap.ushell.Container.getService("CrossApplicationNavigation");var l=g.hrefForExternal({target:{semanticObject:S,action:A},params:P,appSpecificRoute:d})||"";window.location=l;break}},_getOverviewTask:function(h){var c=cus.crm.mytasks.util,b,v=this.getView(),p,C=v.getBindingContext();if(h){jQuery.sap.log.debug("S4 page called again due to ETag mismatch");C.getModel().deleteCreatedEntry(C);p=null;b=function(C){if(C){this.getView().bindElement(C.getPath());this.oOverviewTask=C.getObject();this.initializeOverviewPage(this.oOverviewTask)}}}else{jQuery.sap.log.debug("S4 page called via bookmark");if(c.Schema.getServiceVersion()==1&&c.Schema.getServiceSchemaVersion()>=4){p={expand:[c.Attachments.NAVLINK,c.DocumentHistory.NAVLINK,"TaskLogSet","TaskStatuses"].join(",")};v.byId("attachmentOverview").setBusy(true);v.byId("tabDocHistory").setBusy(true)}else p=null;b=function(C){if(C){var o=c.Attachments,a=c.Schema,v=this.getView(),n=[],d=[],P=undefined,e=c.DocumentHistory;v.bindElement(C.getPath());this.oOverviewTask=C.getObject();if(a.getServiceVersion()==1&&a.getServiceSchemaVersion()>=4){n=[c.Attachments.NAVLINK,c.DocumentHistory.NAVLINK,"TaskLogSet","TaskStatuses"];if(this.oOverviewTask.Etag!==this._sETag){d=this.oOverviewTask.__metadata.etag.split("'");if(d.length>1){d.splice(1,1,this._sETag);this.oOverviewTask.Etag=this._sETag;this.oOverviewTask.__metadata.etag=d.join("'")}}this._sETag=""}for(var i=0;i<n.length;i++){P={bExpandCall:true,curResults:this.oOverviewTask[n[i]]["__list"]};switch(i){case 0:v.byId("attachmentOverview").setBusy(false);o.OverviewPage.bindData(this,P);break;case 1:v.byId("tabDocHistory").setBusy(false);e.bindDataToTable(this,P);break;case 2:this.bindTaskErrors(P);break;case 3:c.StatusListUtil.bindStatusValuesToTask(C.getModel(),P);break;default:break}}this.bIsBookmarkUsed=true;this.initializeOverviewPage(this.oOverviewTask)}}}C.getModel().createBindingContext(C.getPath(),null,p,jQuery.proxy(b,this),false)},_checkFor412StatusCode:function(e,l){var c=cus.crm.mytasks.util,b=c.Formatter.getResourceBundle();if(e.response.statusCode==="412"){jQuery.sap.log.debug("412 error occurred during"+l);var C=function(A){jQuery.sap.log.debug("S4 page called again due to ETag mismatch");var f=cus.crm.mytasks.util.Util;f.requestBusyDialog();this.oOverviewTask=undefined;this._getOverviewTask(true);f.releaseBusyDialog()},o={icon:sap.m.MessageBox.Icon.ERROR,title:b.getText("S3_412_TITLE"),actions:[sap.m.MessageBox.Action.OK],onClose:jQuery.proxy(C,this),};sap.m.MessageBox.show(b.getText("S3_412_ERRORMSG"),o);c.Util.releaseBusyDialog()}else{if(this.navFromAccounts||this.bIsBookmarkUsed){var d=sap.ushell.Container.getService("URLParsing").getHash(location).split("/"),v=this.getView(),a=new sap.ui.model.Context(v.getModel(),'/'+d[d.length-1]);v.setBindingContext(a)}c.Util.onRequestFailed(e,l)}},navToRelatedDocument:function(e){var n=false,d=this.getView().byId("tabDocHistory"),t=e.getSource().getText(),D=[],T=d.getModel("docHistory").getProperty("/transactions"),l="";for(var i=-1,c;c=T[++i];)if(c.ObjectId===t){if(c.bWithinApp)n=true;l=c.navToURL;break}if(n){D=l.split("/");this.oRouter.navTo(D[1],{contextPath:D[2]})}else window.location=l},showTaskErrors:function(e){this._oDlTaskErrors.open()},closeErrorMsg:function(e){this._oDlTaskErrors.close()},_addTaskErrorObject:function(t){var o={};jQuery.extend(o,t,true);switch(o.LogType){case"E":o.Icon="sap-icon://error";o.IconColor="red";break;case"W":o.Icon="sap-icon://warning";o.IconColor="orange";break;default:o.Icon="sap-icon://hint";o.IconColor="gray";break}return o},bindTaskErrors:function(p){if(p){var t={},m=this.getView().getModel();if(p.bExpandCall){t.paths=p.curResults||[];t.controlval=[];for(var i=-1,P;P=t.paths[++i];)t.controlval.push(this._addTaskErrorObject(m.getObject('/'+P)))}else{t.paths=[];t.controlval=[];var d=undefined,P=undefined;for(var i=-1,c;c=p.curResults[++i];){d=c.__metadata.id.split("/");t.controlval.push(this._addTaskErrorObject(c));P=d[d.length-1];t.paths.push(P)}}var j=new sap.ui.model.json.JSONModel({list:t.controlval}),T=cus.crm.mytasks.util.Formatter.getResourceBundle().getText("S4_MESSAGES_TITLE",[t.controlval.length]);this.setBtnEnabled("error",!(t.controlval.length===0));if(!this._oDlTaskErrors){this._oDlTaskErrors=new sap.ui.xmlfragment("cus.crm.mytasks.view.ErrorMessageDialog",this);this._oDlTaskErrors.setModel(this.getView().getModel("i18n"),"i18n");if(sap.ui.Device.system.desktop||sap.ui.Device.system.tablet)this._oDlTaskErrors.setContentWidth("30rem")}this._oDlTaskErrors.setModel(j,"TaskLogs");this._oDlTaskErrors.setTitle(T)}}});
