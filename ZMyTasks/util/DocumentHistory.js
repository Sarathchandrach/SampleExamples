/*
 * Copyright (C) 2009-2014 SAP SE or an SAP affiliate company. All rights reserved
 */
jQuery.sap.declare("cus.crm.mytasks.util.DocumentHistory");cus.crm.mytasks.util.DocumentHistory={NAVLINK:"DocumentHistory",aRelatedDocTypes:[{busType:"BUS2000125",bWithinApp:true,semanticObject:"Task",action:"manageTasks",appSpecificRoute:["&/taskOverview/Tasks(guid'","')"]},{busType:"BUS2000126",bWithinApp:false,semanticObject:"Appointment",action:"myAppointments",appSpecificRoute:["&/appointment/"]},{busType:"BUS2000111",bWithinApp:false,semanticObject:"Opportunity",action:"manageOpportunity",appSpecificRoute:["&/display/Opportunities(guid'","')"]},{busType:"BUS2000108",bWithinApp:false,semanticObject:"Lead",action:"manageLead",appSpecificRoute:["&/display/Leads(guid'","')"]}],showOrHidePanel:function(v){if(v){var c=cus.crm.mytasks.util.Schema,d=v.byId("transactionHistoryData");if(c.getServiceVersion()==1&&c.getServiceSchemaVersion()>=4){d.setVisible(true);if(d.setExpanded)d.setExpanded(false)}else d.setVisible(false)}},bindDataToTable:function(c,p){var t={},v=c.getView(),d=v.byId("tabDocHistory"),m=v.getModel(),C=cus.crm.mytasks.util.DocumentHistory;if(p.bExpandCall){t.paths=c.oOverviewTask[C.NAVLINK]["__list"]||[];t.controlval=[];for(var i=-1,P;P=t.paths[++i];)t.controlval.push(C.buildDocumentObject(m.getObject('/'+P)))}else t=C._addDataToODataModel(m,p.curResults);d.setModel(new sap.ui.model.json.JSONModel({transactions:t.controlval}),"docHistory")},_addDataToODataModel:function(m,t){var d=undefined,p=undefined;var D=[],r=[];for(var i=-1,c;c=t[++i];){d=c.__metadata.id.split("/");p=d[d.length-1];D.push(p);r.push(cus.crm.mytasks.util.DocumentHistory.buildDocumentObject(c));m.oData[p]=c}return{paths:D,controlval:r}},addOrModifyDocumentType:function(n){var d=cus.crm.mytasks.util.DocumentHistory.aRelatedDocTypes;if(n&&jQuery.type(n)==="object"){for(var p in n)if(!d[0][p])delete n[p];else if(typeof d[0][p]!==typeof n[p])delete n[p];if(n["busType"]&&Object.keys(n).length!==0&&Object.keys(n).length===Object.keys(d[0])){var I=-1;for(var i=0,j=d.length;i<j;i++)if(d[i]["busType"]===n["busType"]){I=i;break}if(I>-1)d[i]=n;else d.push(n)}else for(var i=0,j=d.length;i<j;i++)if(d[i]["busType"]===n["busType"]){for(var p in n)d[i][p]=n[p];break}}},buildDocumentObject:function(d){var o={CreatedAt:d.CreatedAt,Description:d.Description,Guid:d.Guid,ObjectId:d.ObjectId,ProcessType:d.ProcessType,ProcessTypeDescription:d.TransTypeDesc,RelType:d.Relationship,navToURL:"",enableLink:false},c=cus.crm.mytasks.util.DocumentHistory;for(var i=-1,C;C=c.aRelatedDocTypes[++i];){var a=undefined,t=[];if(C["busType"]===d.ObjectType){o.enableLink=true;o.bWithinApp=C.bWithinApp;if(C.appSpecificRoute.length===1)a=C.appSpecificRoute[0]+o.Guid;else{t=C.appSpecificRoute.slice(0);t.splice(1,0,o.Guid);a=t.join("")}o.navToURL="#"+[C.semanticObject,C.action].join("-")+a;break}}return o},};
