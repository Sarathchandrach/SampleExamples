/*
 * Copyright (C) 2009-2014 SAP SE or an SAP affiliate company. All rights reserved
 */
jQuery.sap.declare("cus.crm.mytasks.util.EmployeeF4");jQuery.sap.require("cus.crm.mytasks.util.Util");jQuery.sap.require("cus.crm.mytasks.util.AccountF4");cus.crm.mytasks.util.EmployeeF4={create:function(c){var C=cus.crm.mytasks.util,o=C.Formatter,a=C.Util,b=o.getResourceBundle(),t=b.getText("DETAILS_ASSIGNTO_ASIGNEE"),n=b.getText("SEARCH_LIST_NODATA_GENERIC"),e=this.getValueHelp(),s=jQuery.proxy(this._searchOnEmployees,this,this.getFilterString()),l=jQuery.proxy(this._liveSearchOnEmployees,this,this.getFilterString()),f=jQuery.proxy(this._confirmEmployee,this,c);e.setTitle(t);e.setNoDataText(n);e.setModel(a.getSearchModel());e.attachSearch(s);e.attachLiveChange(l);e.attachConfirm(f);a.logObjectToConsole("Employee F4 search model: ",e.getModel())},getId:function(){if(!this._employeeID)this._employeeID="";return this._employeeID},setId:function(v){this._employeeID=v;return this},getName:function(){if(!this._employeeName)this._employeeName="";return this._employeeName},setName:function(v){this._employeeName=v;return this},_getLIItem:function(){var l=new sap.m.StandardListItem({title:"{"+this.getFilterString()+"}",icon:"{path:'Photo', formatter:'cus.crm.mytasks.util.Formatter.photoUrlFormatter'}",description:"{Company/"+cus.crm.mytasks.util.AccountF4.getFilterString()+"}",active:true});return l},getListItemTemplate:function(){if(!this._oListItem)this._oListItem=this._getLIItem();return this._oListItem},getFilterString:function(){if(!this._sFilterString)this._sFilterString="fullName";return this._sFilterString},getValueHelp:function(){if(!this._oDialog)this._oDialog=new sap.m.SelectDialog();return this._oDialog},triggerSearch:function(v){var f=[],e=this.getValueHelp(),i=e.getBinding("items");if(v)f.push(new sap.ui.model.Filter(this.getFilterString(),sap.ui.model.FilterOperator.Contains,v));if(!i){var l={path:"/EmployeeCollection",parameters:{expand:'Company,Photo',select:'employeeID,firstName,lastName,fullName,Company/'+cus.crm.mytasks.util.AccountF4.getFilterString()+',Company/accountID,Photo'},template:this.getListItemTemplate(),filters:f};e.bindAggregation("items",l)}else{i.aApplicationFilters=[];i.filter(f,sap.ui.model.FilterType.Application)}},_liveSearchOnEmployees:function(a,e){jQuery.sap.log.debug("in do live search");var f=[],v=e.getParameter("value");if(v.length==0||(v&&v.length>3))this.__commonSearch(f,e.getParameter("itemsBinding"),a,v)},_searchOnEmployees:function(a,e){jQuery.sap.log.debug("in do search");var f=[],v=e.getParameter("value");this.__commonSearch(f,e.getParameter("itemsBinding"),a,v)},__commonSearch:function(f,i,a,v){if(v&&v!=="")f.push(new sap.ui.model.Filter(a,sap.ui.model.FilterOperator.Contains,v));if(!i){var l={path:"/EmployeeCollection",parameters:{expand:'Company,Photo',select:'employeeID,firstName,lastName,fullName,Company/'+cus.crm.mytasks.util.AccountF4.getFilterString()+',Company/accountID,Photo'},template:this.getListItemTemplate(),filters:f};this.getValueHelp().bindAggregation("items",l)}else{i.aApplicationFilters=[];i.filter(f,sap.ui.model.FilterType.Application)}},_confirmEmployee:function(c,e){var s=e.getParameter("selectedItem");if(s){var E=s.getBindingContext().getObject();this.setId(E.employeeID).setName(E[this.getFilterString()]);c._oDlAssignTask.getContent()[1].setValue(this.getName());jQuery.sap.log.debug("EmployeeId = "+this.getId());jQuery.sap.log.debug("EmployeeName = "+this.getName())}},};
