/*
 * Copyright (C) 2009-2014 SAP SE or an SAP affiliate company. All rights reserved
 */
jQuery.sap.declare("cus.crm.mytasks.util.StatusListUtil");jQuery.sap.require("cus.crm.mytasks.util.Util");cus.crm.mytasks.util.StatusListUtil={getStatusValues:function(c,t){var C=cus.crm.mytasks.util.Util;var s=function(d,r){var C=cus.crm.mytasks.util.Util,o=C.getCustomizingModel();C.logObjectToConsole("Operation successful: Read status customizing",d);o.setProperty("/statList",d.results);this.setInitialStatus(o)},e=function(o){if(!this.oStatusDDLB)this.oStatusDDLB={errorObj:null,bNotRetrieved:false};this.oStatusDDLB.errorObj=o;this.oStatusDDLB.bNotRetrieved=true},E=function(o){cus.crm.mytasks.util.Util.onRequestFailed(o,"Operation failed: Read status customizing.")},S=t.guid===undefined?"00000000-0000-0000-0000-000000000000":t.guid;this.readStatusForGivenTaskType(c.getView().getModel(),{procType:t.procType,guid:S},jQuery.proxy(s,this),t.bIsNew?jQuery.proxy(e,c):E);C.bindCustomizingModel(c.getView())},readStatusForGivenTaskType:function(m,p,s,e){jQuery.sap.log.debug("Reading status cust from BE");var c=cus.crm.mytasks.util.Formatter,P={Guid:m.formatValue(p.guid,c.EDM_GUID),TransactionType:m.formatValue(p.procType,c.EDM_STRING)};m.read("retrieveTaskStatus",null,P,false,s,e)},getInitialStatus:function(){var c=cus.crm.mytasks.util.Util,C=c.getCustomizingModel();var i={statID:C.getProperty("/initialStatus"),statText:C.getProperty("/initialStatusText")};return i},setInitialStatus:function(c){var a=c.getProperty("/statList");var i=this.parseInitialStatus(a);c.setProperty("/initialStatus",i&&i.statID);c.setProperty("/initialStatusText",i&&i.statText)},parseInitialStatus:function(s){var i=undefined;for(var a=0,j=s.length;a<j;a++){var c=s[a];if(c.InitialStatus===true||c.InitialStatus==="true"){i={statID:c.StatusID,statText:c.StatusTxt};break}}return i},setStatusValuesAgainstTransactionType:function(m){if(Array.isArray(m)&&m.length>0){var s={},c=cus.crm.mytasks.util.Util.getCustomizingModel();if(m[0]["TransactionType"]){m.sort(function(a,b){if(a.TransactionType>b.TransactionType)return 1;else if(a.TransactionType<b.TransactionType)return-1;return 0});for(var i=0,j=m.length;i<j;i++){var S=m[i];if(!s[S["TransactionType"]])s[S["TransactionType"]]=[S];else s[S["TransactionType"]].push(S)}c.setProperty("/masterStatusSet",s)}}},bindStatusValuesToTask:function(m,p){var t={},c=cus.crm.mytasks.util,C=c.Util.getCustomizingModel();if(!m)m=c.Schema.getModel();if(p){if(p.bExpandCall){t.paths=p.curResults||[];t.controlval=[];for(var i=-1,P;P=t.paths[++i];)t.controlval.push(m.getObject('/'+P))}else{t.paths=[];t.controlval=p.curResults||[];var d=undefined,P=undefined;for(var i=-1,o;o=t.controlval[++i];){d=o.__metadata.id.split("/");P=d[d.length-1];t.paths.push(P)}}C.setProperty("/statList",t.controlval)}},};
