/*
 * Copyright (C) 2009-2014 SAP SE or an SAP affiliate company. All rights reserved
 */
jQuery.sap.declare("cus.crm.mycontacts.util.Util");cus.crm.mycontacts.util.Util={setApplicationFacade:function(a){this.oApplicationFacade=a},geti18NResourceBundle:function(){if(this.oApplicationFacade){return this.oApplicationFacade.getResourceBundle()}else{return null}},geti18NText:function(k){if(this.geti18NResourceBundle()){return this.geti18NResourceBundle().getText(k)}else{return null}},readODataObjects:function(c,r,a){var C=c.getModel().getProperty(c.sPath);if(c.getModel().getProperty(c.sPath+"/"+r)){a(c.getModel().getProperty(c.sPath+"/"+r));return}var i=new sap.m.StandardListItem({text:""});var l=new sap.m.List({items:{path:r,template:i}});l.setModel(c.getModel());l.setBindingContext(c);var b=l.getBinding("items");var R=null;R=jQuery.proxy(function(d){b.detachDataReceived(R);l.destroy();a(d.getSource().aKeys)},this);b.attachDataReceived(R)},readODataObject:function(c,r,a){var C=c.getModel().getProperty(c.sPath);if(c.getModel().getProperty(c.sPath+"/"+r)){a(c.getModel().getProperty(c.sPath+"/"+r));return}var l=new sap.m.List();l.bindElement(c.sPath+"/"+r);l.setModel(c.getModel());l.setBindingContext(c);var b=l.getElementBinding();var R=null;R=jQuery.proxy(function(d){if(d.getSource().getBoundContext())C[r]={__ref:d.getSource().getBoundContext().sPath.substr(1)};else C[r]=null;b.detachDataReceived(R);l.destroy();a(c.getModel().getProperty(c.sPath+"/"+r));C[r]=null},this);b.attachDataReceived(R)},getRefreshUIObject:function(m,c,e){if(!this.refreshList)this.refreshList=new sap.m.List();else{this.refreshList.unbindElement();this.refreshList.setModel(null)}var l=this.refreshList;if(e)l.bindElement(c,{expand:e});else l.bindElement(c);l.setModel(m);var b=l.getElementBinding();var r={refresh:function(d){if(d)b.attachDataReceived(d);if(b)b.refresh()},destroy:function(){b=null},};return r},sendBatchReadOperations:function(m,r,c){m.clearBatch();for(var i in r){var R=m.createBatchOperation(r[i],"GET");m.addBatchReadOperations([R])}m.submitBatch(function(d){var e=null;var b=d.__batchResponses;var a={};for(var i=0;i<b.length;i++){if(b[i].statusCode=="200"){if(b[i].data.__metadata)a[b[i].data.__metadata.type]=b[i].data.results;else a[b[i].data[Object.keys(b[i].data)[0]][0].__metadata.type]=b[i].data[Object.keys(b[i].data)[0]]}else{var o=jQuery.parseJSON(b[i].response.body);e={type:sap.ca.ui.message.Type.ERROR,message:o.error.message.value,details:o.error.innererror.Error_Resolution.SAP_Note}}}if(e){sap.ca.ui.message.showMessageBox(e)}else{c(a)}},function(d){jQuery.sap.log.error("Read failed in Util.js->sendBatchReadOperations")},true)},sendBatchChangeOperations:function(m,b,c,a){m.clearBatch();m.addBatchChangeOperations(b);var t=this;m.submitBatch(jQuery.proxy(function(d){var e={};var B=d.__batchResponses;var r=null;for(var i=0;i<B.length;i++){if(B[i].response){e=jQuery.parseJSON(B[i].response.body).error;e.statusCode=B[i].response.statusCode;e.statusText=B[i].response.statusText}if(B[i].__changeResponses&&B[i].__changeResponses.length>0&&B[i].__changeResponses[0].statusCode==201){r=B[i].__changeResponses[0].data}}if(!e.message){if(c)c.call(t,r)}else{if(a)a.call(t,e);else sap.m.MessageBox.alert(e.message.value)}},this),true)},};
