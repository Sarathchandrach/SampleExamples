/*
 * Copyright (C) 2009-2014 SAP SE or an SAP affiliate company. All rights reserved
 */
jQuery.sap.require("sap.ca.scfld.md.controller.BaseFullscreenController");jQuery.sap.require("hcm.emp.mytimesheet.model.TimeEntry");jQuery.sap.require("hcm.emp.mytimesheet.utils.ConnectionHelper");jQuery.sap.require("sap.ca.ui.dialog.factory");jQuery.sap.require("sap.ca.ui.dialog.Dialog");jQuery.sap.require("sap.ca.ui.message.message");jQuery.sap.require("sap.ca.ui.model.format.DateFormat");jQuery.sap.require("hcm.emp.mytimesheet.utils.InitialConfigHelper");jQuery.sap.require("sap.ca.ui.model.type.Number");sap.ca.scfld.md.controller.BaseFullscreenController.extend("hcm.emp.mytimesheet.view.S3",{extHookReleaseEntriesSummary:null,extHookOnSubmit:null,extHookOnItemSelect:null,extHookUpdateData:null,extHookGetTimeSheetCalendar:null,extHookLoadList:null,extHookUpdatePageData:null,onInit:function(){sap.ca.scfld.md.controller.BaseFullscreenController.prototype.onInit.call(this);this.oApplication=this.oApplicationFacade.oApplicationImplementation;this.oConfiguration=new hcm.emp.mytimesheet.utils.InitialConfigHelper();this.oConnectionManager=this.oApplication.oConnectionManager;this.oBundle=this.oApplicationFacade.oApplicationImplementation.getResourceBundle();this.oConfiguration.setResourceBundle(this.oBundle);var s=this;var m=new sap.ui.model.json.JSONModel({phone:jQuery.device.is.phone});this.oApplication.setModel(m,"TSM_WEEKLY");if(!this.oService){this.oService=new hcm.emp.mytimesheet.Service()}var s=this;var m=this.oApplication.getModel("TSM_WEEKLY");this.oRouter.attachRouteMatched(function(e){if(e.getParameter("name")==="S3"){var c=e.getParameter("arguments").context;var a=parseInt(c[c.indexOf("offset")+6],10);var d=c.replace("offset","");d=d.slice(0,-1);var b=new Date(d);var g=new Date(b.getFullYear(),b.getMonth(),b.getDate()-s.getActualOffset(a,b.getDay()));var h=new Date(g.getFullYear(),g.getMonth(),g.getDate()+6);var o={startDate:s.getDateStr(g),endDate:s.getDateStr(h),month:b.getMonth(),date:b,dateStr:d,year:b.getFullYear(),};var l=o;s.oApplication.getModel('TSM_WEEKLY').setProperty("/firstDayOffset",a);m.setProperty("/showSubmit",false);m.setProperty("/selected",l.dateStr);m.setProperty("/year",l.year);m.setProperty("/week",l.week);m.setProperty("/start",l.startDate);m.setProperty("/end",l.endDate);s.lastSelected=l.dateStr;s.lastYear=l.year;s.lastWeek=l.week;s.lastStartDate=l.startDate;s.lastEndDate=l.endDate;var I=s.oApplication.getModel("timesheet_initialInfo");if(!I){s.oService.getInitialInfos(s,s.getDateStr(g),s.getDateStr(b),function(){var I=s.oApplication.getModel("timesheet_initialInfo");var r=I.getData().releaseAllowed;var i=I.getData().releaseFuture;s.checkboxList=[];m.setProperty("/releaseAllowed",r);m.setProperty("/releaseFuture",i);s.setBtnEnabled("SUBMIT_BTN",false);var j=I.getData().decimalTimeEntry;m.setProperty("/decimalTimeEntry",j);s.clockEntry=I.getData().clockEntry;m.setProperty("/clockEntry",s.clockEntry);s.oConfiguration.setInitialInfoModel(I)})}else{var r=I.getData().releaseAllowed;var i=I.getData().releaseFuture;s.checkboxList=[];m.setProperty("/releaseAllowed",r);m.setProperty("/releaseFuture",i);s.setBtnEnabled("SUBMIT_BTN",false);var j=I.getData().decimalTimeEntry;m.setProperty("/decimalTimeEntry",j);s.clockEntry=I.getData().clockEntry;m.setProperty("/clockEntry",s.clockEntry);s.oConfiguration.setInitialInfoModel(I)}s.updateData();s.getView().setModel(m);s.checkSubmit();s.onAfterRendering();s.setBtnText("deleteBtn",s.oApplicationFacade.getResourceBundle().getText("DELETE"));s.setBtnEnabled("deleteBtn",false);if(s.oApplication.getModel("timesheet_initialInfo").getData().releaseAllowed){s.setBtnText("SUBMIT_BTN",s.oApplicationFacade.getResourceBundle().getText("SUBMIT"));s.setBtnEnabled("SUBMIT_BTN",false)}this.checkboxList=[]}});this.getView().addEventDelegate({onBeforeShow:function(e){}});var p=this.byId("WEEKLY_PAGE");p.addEventDelegate({onAfterRendering:function(){}});if(!jQuery.device.is.phone){var f=this.byId("WEEKLY_FOOTER")}if(jQuery.device.is.tablet&&jQuery.device.is.portrait){this.byId("WEEKLY_PAGE").addStyleClass("sapTSM-TabletPortrait")}else{this.byId("WEEKLY_PAGE").removeStyleClass("sapTSM-TabletPortrait")}var S=new sap.ui.model.json.JSONModel();this.oApplication.setModel(S,"S31modelexch")},getActualOffset:function(f,c){var a=7;if(f>c){return c+a-f}else{return c-f}},parseDateYYYYMMdd:function(d){var a=sap.ui.core.format.DateFormat.getDateInstance({pattern:"YYYYMMdd"});return a.parse(d)},parseDateddMMYYYY:function(d){var a=sap.ui.core.format.DateFormat.getDateInstance({pattern:"dd-MM-YYYY"});return a.parse(d)},formatDateYYYYMMdd:function(d){if(typeof d==="string"){d=new Date(d)}var a=sap.ui.core.format.DateFormat.getDateInstance({pattern:"YYYYMMdd"});return a.format(d)},onAfterRendering:function(){var s=this},checkCanLeave:function(c,p){var a=true;var m=this.oApplication.getModel("TSM_WEEKLY");var d=m.getData().days;var t=this.byId("ENTRY_LIST_CONTENTS");var s=[];s=t.getSelectedItems();sap.ui.getCore().lock();c();setTimeout(function(){sap.ui.getCore().unlock()},500)},getPostData:function(d,e){var p={};p.day=d;p.entry=e;return p},releaseEntriesSummary:function(u){var t=this.byId("ENTRY_LIST_CONTENTS");var s=[];s=t.getSelectedItems();var d=0;var a=0;var b=0;var n;var c;var e;var f;var m=this.oApplication.getModel("TSM_WEEKLY");var p=m.getData();var r=m.getProperty("/releaseFuture");var g;var h;n=0;for(var i=0;i<s.length;i++){c=s[i].data().day;e=s[i].data().entry;f=p.days[c].entries[e];h=p.days[c].date;g=new Date();if(!f){continue}if(u){this.updatePageData(false,c,f,true)}if(!r&&(h>g)){}else if(f.statusId=='MSAVE'){jQuery.sap.log.info("Hours : "+f.hours);d+=f.hours;a+=f.minutes;b+=f.time;b=parseFloat(b.toFixed(2));jQuery.sap.log.info("Minutes : "+f.minutes);jQuery.sap.log.info("Decimal Time : "+f.time);n++}else if(f.statusId=="REJECTED"){d+=f.hours;a+=f.minutes;b+=f.time;b=parseFloat(b.toFixed(2));n++}if(a>59){a-=60;d++}}var j=[];if(this.isClockEntry()){b=d;b+=(a/60);b=parseFloat(b.toFixed(2))}j.push(n);j.push(d);j.push(a);j.push(b);return j;if(this.extHookReleaseEntriesSummary){this.extHookReleaseEntriesSummary()}},onSubmit:function(){var r=[];var s=null;r=this.releaseEntriesSummary(true);if(!this.clockEntry){var t=this.oBundle.getText('TOTAL_DURATION');if(t.indexOf('_')!=(-1)){t="Total Duration"}s={question:this.oBundle.getText('SUBMISSION_CONFIRMATION_SUMMARY'),additionalInformation:[{label:this.oBundle.getText('DELETE_CONFIRMATION_SUMMARY_ENTRIES'),text:r[0].toString()},{label:t,text:sap.ca.ui.model.format.NumberFormat.getInstance({style:'standard'}).format(r[3].toString())}],showNote:false,title:this.oConfiguration.getText("SUBMISSION_CONFIRMATION"),confirmButtonLabel:this.oBundle.getText("OK")}}else{s={question:this.oBundle.getText('SUBMISSION_CONFIRMATION_SUMMARY'),additionalInformation:[{label:this.oBundle.getText('DELETE_CONFIRMATION_SUMMARY_ENTRIES'),text:r[0].toString()},{label:this.oBundle.getText('DELETE_CONFIRMATION_SUMMARY_HOURS'),text:this.oBundle.getText('FULL_CONCATENATE_HOURSMIN',[r[1],r[2]])}],showNote:false,title:this.oConfiguration.getText("SUBMISSION_CONFIRMATION"),confirmButtonLabel:this.oBundle.getText("OK")}}var _=this;sap.ca.ui.dialog.factory.confirm(s,function(a){if(a.isConfirmed==true){_._submit()}});if(this.extHookOnSubmit){this.extHookOnSubmit()}},_submit:function(n,d,a){var m=this.oApplication.getModel("TSM_WEEKLY");var b=m.getData().days;this.errors=null;var c=[];var u=[];var e=[];var f=[];for(var i=0;i<b.length;i++){for(var j=0;j<b[i].entries.length;j++){if((b[i].entries[j].counter===null||b[i].entries[j].counter==="")&&!(b[i].entries[j].deleted)&&b[i].entries[j].mainItem!==null){c.push(this.getPostData(b[i].dateStr,b[i].entries[j]))}if(b[i].entries[j].deleted&&(b[i].entries[j].counter!==""||b[i].entries[j].counter===null)){e.push(this.getPostData(b[i].dateStr,b[i].entries[j]))}else{if(this.oldDays[i]){for(var k=0;k<this.oldDays[i].entries.length;k++){if(b[i].entries[j].counter===this.oldDays[i].entries[k].counter&&b[i].entries[j].counter!==""){var g=b[i].entries[j];var h=this.oldDays[i].entries[k];if(g.time!==h.time||g.notes!==h.notes||g.mainItem!==h.mainItem||g.subItems!==h.subItems||g.hours!==h.hours||g.minutes!==h.minutes||g.startTime!==h.startTime||g.endTime!==h.endTime){if(!b[i].entries[j].deleted){u.push(this.getPostData(b[i].dateStr,b[i].entries[j]))}}}}}}if(b[i].entries[j].statusId=="MSAVE"&&b[i].entries[j].bToBeReleased){f.push(this.getPostData(b[i].dateStr,b[i].entries[j]));u.push(this.getPostData(b[i].dateStr,b[i].entries[j]))}}}var s=this;var l=null;l=new sap.m.Dialog({title:this.oConfiguration.getText("DELETE_CONFIRMATION"),leftButton:new sap.m.Button({text:this.oBundle.getText("OK"),press:function(){l.close()}}),rightButton:new sap.m.Button({text:this.oConfiguration.getText("CANCEL"),press:function(){sap.ui.getCore().lock();l.close();setTimeout(function(){sap.ui.getCore().unlock()},500)}}),});sap.ui.getCore().lock();jQuery.sap.measure.start(hcm.emp.mytimesheet.utils.PerfUtils.getStartId(hcm.emp.mytimesheet.utils.PerfUtils.WEEK_ENTRY_SUBMIT));var o=[];var p=[];var q=[];if(c.length!==0){for(i=0;i<c.length;i++){c[i].entry=this.replaceSpecialChar(c[i].entry);p.push(s.setPostObject(c[i].entry.counter,"C",c[i].day,c[i].entry.time,c[i].entry.mainName,c[i].entry.mainCode,c[i].entry.notes,c[i].entry.startTime,c[i].entry.endTime,c[i].entry.subItems,c[i].entry.childCodes,c[i].entry.childNames))}}if(u.length!==0){for(i=0;i<u.length;i++){u[i].entry=this.replaceSpecialChar(u[i].entry);o.push(s.setPostObject(u[i].entry.counter,"U",u[i].day,u[i].entry.time,u[i].entry.mainName,u[i].entry.mainCode,u[i].entry.notes,u[i].entry.startTime,u[i].entry.endTime,u[i].entry.subItems,u[i].entry.childCodes,u[i].entry.childNames))}}if(e.length!==0){for(i=0;i<e.length;i++){e[i].entry=this.replaceSpecialChar(e[i].entry);q.push(s.setPostObject(e[i].entry.counter,"D",e[i].day,e[i].entry.time,e[i].entry.mainName,e[i].entry.mainCode,e[i].entry.notes,e[i].entry.startTime,e[i].entry.endTime,e[i].entry.subItems,e[i].entry.childCodes,e[i].entry.childNames))}}if(p.length===0&&o.length===0&&q.length===0){sap.ui.getCore().lock();l.close();setTimeout(function(){sap.ui.getCore().unlock()},500)}else{s.oService.submitTimeEntry(s,p,o,q,function(){sap.ui.getCore().unlock();jQuery.sap.measure.end(hcm.emp.mytimesheet.utils.PerfUtils.getEndId(hcm.emp.mytimesheet.utils.PerfUtils.WEEK_ENTRY_SUBMIT));sap.m.MessageToast.show(s.oConfiguration.getText("SUBMIT_SUCCESS"));sap.ui.getCore().lock();setTimeout(function(){if(!s.errors){s.updateData()}sap.ui.getCore().unlock()},500)},function(A,B){sap.ui.getCore().unlock();jQuery.sap.measure.end(hcm.emp.mytimesheet.utils.PerfUtils.getEndId(hcm.emp.mytimesheet.utils.PerfUtils.WEEK_ENTRY_SUBMIT));s.errors=A;s.displayInlineMessages(A,B);s.updateData()})}var r=[];var t=null;var v=m.getData().days;for(i=0;i<v.length;i++){for(var j=0;j<v[i].entries.length;j++){t=v[i].entries[j];if(!t.deleted){if(t.subItems===null){t.subItems=""}if(t.mainItem){var w=false;var x=-1;for(var k=0;k<r.length;k++){if(r[k].subItems===null){r[k].subItems=""}if(r[k].mainItem===t.mainItem){w=true;x=k}}if(!w){r.push({mainItem:t.mainItem,subItems:t.subItems,time:t.time,hours:parseFloat(t.hours),minutes:parseFloat(t.minutes)})}else{r[x].time+=t.time;r[x].hours+=parseFloat(t.hours);r[x].minutes+=parseFloat(t.minutes);if(r[x].minutes>59){r[x].minutes-=60;r[x].hours++}}}}}}var y=0;for(var z=0;z<v.length;z++){y=y+v[z].targetHours}},setPostObject:function(C,T,W,a,N,b,n,s,e,c,d,f){var t={Counter:C,TimeEntryOperation:T,TimeEntryDataFields:{WORKDATE:W,CATSAMOUNT:""+a,BEGUZ:s,ENDUZ:e}};if(T!="D")t.TimeEntryRelease="X";if(this.checkFieldName(N)===true){t.TimeEntryDataFields[N]=b}if(c&&c!==""){for(var i=0;i<f.length;i++){if(this.checkFieldName(f[i])===true){t.TimeEntryDataFields[f[i]]=d[i]}}}if(n&&n!==""){t.TimeEntryDataFields.LONGTEXT_DATA=n;t.TimeEntryDataFields.LONGTEXT="X"}return t},checkFieldName:function(f){var c=new String(f);if(c.match("DISPTEXT")){return false}if(c.match("CPR_OBJTEXT")){return false}if(c.match("CPR_TEXT")){return false}return true},replaceAllOccurances:function(s){if(typeof s=="undefined"){return}var S='/';var r='-';while(s.indexOf(S)>-1){s=s.replace(S,r)}return s},replaceSpecialChar:function(e){if(typeof e.mainName!="undefined"){e.mainName=this.replaceAllOccurances(e.mainName)}if(typeof e.subItems!="undefined"){e.subItems=this.replaceAllOccurances(e.subItems)}if(typeof e.childNames!="undefined"){for(var i=0;i<e.childNames.length;i++){e.childNames[i]=this.replaceAllOccurances(e.childNames[i])}}return e},onItemSelectGotoEdit:function(e){var a=e.getSource();var t=a.getParent();if(a instanceof sap.m.ColumnListItem){var c=a.getCustomData();var d=0,b=0;for(var i=0;i<c.length;i++){if(c[i].getKey()==="day"){d=c[i].getValue()}else if(c[i].getKey()==="entry"){b=c[i].getValue()}}var m=this.oApplication.getModel("TSM_WEEKLY");this.oApplication.getModel('S31modelexch').setProperty('/recentlyUsedSelected',false);this.oApplication.getModel('S31modelexch').setProperty('/manualEntrySelected',true);var p=m.getData();var v={entry:p.days[d].entries[b],pageData:p,dayIndex:d,entryIndex:b};this.oApplication.getModel('S31modelexch').setProperty('/editeddata',v);this.oApplication.getModel('S31modelexch').setProperty('/editentryview',true);this.oApplication.getModel('S31modelexch').setProperty('/viewDataS3',v);var s=(new Date(a.data().selectedDate.substr(0,4),parseInt(a.data().selectedDate.substr(4,2),10)-1,a.data().selectedDate.substr(6,2))+"").substr(0,15);var f=sap.ui.core.format.DateFormat.getDateInstance({pattern:"YYYYMMdd"});var s=f.parse(a.data().selectedDate);this.oApplication.getModel('S31modelexch').setProperty('/selectedDates',[s]);this.oRouter.navTo("S31",{},true)}},onItemSelect:function(e){this.selectDateOnAllCheckBoxSelection(e.getSource(),e.mParameters.listItem);this.manageChecklist(e.getSource().getItems(),"","","");if(e.getSource().getSelectedItems().length===0){this.setBtnText("deleteBtn",this.oApplicationFacade.getResourceBundle().getText("DELETE"));this.setBtnEnabled("deleteBtn",false);if(this.oApplication.getModel("timesheet_initialInfo").getData().releaseAllowed){this.setBtnText("SUBMIT_BTN",this.oApplicationFacade.getResourceBundle().getText("SUBMIT"));this.setBtnEnabled("SUBMIT_BTN",false)}}else{if(this.oApplication.getModel("timesheet_initialInfo").getData().releaseAllowed){var r=this.releaseEntriesSummary(false);if(r[0]==0){this.setBtnText("SUBMIT_BTN",this.oApplicationFacade.getResourceBundle().getText("SUBMIT"));this.setBtnEnabled("SUBMIT_BTN",false)}else{this.setBtnText("SUBMIT_BTN",this.oApplicationFacade.getResourceBundle().getText("SUBMIT")+'('+r[0]+')');this.setBtnEnabled("SUBMIT_BTN",true)}}var s=e.getSource().getSelectedItems();var a=0;for(var i=0;i<s.length;i++){if(s[i].mAggregations.cells[0].mProperties.text!=this.oApplicationFacade.getResourceBundle().getText("ADD_NEW")){a++}}if(a==0){this.setBtnText("deleteBtn",this.oApplicationFacade.getResourceBundle().getText("DELETE"));this.setBtnEnabled("deleteBtn",false)}else{this.setBtnText("deleteBtn",this.oApplicationFacade.getResourceBundle().getText("DELETE")+'('+a+')');this.setBtnEnabled("deleteBtn",true)}}if(this.extHookOnItemSelect){this.extHookOnItemSelect()}},onSelect:function(e){var s=new Date(e.getParameter("date"));var d=e.getParameter("didSelect");this.selectDate(s,d)},selectDate:function(s,f){var d=null;if(s instanceof Date){d=this.formatDateYYYYMMdd(s)}else{d=s;s=new Date(parseInt(d.substring(0,4),10),parseInt(d.substring(4,6),10)-1,parseInt(d.substring(6,8),10))}var m=this.oApplication.getModel("TSM_WEEKLY");m.setProperty("/selected",d);var c=this;var v=false;var e;if(this.entryListContents){var g=this.entryListContents.getItems();var h=[s];v=this.manageSelection(g,s,f);var j=this.byId("ENTRY_LIST_CONTENTS").getSelectedItems();var k=0;for(var i=0;i<j.length;i++){if(j[i].mAggregations.cells[0].mProperties.text!=this.oApplicationFacade.getResourceBundle().getText("ADD_NEW")){k++}}if(k==0){this.setBtnText("deleteBtn",this.oApplicationFacade.getResourceBundle().getText("DELETE"));this.setBtnEnabled("deleteBtn",false)}else{this.setBtnText("deleteBtn",this.oApplicationFacade.getResourceBundle().getText("DELETE")+'('+k+')');this.setBtnEnabled("deleteBtn",true)}if(this.oApplication.getModel("timesheet_initialInfo").getData().releaseAllowed){var r=this.releaseEntriesSummary(false);if(r[0]==0){this.setBtnText("SUBMIT_BTN",this.oApplicationFacade.getResourceBundle().getText("SUBMIT"));this.setBtnEnabled("SUBMIT_BTN",false)}else{this.setBtnText("SUBMIT_BTN",this.oApplicationFacade.getResourceBundle().getText("SUBMIT")+'('+r[0]+')');this.setBtnEnabled("SUBMIT_BTN",true)}}if(v){return}if(this.oConfiguration.getAllowNonWorkingDays()){var p=m.getData();var D={date:s,dateStr:d,dateFormatted:this.convertDateFormat(s),targetHours:0,entries:[]};var n=new hcm.emp.mytimesheet.model.TimeEntry(0,this.oBundle.getText("ADD_NEW"));D.entries.push(n);p.days.push(D);function l(a,b){if(parseInt(a.dateStr)>parseInt(b.dateStr)){return 1}else{return-1}};p.days.sort(l);this.loadListWithoModel();for(i=0;i<g.length;i++){if(g[i]instanceof sap.m.GroupHeaderListItem&&g[i].getTitle()===this.convertDateFormat(s)){g[i].setSelected(true);setTimeout(function(){c.jumpToIndex(i)},100);return}}}}},checkOvertime:function(d){var m=this.oApplication.getModel("TSM_WEEKLY");var a=m.getData().days;for(var i=0;i<a.length;i++){if(a[i].date.getTime()===d.getTime()){if(a[i].entries.length>0&&a[i].entries[a[i].entries.length-1].newEntry){return false}var n=new hcm.emp.mytimesheet.model.TimeEntry(0,this.oBundle.getText("ADD_NEW"));if(this.oConfiguration.getClockEntry()){n.setStartEndTimes(d,a[i].entries,0,a[i].workingDay)}a[i].entries.push(n);this.loadListWithoModel();return true}}return false},displayInlineMessages:function(e,r){var m=this.oApplication.getModel("TSM_WEEKLY");var d=m.getData().days;for(var i=0;i<d.length;i++){for(var j=0;j<d[i].entries.length;j++){var f=false;for(var k=0;k<e.length;k++){if(d[i].entries[j].counter===e[k].counter&&d[i].dateStr===e[k].workdate&&d[i].entries[j].time===parseFloat(e[k].time)){d[i].entries[j].showError=true;d[i].entries[j].error=e[k].message;f=true;break}}if(!f){for(k=0;k<r.length;k++){if(d[i].entries[j].counter===""&&d[i].dateStr===r[k].TimeEntryDataFields.WORKDATE&&d[i].entries[j].time===parseFloat(r[k].TimeEntryDataFields.CATSAMOUNT)){d[i].entries[j].counter=r[k].Counter}}}}}this.oldDays=jQuery.extend(true,{},d);m.setProperty("/showSubmit",false);m.setProperty("/days",d);this.loadListWithoModel()},updateData:function(){var m=this.oApplication.getModel("TSM_WEEKLY");m.setProperty("/red","");m.setProperty("/green","");m.setProperty("/grey","");m.setProperty("/yellow","");m.setProperty("/rejected","");var w=this.byId("WEEKLY_CALENDAR");w.removeTypesOfAllDates();w.unselectAllDates();m.setProperty("/activities",null);m.setProperty("/workingDayList",null);var s=this;this.oService.getWorkDays(this,m.getData().start,m.getData().end,function(d){s.getTimeSheetCalendar(d);if(m.getData().activities){s.setWeeklyData(m.getData().activities)}s.monitorPageRefreshEnded()});this.oService.getWorkListCollection(this,m.getData().start,m.getData().end,function(d){m.setProperty("/activities",d);if(m.getData().workingDayList){s.setWeeklyData(d)}s.monitorPageRefreshEnded()});s.setBtnText("deleteBtn",s.oApplicationFacade.getResourceBundle().getText("DELETE"));s.setBtnEnabled("deleteBtn",false);if(s.oApplication.getModel("timesheet_initialInfo").getData().releaseAllowed){s.setBtnText("SUBMIT_BTN",this.oApplicationFacade.getResourceBundle().getText("SUBMIT"));s.setBtnEnabled("SUBMIT_BTN",false)}if(this.extHookUpdateData){this.extHookUpdateData()}},monitorPageRefreshEnded:function(){var o=this;if("pageRefreshPartOneEnded"in o){jQuery.sap.measure.end(hcm.emp.mytimesheet.utils.PerfUtils.getEndId(hcm.emp.mytimesheet.utils.PerfUtils.WEEK_ENTRY_LOAD));delete o.pageRefreshPartOneEnded}else{o.pageRefreshPartOneEnded=true}},getTimeSheetCalendar:function(d){var m=this.oApplication.getModel("TSM_WEEKLY");var n=new Date(),g=[],r=[],a=[],y=[],b=[],c=m.getData().selected,f=null,e=[],h=false;var w=[];m.setProperty("/workingDayList",w);var j=-1;if(d.length>0){var k=d[0].FirstDayOfWeek;if(k===null){j=-1}else if(k==="MONDAY"){j=1}else if(k==="TUESDAY"){j=2}else if(k==="WEDNESDAY"){j=3}else if(k==="THURSDAY"){j=4}else if(k==="FRIDAY"){j=5}else if(k==="SATURDAY"){j=6}else if(k==="SUNDAY"){j=0}}for(var i=0;i<d.length;i++){var l=d[i].Date;var o=d[i].WorkingDay==="TRUE";var p=new Date(parseInt(l.substring(0,4),10),parseInt(l.substring(4,6),10)-1,parseInt(l.substring(6,8),10));w.push({date:l,workingDay:o,targetHours:parseFloat(d[i].TargetHours.trim()),startTime:d[i].StartTime,endTime:d[i].EndTime,lunchStart:d[i].BreakStart,lunchEnd:d[i].BreakEnd});var s=d[i].Status;if(!o){g.push(p)}else{if(!f){f=l}if(!h&&c===l){h=true}if(s==="YACTION"){e.push(d[i].Date);if(n.getTime()>p.getTime()){r.push(p)}}else if(s==="MACTION"){y.push(p)}else if(s==="REJECTED"){b.push(p)}else if(s==="DONE"){a.push(p)}}}var q=this.byId("WEEKLY_CALENDAR");if(j>0){q.setFirstDayOffset(j)}q.toggleDatesType(y,sap.me.CalendarEventType.Type04,true);q.toggleDatesType(a,sap.me.CalendarEventType.Type01,true);q.toggleDatesType(g,sap.me.CalendarEventType.Type00,true);q.toggleDatesType(r,sap.me.CalendarEventType.Type07,true);q.toggleDatesType(b,sap.me.CalendarEventType.Type06,true);var L={'yellow':y,'green':a,'grey':g,'red':r,'rejected':b};var m=this.oApplication.getModel("TSM_WEEKLY");m.setProperty("/legendforS31",L);if(this.extHookGetTimeSheetCalendar){this.extHookGetTimeSheetCalendar()}},onAddNewEntry:function(e){var m=this.oApplication.getModel("TSM_WEEKLY");m.setProperty('/recentlyUsedSelected',true);m.setProperty('/manualEntrySelected',false);this.oApplication.getModel('S31modelexch').setProperty('/recentlyUsedSelected',true);this.oApplication.getModel('S31modelexch').setProperty('/manualEntrySelected',false);var p=m.getData();var a=new hcm.emp.mytimesheet.model.TimeEntry(0,this.oBundle.getText("ADD_NEW"));if(this.byId("WEEKLY_CALENDAR").getSelectedDates().length>0){a.selectedDate=this.byId("WEEKLY_CALENDAR").getSelectedDates()[0]}var v={entry:a,dayIndex:-1,entryIndex:-1,pageData:p};this.oApplication.getModel('S31modelexch').setProperty('/recentlyUsedSelected',true);this.oApplication.getModel('S31modelexch').setProperty('/manualEntrySelected',false);this.oApplication.getModel('S31modelexch').setProperty('/viewDataS3',v);var s=this.byId('WEEKLY_CALENDAR').getSelectedDates();if(this.byId('ENTRY_LIST_CONTENTS').getSelectedItems()){for(var i=0;i<this.byId('ENTRY_LIST_CONTENTS').getSelectedItems().length;i++){var b=this.byId('ENTRY_LIST_CONTENTS').getSelectedItems()[i];var r=b.getType();if(r=='Inactive'){var d=b.data().selectedDate;var c=sap.ui.core.format.DateFormat.getDateInstance({pattern:"YYYYMMdd"});var f=c.parse(d);if(s.indexOf(f)==-1){s.push(f)}}}}this.oApplication.getModel('S31modelexch').setProperty('/selectedDates',s);this.oRouter.navTo("S31",{},true)},createPageforS31:function(p){var s=this;var a=sap.ui.controller('hcm.emp.mytimesheet.view.S31');var n=this.navContainerRef;var c=new sap.m.Page(p,{showHeader:false,enablScrolling:false,navButtonTap:function(){n.back();n.removePage(n.getPages()[1])},footer:{contentRight:[new sap.m.Button({text:s.oBundle.getText('SUBMIT'),press:[a.updatePageData,a]}),new sap.m.Button({text:this.oBundle.getText('CANCEL'),press:function(){n.back();n.removePage(n.getPages()[1])}})]}});return c},onCalendarWeekChange:function(e){var s=this,d=new Date(e.getParameter("currentDate"));var m=this.oApplication.getModel("TSM_WEEKLY");this.checkCanLeave(function(){m.setProperty("/start",s.formatDateYYYYMMdd(d));d.setDate(d.getDate()+6);m.setProperty("/end",s.formatDateYYYYMMdd(d));s.lastSelected=m.getData().selected;s.lastYear=m.getData().year;s.lastWeek=m.getData().week;s.lastStartDate=m.getData().start;s.lastEndDate=m.getData().end;m.setProperty("/showSubmit",false);s.updateData()},function(){var r=m.getData().start;var a=new Date(parseInt(r.substring(0,4),10),parseInt(r.substring(4,6),10)-1,parseInt(r.substring(6,8),10));s.byId("WEEKLY_CALENDAR").setCurrentDate(a.toDateString());m.setProperty("/year",s.lastYear);m.setProperty("/week",s.lastWeek)})},onNavButton:function(){this.oRouter.navTo("S2",{context:{}},true)},getDateStr:function(d){return""+d.getFullYear()+(""+(d.getMonth()+101)).substring(1)+(""+(d.getDate()+100)).substring(1)},setWeeklyData:function(d){var m=this.oApplication.getModel("TSM_WEEKLY");m.setProperty("/showSubmit",false);var p={days:[]};var l=null;var c=null;var e={};var D=null;var w=m.getData().workingDayList;for(var i=0;i<d.length;i++){if(c===null||d[i].WorkDate!==c){c=d[i].WorkDate;var f=new Date(parseInt(d[i].WorkDate.substring(0,4),10),parseInt(d[i].WorkDate.substring(4,6),10)-1,parseInt(d[i].WorkDate.substring(6,8),10));D={date:f,dateStr:d[i].WorkDate,dateFormatted:this.convertDateFormat(f),targetHours:this.getTargetHours(d[i].WorkDate,w),entries:[],workingDay:this.getWorkingDay(d[i].WorkDate,w)};p.days.push(D);l=null}if(l===null||d[i].RecordNumber!==l){l=d[i].RecordNumber;e=new hcm.emp.mytimesheet.model.TimeEntry(0,"",d[i].Suggested==="TRUE",true);if(e.suggestion){m.setProperty("/showSubmit",true)}D.entries.push(e)}e.setData(d[i])}function g(a,b){if(parseInt(a.dateStr)>parseInt(b.dateStr)){return 1}else{return-1}}p.days.sort(g);for(i=0;i<w.length;i++){if(w[i].workingDay){var h=false;var k=p.days.length;for(var j=0;j<p.days.length;j++){if(w[i].date===p.days[j].dateStr){h=true;break}if(w[i].date<p.days[j].dateStr){k=j;break}}if(!h){var f=new Date(parseInt(w[i].date.substring(0,4),10),parseInt(w[i].date.substring(4,6),10)-1,parseInt(w[i].date.substring(6,8),10));D={date:f,dateStr:w[i].date,dateFormatted:this.convertDateFormat(f),targetHours:this.getTargetHours(w[i].date,w),workingDay:w[i],entries:[]};p.days.splice(k,0,D)}for(var n=0;n<p.days.length;n++){var o=0;for(var j=0;j<p.days[n].entries.length;j++){o+=p.days[n].entries[j].time}if(o<w[i].targetHours){var q=w[i].targetHours-o;var r=new hcm.emp.mytimesheet.model.TimeEntry(q,this.oBundle.getText("ADD_NEW"));if(this.oConfiguration.getClockEntry()){r.setStartEndTimes(D.date,p.days[n].entries,q,w[i])}p.days[n].entries.push(r)}}}}var s=null;for(var n=0;n<p.days.length;n++){this.checkHours(p,n);if(s==null){for(var i=0;i<p.days[n].entries.length;i++){if(p.days[n].entries[i].newEntry){s=p.days[n].date}}}}this.oldDays=jQuery.extend(true,{},p.days);m.setProperty("/days",p.days);this.loadListWithoPageData(p)},checkHours:function(p,d){var t=0;var n=-1;for(var i=0;i<p.days[d].entries.length;i++){if(p.days[d].entries[i].newEntry){n=i}else if(!p.days[d].entries[i].deleted){t+=p.days[d].entries[i].time}}var e=false;var m=p.days[d].targetHours-t;var u=p.days[d].entries.length;for(i=0;i<p.days[d].entries.length;i++){if(p.days[d].entries[i].deleted){u--}}if(m>0||(p.days[d].targetHours===0&&u===0)){if(n>=0){p.days[d].entries[n].time=m;p.days[d].entries[n].hours=Math.floor(m);p.days[d].entries[n].minutes=Math.round((m-Math.floor(m))*60)}else{var a=new hcm.emp.mytimesheet.model.TimeEntry(m,this.oBundle.getText("ADD_NEW"));p.days[d].entries.push();e=true;if(this.oConfiguration.getClockEntry()){a.setStartEndTimes(p.days[d].date,p.days[d].entries,m,p.days[d].workingDay)}p.days[d].entries.push(a)}}else{}return e},getWorkingDay:function(d,w){if(w){for(var i=0;i<w.length;i++){if(w[i].date==d){return w[i]}}}return null},getTargetHours:function(d,w){var a=this.getWorkingDay(d,w);if(a){return a.targetHours}return 0},checkSubmit:function(o,m){var M=this.oApplication.getModel("TSM_WEEKLY");if(o==undefined){o=this.oldDays}if(m==undefined){m=M.getData().days}if(m==undefined||o==undefined){return}for(var i=0;i<m.length;i++){for(var j=0;j<m[i].entries.length;j++){if(o[i]&&j<o[i].entries.length){var a=o[i].entries[j];var b=m[i].entries[j];if(b.deleted||b.counter==null||b.suggestion||a.mainItem!=b.mainItem||a.subItems!=b.subItems||a.notes!=b.notes||a.hours!=b.hours||a.minutes!=b.minutes||a.startTime!=b.startTime||a.endTime!=b.endTime){M.setProperty("/showSubmit",true);return}}else{M.setProperty("/showSubmit",true);return}}}M.setProperty("/showSubmit",false)},convertDateFormat:function(d){return sap.ui.core.format.DateFormat.getDateInstance({style:"medium"}).format(d)},YYYYMMDDtoDate:function(a){if(a==undefined)a="";var y=parseInt(a.substr(0,4),10);var m=parseInt(a.substr(4,2),10)-1;var d=parseInt(a.substr(6,2),10);return new Date(y,m,d,0,0,0,0)},jumpListToYYYYMMDD:function(d,a){try{var m=this.oApplication.getModel("TSM_WEEKLY");var b=m.getData().days;var s=this.convertDateFormat(this.YYYYMMDDtoDate(m.getData().selected));for(var i=0;i<b.length;i++){var D=b[i];if(s!=this.convertDateFormat(D.date))continue;var c=this.entryListContents.getItems();for(var j=0;j<c.length;j++){if(c[j]instanceof sap.m.GroupHeaderListItem){if(c[j].getTitle()==this.convertDateFormat(s)){}}}}}catch(e){}},loadListWithoModel:function(){var m=this.oApplication.getModel("TSM_WEEKLY");this.loadListWithoPageData(m.getData())},loadListWithoPageData:function(p){if(p.days==null){return}var m=this.oApplication.getModel("TSM_WEEKLY");var s=this.convertDateFormat(this.YYYYMMDDtoDate(m.getData().selected));for(var i=0;i<p.days.length;i++){var d=p.days[i];d.selected=(s==d.dateFormatted)}this.loadList(p.days)},listSmartClick:function(i,c){var d=function(e){e.currentTarget.downed_y=e.pageY};var u=function(e){if(Math.abs(e.currentTarget.downed_y-e.pageY)<40)c(e)};i.attachBrowserEvent("mousedown",d);i.attachBrowserEvent("mouseup",u);i.attachBrowserEvent("touchstart",d);i.attachBrowserEvent("touchend",u)},loadList:function(l){var m=this.oApplication.getModel("TSM_WEEKLY");var d=m.getData().days;var s=this;this.entryListContents=this.byId("ENTRY_LIST_CONTENTS");this.entryListContents.destroyItems();for(var i=0;i<d.length;i++){var w=new sap.m.GroupHeaderListItem({title:this.convertDateFormat(d[i].date)});w.addCustomData(new sap.ui.core.CustomData({key:"day",value:d[i].date}));this.entryListContents.addItem(w);w.setSelected(d[i].selected);if(!d[i].entries[d[i].entries.length]){if(d[i].entries[d[i].entries.length-1]){if(d[i].entries[d[i].entries.length-1].newEntry){}else{d[i].entries.push({newEntry:true})}}}for(var j=0;j<d[i].entries.length;j++){var a=d[i].entries[j];if(a.deleted){continue}var S=new sap.m.ColumnListItem({type:"Inactive",tap:function(E){s.onItemSelectGotoEdit(E)}});S.addCustomData(new sap.ui.core.CustomData({key:"day",value:i}));S.addCustomData(new sap.ui.core.CustomData({key:"entry",value:j}));S.addCustomData(new sap.ui.core.CustomData({key:"dateformated",value:d[i].dateFormatted}));S.addCustomData(new sap.ui.core.CustomData({key:"selectedDate",value:d[i].dateStr}));if(a.newEntry){S.addCell(new sap.m.Label({text:this.oBundle.getText("ADD_NEW")}));S.addCell(new sap.m.Label());S.addCell(new sap.m.Label());S.addCell(new sap.m.Label());S.addCell(new sap.m.ObjectStatus())}else{var o=new sap.m.ObjectIdentifier({title:a.mainItem,text:a.subItems,badgeNotes:a.hasNotes});if(a.showError||a.rejectionReason){var c=new sap.ui.layout.VerticalLayout();c.addContent(o);if(a.showError){c.addContent(new sap.m.ObjectStatus({text:a.error,state:sap.ui.core.ValueState.Error}))}else{c.addContent(new sap.m.ObjectStatus({text:a.rejectionReason,state:sap.ui.core.ValueState.Error}))}S.addCell(c)}else{S.addCell(o)}var h=a.hours+this.oBundle.getText("HOURS_LABEL")+" "+a.minutes+this.oBundle.getText("MINUTES_LABEL");var t=sap.ca.ui.model.format.DateFormat.getTimeInstance({pattern:"HHmmss"});var b=sap.ca.ui.model.format.DateFormat.getTimeInstance({style:"medium"});var e;var f;if(this.clockEntry){e=t.parse(a.startTime);S.addCell(new sap.m.Label({text:b.format(e)}));f=t.parse(a.endTime);S.addCell(new sap.m.Label({text:b.format(f)}))}else{S.addCell(new sap.m.Label());S.addCell(new sap.m.Label())}var I=s.oApplication.getModel("timesheet_initialInfo");var g=I.getData().decimalTimeEntry;if(g){S.addCell(new sap.m.Label({text:sap.ca.ui.model.format.NumberFormat.getInstance({style:'standard'}).format(a.time),visible:a.showTime}))}else{S.addCell(new sap.m.Label({text:h,visible:a.showTime}))}var k;if(a.statusId=="REJECTED"||a.statusId=="MSAVE"){k=sap.ui.core.ValueState.Error}else{k=sap.ui.core.ValueState.Success}S.setType("Navigation");S.addCell(new sap.m.ObjectStatus({text:a.status,state:k}))}this.entryListContents.addItem(S)}}if(jQuery.device.is.phone){this.byId("WEEKLY_PAGE").setTitle(this.oBundle.getText("SUMMARY",[this.convertDateFormat(this.parseDateYYYYMMdd(m.getData().start)),this.convertDateFormat(this.parseDateYYYYMMdd(m.getData().end))]))}if(jQuery.device.is.phone||jQuery.device.is.tablet){var n=new sap.m.Button({text:this.oBundle.getText("DELETE"),type:"Reject"});var s=this;n.attachPress(function(){var D=m.getData();D.days[s.dayIndex].entries[s.entryIndex].deleted=true;s.checkHours(D,s.dayIndex);s.loadListWithoModel();s.checkSubmit()});this.byId("ENTRY_LIST_CONTENTS").setSwipeContent(n)}setTimeout(function(){$(".sapTSM-WPEntryColor").each(function(p,v){var q=$(this);var r=q.parent().parent().height();q.height(r)})},500);if(this.extHookLoadList){this.extHookLoadList()}},onDelete:function(e){var t=this.byId("ENTRY_LIST_CONTENTS");var s=[];s=t.getSelectedItems();var d=0;var a=0;var b=0;var n;var c;var f;var g;var m=this.oApplication.getModel("TSM_WEEKLY");var p=m.getData();var S=null;n=s.length;for(var i=0;i<s.length;i++){c=s[i].data().day;f=s[i].data().entry;g=p.days[c].entries[f];this.updatePageData(true,c,g,false);if(g.subItems!=this.oApplicationFacade.getResourceBundle().getText("ADD_NEW")){jQuery.sap.log.info("Hours : "+g.hours);d+=g.hours;a+=g.minutes;jQuery.sap.log.info("Minutes : "+g.minutes);b+=g.time;b=parseFloat(b.toFixed(2));jQuery.sap.log.info("Duration : "+g.time)}else{n--}if(a>59){a-=60;d++}}if(this.isClockEntry()){S={question:this.oBundle.getText('DELETE_CONFIRMATION_SUMMARY'),additionalInformation:[{label:this.oBundle.getText('DELETE_CONFIRMATION_SUMMARY_ENTRIES'),text:n.toString()},{label:this.oBundle.getText('DELETE_CONFIRMATION_SUMMARY_HOURS'),text:this.oBundle.getText('FULL_CONCATENATE_HOURSMIN',[d,a])}],showNote:false,title:this.oConfiguration.getText("DELETE_CONFIRMATION"),confirmButtonLabel:this.oBundle.getText("OK")}}else{var h=this.oBundle.getText('TOTAL_DURATION');if(h.indexOf('_')!=(-1)){h="Total Duration"}S={question:this.oBundle.getText('DELETE_CONFIRMATION_SUMMARY'),additionalInformation:[{label:this.oBundle.getText('DELETE_CONFIRMATION_SUMMARY_ENTRIES'),text:n.toString()},{label:h,text:sap.ca.ui.model.format.NumberFormat.getInstance({style:'standard'}).format(b.toString())}],showNote:false,title:this.oConfiguration.getText("DELETE_CONFIRMATION"),confirmButtonLabel:this.oBundle.getText("OK")}}var _=this;sap.ca.ui.dialog.factory.confirm(S,function(r){if(r.isConfirmed==true){_._submit(s.length,d,a)}})},isClockEntry:function(){return this.oConfiguration.getClockEntry()},updatePageData:function(d,a,e,t){if(!e){return}var m=this.oApplication.getModel("TSM_WEEKLY");var p=m.getData();this.entry=e;this.dayIndex=a;if(d){this.entry.deleted=true}if(t){this.entry.bToBeReleased=true}this.entry.newEntry=false;this.entry.showTime=true;if(!this.isClockEntry()){this.entry.hours=parseInt(this.entry.hours,10);this.entry.minutes=parseInt(this.entry.minutes,10)}else{this.entry.startTime=e.startTime;this.entry.endTime=e.endTime;this.entry.hours=e.hours;this.entry.minutes=e.minutes;this.entry.time=e.time}this.entry.hasNotes=(this.entry.notes&&this.entry.notes.length>0)?true:false;if(this.dayIndex<0){var c=this.byId("weeklyCalendar");var s=c.getSelectedDates();for(var i=0;i<s.length;i++){var b=this.getDateEntries(s[i]);b.push(jQuery.extend(true,{},this.entry));for(var k=0;k<b.length;k++){if(b[k].newEntry){b.splice(k,1)}}}}else{p.days[this.dayIndex].entries[this.entryIndex]=this.entry;var f=0;var n=-1;for(var i=0;i<p.days[this.dayIndex].entries.length;i++){if(p.days[this.dayIndex].entries[i].newEntry){n=i}else{f+=p.days[this.dayIndex].entries[i].time}}var g=p.days[this.dayIndex].targetHours-f;if(g>0){if(n>=0){p.days[this.dayIndex].entries[n].time=g;p.days[this.dayIndex].entries[n].hours=Math.floor(g);p.days[this.dayIndex].entries[n].time=Math.round((g-Math.floor(g))*60)}else{var h=new hcm.emp.mytimesheet.model.TimeEntry(g,this.oBundle.getText("ADD_NEW"));if(this.isClockEntry()){h.setStartEndTimes(p.days[this.dayIndex].date,p.days[this.dayIndex].entries,g,this.workingDay)}p.days[this.dayIndex].entries.push(h)}}else{for(var i=0;i<p.days[this.dayIndex].entries.length;i++){if(p.days[this.dayIndex].entries[i].newEntry){p.days[this.dayIndex].entries.splice(i,1)}}}}this.checkSelectedEntry({pageData:p,dayIndex:this.dayIndex});if(this.extHookUpdatePageData){this.extHookUpdatePageData()}},checkSelectedEntry:function(d){var m=this.oApplication.getModel("TSM_WEEKLY");var l;l=d;if(l.dayIndex!==undefined){if(l.dayIndex>=0){this.checkHours(l.pageData,l.dayIndex)}else{for(var i=0;i<l.pageData.days.length;i++){this.checkHours(l.pageData,i)}}this.checkSubmit(this.oldDays,l.pageData.days)}},manageChecklist:function(o,a,b){var i;if(null!==o&&""!==o){for(var c=0;c<o.length;c++){if(o[c]instanceof sap.m.GroupHeaderListItem){if(!o[c].getSelected()){if((i=jQuery.inArray(o[c],this.checkboxList))!==-1){this.checkboxList.splice(i,1)}}else{if((i=jQuery.inArray(o[c],this.checkboxList))===-1){this.checkboxList.push(o[c])}}}}}else{if(b==="pop"){if((i=jQuery.inArray(a,this.checkboxList))!==-1){this.checkboxList.splice(i,1)}}if(b==="push"){if((i=jQuery.inArray(a,this.checkboxList))===-1){this.checkboxList.push(a)}}}},manageSelection:function(l,d,f){var v=false;var a;for(var i=0;i<l.length;i++){if(l[i].mAggregations.customData.length===4){if(l[i].mAggregations.customData[2].mProperties.value===this.convertDateFormat(d)){if(l[i].getSelected()&&!f){l[i].setSelected(false);this.manageChecklist(null,l[i],"pop")}else if((!l[i].getSelected()&&f)){l[i].setSelected(true);this.manageChecklist(null,l[i],"push")}if(f){this.checkOvertime(d)}}}}v=true;return v},selectDateOnAllCheckBoxSelection:function(t,c){var l=t.getItems();var s=t.getSelectedItems();var a=t.indexOfItem(c);var h=[];var b=null;for(var i=0;i<l.length;i++){if(l[i]instanceof sap.m.GroupHeaderListItem){h.push(i);jQuery.sap.log.info(i+"Items is a header"+l[i].getTitle())}else if(l[i]instanceof sap.m.ColumnListItem){jQuery.sap.log.info(i+"Items is a list items")}if(a===i){b=h.length-1}}var n=h.length;jQuery.sap.log.info("Number of Header :"+n);var d=null;var e=null;d=h[b]+1;if(d===undefined){d=h[b]}e=h[b+1];if(e===undefined){e=h[b]}var f=false;var g=[];var u=[];if(e<d){for(var j=d;j<l.length;j++){if(!l[j].getSelected()){f=true}}}else{for(var j=d;j<e;j++){if(!l[j].getSelected()){f=true}}}var k=sap.ca.ui.model.format.DateFormat.getInstance();if(!a==0){var m=k.convertToDate(this._getHeaderDate(l[h[b]]));if(!f){g.push(m)}else{u.push(m)}}else{if(t._selectAllCheckBox.getSelected()){for(var i=0;i<h.length;i++){var o=k.convertToDate(this._getHeaderDate(l[h[i]]));g.push(o)}}else{for(var i=0;i<h.length;i++){var o=k.convertToDate(this._getHeaderDate(l[h[i]]));u.push(o)}}}if(a==1&&!t._selectAllCheckBox.getSelected()&&s.length==0){for(var i=0;i<h.length;i++){var p=k.convertToDate(this._getHeaderDate(l[h[i]]));u.push(p)}}this.byId("WEEKLY_CALENDAR").toggleDatesSelection(g,true);this.byId("WEEKLY_CALENDAR").toggleDatesSelection(u,false);g=[];u=[]},_getHeaderDate:function(h){var c=h.getCustomData();for(var i=0;i<c.length;i++){if(c[i].getKey()==="day"){return c[i].getValue()}}},unselectTopDates:function(g){this.byId("WEEKLY_CALENDAR").toggleDatesSelection(g,false)},getHeaderFooterOptions:function(){var t=this;return{sI18NFullscreenTitle:"TIMESHEET_TITLE",oEditBtn:{id:"QUICK_FILL_BTN",sI18nBtnTxt:"CREATE",onBtnPressed:function(e){t.onAddNewEntry(e)}},buttonList:[{sId:"deleteBtn",sI18nBtnTxt:"DELETE",onBtnPressed:function(e){t.onDelete(e)}},{sId:"SUBMIT_BTN",sI18nBtnTxt:"SUBMIT",onBtnPressed:function(e){t.onSubmit(e)}}],onBack:jQuery.proxy(function(){var d=sap.ui.core.routing.History.getInstance().getDirection("");if(d&&d!=="Unknown"){window.history.go(-1)}else{this.oRouter.navTo("S2",{},true)}},this)}}});
