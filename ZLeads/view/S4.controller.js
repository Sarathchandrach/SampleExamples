/*
 * Copyright (C) 2009-2014 SAP SE or an SAP affiliate company. All rights reserved
 */
jQuery.sap.require("sap.ca.ui.message.message");jQuery.sap.require("sap.ca.ui.utils.busydialog");jQuery.sap.require("sap.ca.ui.DatePicker");jQuery.sap.require("sap.ca.ui.model.format.DateFormat");jQuery.sap.require("cus.crm.lead.util.formatter");jQuery.sap.require("sap.m.SelectDialog");jQuery.sap.require("cus.crm.lead.util.schema");jQuery.sap.require("sap.ca.scfld.md.controller.BaseDetailController");jQuery.sap.require("cus.crm.lead.util.Util");sap.ca.scfld.md.controller.BaseDetailController.extend("cus.crm.lead.view.S4",{deleteBuffer:[],headerGuid:0,userStatusCode:0,UserStatuses:[],HeaderObject:{},accountObject:{},oSelectedAccount:{},oSelectedContact:{contactID:""},oSelectedEmployee:{employeeID:""},oMainPartner:{PartnerNumber:""},currentDescription:"",currentQuantity:"",BackendProducts:{},requestNumber:0,changeSetMapping:{HEADER:"",STATUS:"",CONTACT:"",BASKET:"",},bBasketUpdate:false,bNavOnUpdate:false,oModel:{},sentStartDate:null,sentEndDate:null,bHeaderUpdateSuccess:false,bStatusUpdateSuccess:false,bContactUpdateSuccess:false,bCancel:false,onInit:function(){sap.ca.scfld.md.controller.BaseDetailController.prototype.onInit.call(this);jQuery.sap.includeStyleSheet(jQuery.sap.getModulePath("cus.crm.lead.css.Leads",".css"),"sap-ui-theme-sap.crm.lead");this.byId('datePickerStartDate').addCustomData(new sap.ui.core.CustomData({key:"OldValue"}));this.byId('datePickerEndDate').addCustomData(new sap.ui.core.CustomData({key:"OldValue"}));this.oModel=this.getView().getModel();var b=cus.crm.lead.util.schema._getServiceSchemaVersion(this.oModel,"Lead");this.sBackendVersion=b;this.oVersioningModel=new sap.ui.model.json.JSONModel({BackendSchemaVersion:b});this.oVersioningModel.updateBindings();this.getView().setModel(this.oVersioningModel,"versioning");this.getView().setModel(new sap.ui.model.json.JSONModel(),"json");this.oAppImpl=sap.ca.scfld.md.app.Application.getImpl();this.oI18nModel=this.oAppImpl.AppI18nModel;this.oResourceBundle=this.oI18nModel.getResourceBundle();this.oDateFormatter=sap.ca.ui.model.format.DateFormat.getDateInstance({style:"medium"},new sap.ui.core.Locale(this.oAppImpl.getResourceBundle().sLocale));this.oRouter.attachRouteMatched(jQuery.proxy(function(e){if(e.getParameter("name")==="edit"){this.fullScreenMode=false;this.sPath=e.getParameter('arguments').contextPath;this.bindEditView(false)}else if(e.getParameter("name")==="editFullScreen"){this.sPath=e.getParameter('arguments').contextPath;this.fullScreenMode=true;this.bindEditView(false)}},this));this.byId('datePickerEndDate').attachBrowserEvent("keydown",jQuery.proxy(function(e){this.setValueState(sap.ui.core.ValueState.None)},this.byId('datePickerEndDate')));this.byId('datePickerStartDate').attachBrowserEvent("keydown",jQuery.proxy(function(e){this.setValueState(sap.ui.core.ValueState.None)},this.byId('datePickerStartDate')));this.byId('datePickerEndDate').attachChange(null,function(e){var d=e.getParameter('newYyyymmdd');if(d!==null){var t=new Date(parseInt(d.substr(0,4)),parseInt(d.substr(4,2)-1),parseInt(d.substr(6,2)));this.byId('datePickerEndDate').setValue(this.oDateFormatter.format(t))}this.byId('datePickerEndDate').setValueState(sap.ui.core.ValueState.None);this.byId('datePickerStartDate').setValueState(sap.ui.core.ValueState.None)},this);this.byId('datePickerStartDate').attachChange(null,function(e){this.byId('datePickerStartDate').setValueState(sap.ui.core.ValueState.None);this.byId('datePickerEndDate').setValueState(sap.ui.core.ValueState.None);var d=e.getParameter('newYyyymmdd');if(d!==null){var t=new Date(parseInt(d.substr(0,4)),parseInt(d.substr(4,2)-1),parseInt(d.substr(6,2)));this.byId('datePickerStartDate').setValue(this.oDateFormatter.format(t))}},this);this.byId('inputMainContact').attachBrowserEvent("keydown",jQuery.proxy(function(e){if(e.keyCode===13){this.showContactF4({})}else{}},this));this.byId('inputEmpResponsible').attachBrowserEvent("keydown",jQuery.proxy(function(e){if(e.keyCode===13){this.showEmployeeF4({})}},this));this.byId('productBasketEdit').getModel('json').setSizeLimit(500);this.bNav=false},onBeforeRendering:function(){this.getView().getModel('controllers').getData().s4Controller=this;this.s3Controller=this.getView().getModel('controllers').getData().s3Controller;if(this.s3Controller){this.s3Controller.s4Controller=this}var s=this.getView().getModel('controllers').getData().s2Controller;if(s){s.s4Controller=this;this.s2Controller=s}},onCancel:function(){if(this.pageNeedsUpdate()){sap.ca.ui.dialog.confirmation.open({question:this.oResourceBundle.getText('DATA_LOSS'),title:this.oResourceBundle.getText('WARNING'),confirmButtonLabel:this.oResourceBundle.getText('CONTINUE')},jQuery.proxy(this.datalossDismissed,this))}else this.datalossDismissed({isConfirmed:true});this.oModel.clearBatch()},datalossDismissed:function(r){if(r.isConfirmed){this.deleteBuffer=[];var s=this.getDetailController();if(s===null){window.history.go(-1);return}this.bCancel=true;var c="Leads(guid'"+this.headerGuid+"')";this.oRouter.attachRouteMatched(this.s3Controller.routeMatched,this.s3Controller);if(!jQuery.device.is.phone){if(!this.fullScreenMode)this.oRouter.navTo("detail",{contextPath:c},true);else this.oRouter.navTo("display",{contextPath:c},true)}else this._navBack()}},handleBatchReads:function(r){var d={};var f=false;var e="";var a="";if(r.__batchResponses[0].statusCode==="200"){this.Origins=r.__batchResponses[0].data.results;this.Origins.splice(0,0,{LanguageCode:"",OriginCode:"",OriginText:""})}else{f=true;e=r.__batchResponses[0].statusText;a=JSON.parse(r.__batchResponses[0].response.body).error.message.value+"\n";this.Origins.push([{LanguageCode:"",OriginCode:"",OriginText:""}])}if(r.__batchResponses[1].statusCode==="200"){this.Priorities=r.__batchResponses[1].data.results;this.Priorities.splice(0,0,{LanguageCode:"",PriorityCode:"",PriorityText:""})}else{f=true;e=r.__batchResponses[1].statusText;a=JSON.parse(r.__batchResponses[1].response.body).error.message.value+"\n";this.Priorities.push([{LanguageCode:"",PriorityCode:"",PriorityText:""}])}if(r.__batchResponses[2].statusCode==="200"){this.QualificationsLevels=r.__batchResponses[2].data.results;this.QualificationsLevels.splice(0,0,{LanguageCode:"",QualificationCode:"",})}else{f=true;e=r.__batchResponses[2].statusText;a=JSON.parse(r.__batchResponses[2].response.body).error.message.value+"\n";this.QualificationsLevels.push([{LanguageCode:"",QualificationCode:""}])}if(f){sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:e,details:a},function(R){var i=0;i++})}if(r.__batchResponses[3].hasOwnProperty("data")){d=r.__batchResponses[3].data;var p=d.Products.results;var s=d.Statuses.results;delete d.Products;delete d.Statuses;d.Products=this._cloneProducts({Products:p}).Products;d.Statuses=s;d.Origins=this.Origins;d.Priorities=this.Priorities;d.QualificationsLevels=this.QualificationsLevels;this.bindHeaderFormsExceptMainContact(d,false)}else this.handleErrors(r.__batchResponses[3])},getDetailController:function(){return this.getView().getModel('controllers').getData().s3Controller},_cloneProducts:function(p){var P;if(p.Products){P=JSON.parse(JSON.stringify(p));for(var i=0;i<P.Products.length;i++){if(P.Products[i].ProductGuid===null)P.Products[i].Backend="CATEGORY";else P.Products[i].Backend="X";P.Products[i].OldValue=P.Products[i].Quantity;this.BackendProducts[P.Products[i].ItemGuid]=JSON.parse(JSON.stringify(P.Products[i]))}}else{P={Products:[]}}return P},bindEditView:function(r){this.deleteBuffer=[];this.BackendProducts={};var s=this.getDetailController();if(s===null||r){if(s==null&&parseFloat(this.sBackendVersion)>=4&&!r){cus.crm.lead.util.Util.refreshHeaderETag(this.sPath,this)}this.oModel.addBatchReadOperations([this.oModel.createBatchOperation("Origins","GET")]);this.oModel.addBatchReadOperations([this.oModel.createBatchOperation("Priorities","GET")]);this.oModel.addBatchReadOperations([this.oModel.createBatchOperation("QualificationsLevels","GET")]);this.oModel.addBatchReadOperations([this.oModel.createBatchOperation("/"+this.sPath+"?$expand=Products,ChangeDocs,Statuses","GET")]);this.oModel.submitBatch(jQuery.proxy(this.handleBatchReads,this),jQuery.proxy(this.handleErrors,this),true);return}this._saveETag(s.sETag);var e="Statuses";var d=s.byId('info').getModel('json').getData();d.Origins=s.Origins;d.Priorities=s.Priorities;d.QualificationsLevels=s.QualificationsLevels;var p=s.byId('Product_Tab').getModel('json').getData();if(p&&p.hasOwnProperty("Products")){var P;if(p.Products){P=JSON.parse(JSON.stringify(p));var i;for(i=0;i<P.Products.length;i++){if(P.Products[i].ProductGuid===null)P.Products[i].Backend="CATEGORY";else P.Products[i].Backend="X";P.Products[i].OldValue=P.Products[i].Quantity;this.BackendProducts[P.Products[i].ItemGuid]=JSON.parse(JSON.stringify(P.Products[i]))}}else{P={Products:[]}}d.Products=P.Products}else e+=",Products";var S=s.byId('salesteam').getModel('json').getData();var m=this.oModel;var a="Leads(guid'"+s.byId('info').getModel('json').getData().Guid+"')";m.read(a,null,["$expand="+e],true,jQuery.proxy(function(o,c){if(e.indexOf("Products")!==-1){var P=this._cloneProducts({Products:c.data.Products.results});d.Products=P.Products}d.Statuses=c.data.Statuses.results;this.byId('selectStatus').getModel('json').setData({Statuses:c.data.Statuses.results});this.byId('selectStatus').setSelectedKey(this.HeaderObject.UserStatusCode);this.UserStatuses=c.data.Statuses.results;this.bindHeaderFormsExceptMainContact(d,false)},this));var b=this.getDetailController();if(this.extHookBindAdditionalFields){this.extHookBindAdditionalFields(b)}},pageNeedsUpdate:function(){this.changeSetMapping.BASKET="";this.changeSetMapping.HEADER="";this.changeSetMapping.CONTACT="";this.changeSetMapping.STATUS="";this.changeSetMapping.EMPLOYEE="";this.bBasketUpdate=false;this.oSentStartDate=null;this.oSentEndDate=null;var c=[];var h=this.headerGuid;var m=this.oModel;this.requestNumber=0;var n=cus.crm.lead.util.schema._getServiceSchemaVersion(this.oModel,"Lead");var e=null;if(n>=4.0){e={sETag:null}}if(this.extHookCheckDeltaAndFrameRequests){this.extHookCheckDeltaAndFrameRequests(c)}var t={Guid:h,Description:this.byId('inputName').getValue(),OriginCode:this.byId('selectOrigin').getSelectedKey(),QualificationCode:this.byId('selectQualification').getSelectedKey(),PriorityCode:this.byId('selectPriority').getSelectedKey(),StartDate:($('#'+this.byId('datePickerStartDate').getIdForLabel()).val()!=="")?this.getDateTimeStampFromDatePicker(this.byId('datePickerStartDate')):null,EndDate:($('#'+this.byId('datePickerEndDate').getIdForLabel()).val()!=="")?this.getDateTimeStampFromDatePicker(this.byId('datePickerEndDate')):null};var a={Guid:h};var k;var b=false;for(k in t){if(k==="StartDate"||k==="EndDate"){if(!this._areDatesSame(this.HeaderObject[k],t[k])){a[k]=t[k];if(k==="StartDate"){this.oSentStartDate=t[k]}else{this.oSentEndDate=t[k]}b=true}}else{if(this.HeaderObject[k]!==t[k]){a[k]=t[k];b=true}}};if(this._hasUserStatusChanged()||this._hasMainContact()||this._hasEmployeeChanged()){b=true}var C=false;if(this.extHookAddCustomHeaderFields){C=this.extHookAddCustomHeaderFields(a)}if(b||C){this.changeSetMapping.HEADER=this.requestNumber;this.requestNumber++;c.push(m.createBatchOperation("Leads(guid'"+h+"')","MERGE",a,e))}else this.changeSetMapping.HEADER="";if(this._hasUserStatusChanged()){this.changeSetMapping.STATUS=this.requestNumber;this.requestNumber++;var a;var s;var j,d;d=this.UserStatuses.length;for(j=0;j<d;j++)if(this.UserStatuses[j].UserStatusCode===this.userStatusCode){s=this.UserStatuses[j].StatusProfile;break}a={HeaderGuid:h,StatusProfile:s,UserStatusCode:this.byId('selectStatus').getSelectedKey()};c.push(m.createBatchOperation("LeadStatuses(StatusProfile='"+s+"',UserStatusCode='"+this.byId('selectStatus').getSelectedKey()+"',HeaderGuid=guid'"+h+"')","MERGE",a,e))}else this.changeSetMapping.STATUS="";if(this._hasMainContact()){var u="";var p={};if(this.byId('inputMainContact').getValue()===""){u="LeadSalesTeamSet(PartnerNumber='"+""+"',PartnerFunctionCode='00000015',HeaderGuid=guid'"+this.headerGuid+"')";p={HeaderGuid:this.headerGuid,PartnerFunctionCode:"00000015",PartnerNumber:"",MainPartner:true}}else{u="LeadSalesTeamSet(PartnerNumber='"+this.oSelectedContact.contactID+"',PartnerFunctionCode='00000015',HeaderGuid=guid'"+this.headerGuid+"')";p={HeaderGuid:this.headerGuid,PartnerFunctionCode:"00000015",PartnerNumber:this.oSelectedContact.contactID,MainPartner:true}}this.changeSetMapping.CONTACT=this.requestNumber;this.requestNumber++;c.push(m.createBatchOperation(u,"MERGE",p,e))}else this.changeSetMapping.CONTACT="";if(parseFloat(this.oVersioningModel.getData().BackendSchemaVersion)>=2.0){if(this._hasEmployeeChanged()){var u;var p={};if(this.byId('inputEmpResponsible').getValue()===""){u="LeadSalesTeamSet(PartnerNumber='"+"',PartnerFunctionCode='00000014',HeaderGuid=guid'"+this.headerGuid+"')";p={HeaderGuid:this.headerGuid,PartnerFunctionCode:"00000014",PartnerNumber:"",MainPartner:true}}else{u="LeadSalesTeamSet(PartnerNumber='"+this.oSelectedEmployee.employeeID+"',PartnerFunctionCode='00000014',HeaderGuid=guid'"+this.headerGuid+"')";p={HeaderGuid:this.headerGuid,PartnerFunctionCode:"00000014",PartnerNumber:this.oSelectedEmployee.employeeID,MainPartner:true}}this.changeSetMapping.EMPLOYEE=this.requestNumber;this.requestNumber++;c.push(m.createBatchOperation(u,"MERGE",p,e))}else this.changeSetMapping.EMPLOYEE=""}var i;for(i=0;i<this.deleteBuffer.length;i++){this.bBasketUpdate=true;var a={HeaderGuid:this.deleteBuffer[i].HeaderGuid,ItemGuid:this.deleteBuffer[i].ItemGuid,ProductGuid:this.deleteBuffer[i].ProductGuid,ProcessingMode:"D"};if(this.extHookAddCustomColumnsForProductDelete){this.extHookAddCustomColumnsForProductDelete(a,this.deleteBuffer[i])}c.push(m.createBatchOperation("LeadProducts(HeaderGuid=guid'"+this.deleteBuffer[i].HeaderGuid+"',ItemGuid=guid'"+this.deleteBuffer[i].ItemGuid+"')","MERGE",a,null))}var f=this.byId('productBasketEdit').getModel('json').getData();var i,l;l=f.Products.length;for(i=0;i<l;i++){if(f.Products[i].Backend==="X"){var o=this.BackendProducts[f.Products[i].ItemGuid];var N=f.Products[i];var v=false;if(this.extHookCheckDeltaOnProductEntry){v=this.extHookCheckDeltaOnProductEntry(o,N)}if(o.Quantity!==N.Quantity||v){this.bBasketUpdate=true;var a={HeaderGuid:f.Products[i].HeaderGuid,ItemGuid:f.Products[i].ItemGuid,ProductGuid:f.Products[i].ProductGuid,Quantity:f.Products[i].Quantity,ProcessingMode:"B"};if(this.extHookAddCustomColumnsForProductModify){this.extHookAddCustomColumnsForProductModify(a,N)}c.push(m.createBatchOperation("LeadProducts(HeaderGuid=guid'"+f.Products[i].HeaderGuid+"',ItemGuid=guid'"+f.Products[i].ItemGuid+"')","MERGE",a,e))}}else if(f.Products[i].Backend===""){this.bBasketUpdate=true;var a={HeaderGuid:f.Products[i].HeaderGuid,ItemGuid:"00000000-0000-0000-0000-000000000001",ProductId:f.Products[i].ProductId,Quantity:f.Products[i].Quantity,Unit:f.Products[i].Unit,ProcessingMode:"A"};if(this.extHookAddCustomColumnsForProductCreate){this.extHookAddCustomColumnsForProductCreate(a,f.Products[i])}c.push(m.createBatchOperation("LeadProducts","POST",a,e))}}if(this.bBasketUpdate===true){this.changeSetMapping.BASKET=this.requestNumber;this.requestNumber++}else this.changeSetMapping.BASKET="";if(c.length>0){m.addBatchChangeOperations(c);return true}return false},_saveETag:function(e){this.sETag=e},_refreshLead:function(){this.bindEditView(true);cus.crm.lead.util.Util.refreshHeaderETag(this.sPath,this)},_is412Error:function(r){for(var i=0;i<r.__batchResponses.length;i++){if(r.__batchResponses[i].response.statusCode==="412"){return true}}return false},onSave:function(e){if(this.validateEditPage()===false)return;if(this.pageNeedsUpdate()){if(this.requestNumber>0){this._oControlStore.oButtonListHelper.aButtons[0].oButton.setEnabled(false);this.oModel.submitBatch(jQuery.proxy(function(r){this.handleBatchResponses(r)},this),jQuery.proxy(function(E){this._oControlStore.oButtonListHelper.aButtons[0].oButton.setEnabled(true);var m;if(E.response){}sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:E.message,details:""+E.response.body,},function(){})},this),true)}}else{this.datalossDismissed({isConfirmed:true});this.oModel.clearBatch()}},showProductDialog:function(){if(!this.oAddProductsFragment){this.oAddProductsFragment=new sap.ui.xmlfragment(this.createId("addProducts"),'cus.crm.lead.fragment.AddProducts',this);this.oAddProductsFragment.setModel(new sap.ui.model.json.JSONModel(),"json");this.oAddProductsFragment.setModel(this.oI18nModel,'i18n')}this.oAddProductsFragment.getBeginButton().setEnabled(false);this.oAddProductsFragment.getContent()[0].setNoDataText(this.oResourceBundle.getText('LOADING'));this.oAddProductsFragment.getModel('json').setData({Products:[]});this.oModel.read("Products",null,null,true,jQuery.proxy(function(o,r){if(r.data.results.length===0)this.oAddProductsFragment.getContent()[0].setNoDataText(this.oResourceBundle.getText('NO_PRODUCTS'));this.oAddProductsFragment.getModel("json").setData({Products:r.data.results})},this),function(e){});this.oAddProductsFragment.open()},closeProductDialog:function(){this.oAddProductsFragment.close();this.oAddProductsFragment.getContent()[0].removeSelections()},addProductsToBasket:function(){var p=this.oAddProductsFragment.getContent()[0];var s=p.getSelectedItems();var a={Products:[]};var d=this.byId('productBasketEdit').getModel('json').getData();if(d&&d.hasOwnProperty("Products"))a.Products=d.Products;var h=this.headerGuid;var i=0;var l=s.length;var L;for(i=0;i<l;i++){L=s[i];var t=L.getBindingContext('json').getObject();var b={HeaderGuid:h,ItemGuid:"",ProcessingMode:"",ProductGuid:t.ProductGuid,ProductId:t.ProductId,ProductName:t.ProductDescription,Quantity:"1",Unit:t.Unit,Backend:"",OldValue:"1"};if(this.extHookExtendProductEntry){this.extHookExtendProductEntry(b,t)}a.Products.push(b)}this.byId('productBasketEdit').getModel('json').updateBindings();this.oAddProductsFragment.close();this.oAddProductsFragment.getContent()[0].removeSelections()},deleteProduct:function(e){var d=e.getSource().getModel('json').getData();var p=e.getSource().getBindingContext('json').getObject();var i;var l=d.Products.length;for(i=0;i<l;i++)if(p==d.Products[i]){d.Products.splice(i,1);if(p.Backend==="X")this.deleteBuffer.push(p);break}this.byId('productBasketEdit').getModel('json').updateBindings()},formatDate:function(i){if(i===""||i===null||i===undefined)return"";var l=new sap.ui.core.Locale(sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().sLocale);var f=sap.ca.ui.model.format.DateFormat.getDateInstance({style:"medium"},l);return f.format(i)},filterProducts:function(e){this.oAddProductsFragment.getBeginButton().setEnabled(false);this.oAddProductsFragment.getContent()[0].removeSelections();this.oAddProductsFragment.getContent()[0].setNoDataText(this.oResourceBundle.getText('LOADING'));this.oAddProductsFragment.getModel('json').setData({Products:[]});this.oModel.read("Products",null,["$filter=ProductDescription eq '"+e.getParameter('query')+"'"],true,jQuery.proxy(function(o,r){if(r.data.results.length===0)this.oAddProductsFragment.getContent()[0].setNoDataText(this.oResourceBundle.getText('NO_PRODUCTS'));this.oAddProductsFragment.getModel('json').setData({Products:r.data.results})},this),function(E){})},getDateTimeStampFromDatePicker:function(d){var l=$('#'+d.getIdForLabel()).val();var c=this.oDateFormatter.parse(l);var y=c.getFullYear();var m=c.getMonth();var a=c.getDate();return new Date(Date.UTC(y,m,a))},showAccountF4:function(e){var a=sap.ca.scfld.md.app.Application.getImpl();var m=this.oModel;this.byId('dialogAccountF4').setModel(m);this.byId('dialogAccountF4').open()},showContactF4:function(e){if(!this.contactF4Fragment){this.contactF4Fragment=new sap.ui.xmlfragment(this.createId("contactF4"),'cus.crm.lead.fragment.ContactF4',this);this.contactF4Fragment.setModel(new sap.ui.model.json.JSONModel(),"json");this.contactF4Fragment.setModel(this.oI18nModel,'i18n')}var t=this.contactF4Fragment.getContent()[0].getInfoToolbar();var a=t.getContent()[0];this.contactF4Fragment.getSubHeader().getContentLeft()[0].setValue(this.byId('inputMainContact').getValue());if(this.HeaderObject.ProspectNumber!=""){t.setVisible(true);a.setText(this.oI18nModel.getResourceBundle().getText('FILTER_BY')+" "+this.HeaderObject.ProspectName);this.contactF4Fragment.getModel('json').setData({ContactCollection:[]});this.contactF4Fragment.getContent()[0].setNoDataText(this.oResourceBundle.getText('LOADING'));this.oModel.read("/AccountCollection(accountID='"+this.HeaderObject.ProspectNumber+"')/Contacts",null,["$filter=substringof('"+this.byId('inputMainContact').getValue()+"',fullName)"],false,jQuery.proxy(function(o,r){this.contactF4Fragment.getModel('json').setData({ContactCollection:r.data.results});if(r.data.results.length===0)this.contactF4Fragment.getContent()[0].setNoDataText(this.oResourceBundle.getText('NO_CONTACTS'))},this),jQuery.proxy(function(E){this.contactF4Fragment.getModel('json').setData({ContactCollection:[]});this.contactF4Fragment.getContent()[0].setNoDataText(this.oResourceBundle.getText('NO_CONTACTS'))},this))}else{t.setVisible(false);this.contactF4Fragment.getModel('json').setData({ContactCollection:[]});this.contactF4Fragment.getContent()[0].setNoDataText(this.oResourceBundle.getText('LOADING'));this.oModel.read("ContactCollection",null,null,true,jQuery.proxy(function(o,r){this.contactF4Fragment.getModel('json').setData({ContactCollection:r.data.results});if(r.data.results.length===0)this.contactF4Fragment.getContent()[0].setNoDataText(this.oResourceBundle.getText('NO_CONTACTS'))},this),jQuery.proxy(function(E){this.contactF4Fragment.getContent()[0].setNoDataText(this.oResourceBundle.getText('NO_CONTACTS'))},this))}this.contactF4Fragment.open()},showEmployeeF4:function(e){if(!this.employeeF4Fragment){this.employeeF4Fragment=new sap.ui.xmlfragment(this.createId("employeeF4"),'cus.crm.lead.fragment.EmployeeF4',this);this.employeeF4Fragment.setModel(new sap.ui.model.json.JSONModel(),"json");this.employeeF4Fragment.setModel(this.oI18nModel,'i18n')}var t=this.employeeF4Fragment.getContent()[0].getInfoToolbar();var a=t.getContent()[0];var f=[];var T=this.byId('inputEmpResponsible').getValue();var s=T.split('/');var S=s[0].replace("/\s+$/","");this.employeeF4Fragment.getSubHeader().getContentLeft()[0].setValue(S);if(S!==""){f.push("$filter=substringof('"+S+"',fullName)")}if(this.HeaderObject.ProspectNumber!=""){t.setVisible(true);a.setText(this.oI18nModel.getResourceBundle().getText('FILTER_BY')+" "+this.HeaderObject.ProspectName);this.employeeF4Fragment.getModel('json').setData({EmployeeCollection:[]});this.employeeF4Fragment.getContent()[0].setNoDataText(this.oResourceBundle.getText('LOADING'));this.oModel.read("/AccountCollection(accountID='"+this.HeaderObject.ProspectNumber+"')/EmployeeResponsibles",null,f,true,jQuery.proxy(function(o,r){this.employeeF4Fragment.getModel('json').setData({EmployeeCollection:r.data.hasOwnProperty("results")?r.data.results:[r.data]});this.employeeF4Fragment.getContent()[0].setNoDataText(this.oResourceBundle.getText('NO_EMPLOYEE'))},this),jQuery.proxy(function(E){this.employeeF4Fragment.getModel('json').setData({EmployeeCollection:[]});this.employeeF4Fragment.getContent()[0].setNoDataText(this.oResourceBundle.getText('NO_EMPLOYEE'))},this))}else{t.setVisible(false);this.employeeF4Fragment.getModel('json').setData({EmployeeCollection:[]});this.employeeF4Fragment.getContent()[0].setNoDataText(this.oResourceBundle.getText('LOADING'));this.oModel.read("EmployeeCollection",null,f,true,jQuery.proxy(function(o,r){this.employeeF4Fragment.getModel('json').setData({EmployeeCollection:r.data.hasOwnProperty("results")?r.data.results:[r.data]});this.employeeF4Fragment.getContent()[0].setNoDataText(this.oResourceBundle.getText('NO_EMPLOYEE'))},this),jQuery.proxy(function(E){this.employeeF4Fragment.getContent()[0].setNoDataText(this.oResourceBundle.getText('NO_EMPLOYEE'))},this))}this.employeeF4Fragment.open()},closeAccountF4:function(e){this.byId('dialogAccountF4').close()},closeContactF4:function(e){this.contactF4Fragment.close()},closeEmployeeF4:function(e){var j=new sap.ui.model.json.JSONModel();j.setData({EmployeeCollection:[]});this.employeeF4Fragment.setModel(j,"json");this.employeeF4Fragment.close()},setAccount:function(e){var a=sap.ca.scfld.md.app.Application.getImpl();var m=this.oModel;this.oSelectedAccount=e.getParameter('listItem').getBindingContext().getObject();this.byId('inputAccount').setValue(this.oSelectedAccount.name1);this.byId('accountList').removeSelections();this.byId('dialogAccountF4').close()},setContact:function(e){this.oSelectedContact=e.getParameter('listItem').getBindingContext('json').getObject();if(this.oSelectedContact.fullName!==""){this.byId('inputMainContact').setValue(this.oSelectedContact.fullName)}else{this.oSelectedContact.fullName=this.oSelectedContact.contactID;this.byId('inputMainContact').setValue(this.oSelectedContact.contactID)}this.contactF4Fragment.getContent()[0].removeSelections();this.contactF4Fragment.close()},setEmployee:function(e){this.oSelectedEmployee=e.getSource().getSelectedItem().getBindingContext("json").getObject();if(this.oSelectedEmployee.fullName!=="")this.byId('inputEmpResponsible').setValue(this.oSelectedEmployee.fullName);else this.byId('inputEmpResponsible').setValue(this.oSelectedEmployee.employeeID);this.employeeF4Fragment.getContent()[0].removeSelections();var j=new sap.ui.model.json.JSONModel();j.setData({EmployeeCollection:[]});this.employeeF4Fragment.setModel(j,"json");this.employeeF4Fragment.close()},searchAccount:function(e){var f=new sap.ui.model.Filter("name1","EQ",e.getParameter('query'));this.byId('accountList').bindAggregation('items',"/AccountCollection",this.byId("accountListItem"),null,f)},searchContact:function(e){var s;var t=this.contactF4Fragment.getContent()[0].getInfoToolbar();var E=e.getParameters();if(E.hasOwnProperty("newValue")){s=E.newValue;if(s.length<4)return}else s=E.query;this.contactF4Fragment.getModel('json').setData({ContactCollection:[]});this.contactF4Fragment.getContent()[0].setNoDataText(this.oResourceBundle.getText('LOADING'));if(t.getVisible()===true&&this.HeaderObject.ProspectNumber!==""){this.oModel.read("AccountCollection(accountID='"+this.HeaderObject.ProspectNumber+"')/Contacts",null,["$filter=substringof('"+s+"',fullName)"],true,jQuery.proxy(function(o,r){this.contactF4Fragment.getModel('json').setData({ContactCollection:r.data.results});if(r.data.results.length===0)this.contactF4Fragment.getContent()[0].setNoDataText(this.oResourceBundle.getText('NO_CONTACTS'))},this),jQuery.proxy(function(o){this.contactF4Fragment.getModel('json').setData({ContactCollection:[]});this.contactF4Fragment.getContent()[0].setNoDataText(this.oResourceBundle.getText('NO_CONTACTS'))},this))}else{t.setVisible(false);this.oModel.read("ContactCollection",null,["$filter=substringof('"+s+"',fullName)"],true,jQuery.proxy(function(o,r){this.contactF4Fragment.getModel('json').setData({ContactCollection:r.data.results});if(r.data.results.length===0)this.contactF4Fragment.getContent()[0].setNoDataText(this.oResourceBundle.getText('NO_CONTACTS'))},this),jQuery.proxy(function(o){this.contactF4Fragment.getModel('json').setData({ContactCollection:[]});this.contactF4Fragment.getContent()[0].setNoDataText(this.oResourceBundle.getText('NO_CONTACTS'))},this))}},searchEmployee:function(e){var s;var t=this.employeeF4Fragment.getContent()[0].getInfoToolbar();var E=e.getParameters();if(E.hasOwnProperty("newValue")){s=E.newValue;if(s.length<4)return}else s=E.query;this.employeeF4Fragment.getModel('json').setData({EmployeeCollection:[]});this.employeeF4Fragment.getContent()[0].setNoDataText(this.oResourceBundle.getText('LOADING'));var u;if(t.getVisible()===false){u="EmployeeCollection"}else{u="/AccountCollection(accountID='"+this.HeaderObject.ProspectNumber+"')/EmployeeResponsibles"}this.oModel.read(u,null,["$filter=substringof('"+s+"',fullName)"],true,jQuery.proxy(function(o,r){this.employeeF4Fragment.getModel('json').setData({EmployeeCollection:r.data.hasOwnProperty("results")?r.data.results:[r.data]});this.employeeF4Fragment.getContent()[0].setNoDataText(this.oResourceBundle.getText('NO_EMPLOYEE'))},this),jQuery.proxy(function(o){this.employeeF4Fragment.getModel('json').setData({EmployeeCollection:[]});this.employeeF4Fragment.getContent()[0].setNoDataText(this.oResourceBundle.getText('NO_EMPLOYEE'))},this))},closeToolbar:function(e){this.contactF4Fragment.getContent()[0].getInfoToolbar().setVisible(false);this.contactF4Fragment.getModel('json').setData({ContactCollection:[]});this.contactF4Fragment.getContent()[0].setNoDataText(this.oResourceBundle.getText('LOADING'));this.oModel.read("ContactCollection",null,null,true,jQuery.proxy(function(o,r){this.contactF4Fragment.getModel('json').setData({ContactCollection:r.data.results});if(r.data.results.length===0)this.contactF4Fragment.getContent()[0].setNoDataText(this.oResourceBundle.getText('NO_CONTACTS'))},this),jQuery.proxy(function(E){this.contactF4Fragment.getContent()[0].setNoDataText(this.oResourceBundle.getText('NO_CONTACTS'))},this))},closeEmpToolbar:function(e){this.employeeF4Fragment.getContent()[0].getInfoToolbar().setVisible(false);this.employeeF4Fragment.getModel('json').setData({EmployeeCollection:[]});this.employeeF4Fragment.getContent()[0].setNoDataText(this.oResourceBundle.getText('LOADING'));var t=this.employeeF4Fragment.getSubHeader().getContentLeft()[0].getValue();var f=(t.length>0)?["$filter=substringof('"+t+"',fullName)"]:null;this.oModel.read("EmployeeCollection",null,f,true,jQuery.proxy(function(o,r){this.employeeF4Fragment.getModel('json').setData({EmployeeCollection:r.data.hasOwnProperty("results")?r.data.results:[r.data]});this.employeeF4Fragment.getContent()[0].setNoDataText(this.oResourceBundle.getText('NO_EMPLOYEE'))},this),jQuery.proxy(function(E){this.employeeF4Fragment.getContent()[0].setNoDataText(this.oResourceBundle.getText('NO_EMPLOYEE'))},this))},closeParticipantsToolbar:function(e){this.participantsF4Fragment.getContent()[0].getInfoToolbar().setVisible(false);this.participantsF4Fragment.getModel('json').setData({AccountCollection:[]});this.participantsF4Fragment.getContent()[0].setNoDataText(this.oResourceBundle.getText('LOADING'));this.oModel.read("AccountCollection",null,null,true,jQuery.proxy(function(o,r){this.participantsF4Fragment.getModel('json').setData({AccountCollection:r.data.results});if(r.data.results.length===0)this.participantsF4Fragment.getContent()[0].setNoDataText(this.oResourceBundle.getText('NO_PARTICIPANTS'))},this),jQuery.proxy(function(E){this.participantsF4Fragment.getContent()[0].setNoDataText(this.oResourceBundle.getText('NO_PARTICIPANTS'))},this))},descriptionChanged:function(e){var d=this.byId('inputName');if(e.getParameter('newValue').length>40){d.setValueState(sap.ui.core.ValueState.Error)}else d.setValueState(sap.ui.core.ValueState.None)},quantityChanged:function(e){var d=e.getSource().getBindingContext('json').getObject();var n=e.getParameter('newValue');var p=/[^0-9.]/;if(p.test(n)===false){if(n.split(".").length>2){d.Quantity=d.OldValue;e.getSource().setValue(d.Quantity)}else{d.OldValue=n;d.Quantity=n}}else{d.Quantity=d.OldValue;e.getSource().setValue(d.Quantity)}},validateEditPage:function(){var d=this.byId('datePickerStartDate');var a=this.byId('datePickerEndDate');var l=$('#'+d.getIdForLabel()).val();var b=$('#'+a.getIdForLabel()).val();var i=false;if(l!==""&&(this.oDateFormatter.parse(l)===null)){i=true;d.setValueState(sap.ui.core.ValueState.Error);sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:this.oI18nModel.getResourceBundle().getText('JUNK_DATE')})}if(b!==""&&(this.oDateFormatter.parse(b)===null)){i=true;sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:this.oI18nModel.getResourceBundle().getText('JUNK_DATE')});a.setValueState(sap.ui.core.ValueState.Error)}if(i)return false;if(l!==""&&b!==""&&this.oDateFormatter.parse(l)>this.oDateFormatter.parse(b)){sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:this.oI18nModel.getResourceBundle().getText('INVALID_DATE')});d.setValueState(sap.ui.core.ValueState.Error);a.setValueState(sap.ui.core.ValueStateError);return false}if(this.oSelectedContact.fullName!==this.byId('inputMainContact').getValue()&&this.byId('inputMainContact').getValue()!==""){this.showContactF4({});return false}if(this.extHookValidateAdditionalFields){var v=this.extHookValidateAdditionalFields();if(!v){return false}}return true},handleBatchResponses:function(r){var s=[];var a;this.bHeaderUpdateSuccess=false;this.bStatusUpdateSuccess=false;this.bContactUpdateSuccess=false;this.bEmployeeUpdateSuccess=false;var p=false;var f=false;var b=false;var e="";var c=false;this._oControlStore.oButtonListHelper.aButtons[0].oButton.setEnabled(true);if(r.__batchResponses[0].hasOwnProperty("__changeResponses")){if(this.extHookHandleResponsesForCustomUpdates){this.extHookHandleResponsesForCustomUpdates(r)}if(this.changeSetMapping.HEADER!==""){a=r.__batchResponses[0].__changeResponses[this.changeSetMapping.HEADER];if(parseInt(a.statusCode)>=400){s.push(a.statusText);f=true;e+=JSON.parse(a.response.body).error.message.value+"\n";if(parseInt(a.statusCode)===412){c=true}this.bindHeaderFormsExceptMainContact(true)}else{this.HeaderObject.Description=this.byId('inputName').getValue();if(this.oSentStartDate!==null){if(this.oSentStartDate==="0000-00-00T00:00:00")this.HeaderObject.StartDate=null;else this.HeaderObject.StartDate=new Date(this.oSentStartDate)}if(this.oSentEndDate!==null){if(this.oSentEndDate==="0000-00-00T00:00:00")this.HeaderObject.EndDate=null;else this.HeaderObject.EndDate=new Date(this.oSentEndDate)}this.HeaderObject.OriginText=this.byId('selectOrigin').getSelectedItem().getText();this.HeaderObject.OriginCode=this.byId('selectOrigin').getSelectedKey();this.HeaderObject.PriorityText=this.byId('selectPriority').getSelectedItem().getText();this.HeaderObject.PriorityCode=this.byId('selectPriority').getSelectedKey();this.HeaderObject.QualificationCode=this.byId('selectQualification').getSelectedKey();this.HeaderObject.QualificationText=this.byId('selectQualification').getSelectedItem().getText();p=true;this.bHeaderUpdateSuccess=true}}if(this.changeSetMapping.STATUS!==""){a=r.__batchResponses[0].__changeResponses[this.changeSetMapping.STATUS];if(parseInt(a.statusCode)<400){this.HeaderObject.UserStatusCode=this.byId('selectStatus').getSelectedKey();this.HeaderObject.UserStatusText=this.byId('selectStatus').getSelectedItem().getText();this.bStatusUpdateSuccess=true;p=true}else{s.push(a.statusText);f=true;e+=JSON.parse(a.response.body).error.message.value+"\n";if(parseInt(a.statusCode)===412){c=true}this.byId('selectStatus').setSelectedKey(this.HeaderObject.UserStatusCode)}}if(this.changeSetMapping.CONTACT!==""){a=r.__batchResponses[0].__changeResponses[this.changeSetMapping.CONTACT];if(parseInt(a.statusCode)>=400){s.push(a.statusText);f=true;e+=JSON.parse(a.response.body).error.message.value+"\n";if(parseInt(a.statusCode)===412){c=true}this.oSelectedContact.contactID=this.HeaderObject.MainContactId;this.oSelectedContact.fullName=this.HeaderObject.MainContactName}else{p=true;this.HeaderObject.MainContactId=this.oSelectedContact.contactID;this.HeaderObject.MainContactName=this.oSelectedContact.fullName;this.byId('inputMainContact').setValue(this.HeaderObject.MainContactName);this.bContactUpdateSuccess=true}}if(parseFloat(this.oVersioningModel.getData().BackendSchemaVersion)>=2.0){if(this.changeSetMapping.EMPLOYEE!==""){a=r.__batchResponses[0].__changeResponses[this.changeSetMapping.EMPLOYEE];if(parseInt(a.statusCode)>=400){s.push(a.statusText);f=true;e+=JSON.parse(a.response.body).error.message.value+"\n";if(parseInt(a.statusCode)===412){c=true}this.oSelectedEmployee.employeeID=this.HeaderObject.EmployeeResponsibleNumber;this.oSelectedEmployee.fullName=this.HeaderObject.EmployeeResponsibleName}else{p=true;this.HeaderObject.EmployeeResponsibleNumber=this.oSelectedEmployee.employeeID;this.HeaderObject.EmployeeResponsibleName=this.oSelectedEmployee.fullName;this.byId('inputMainContact').setValue(this.HeaderObject.EmployeeResponsibleName);this.bEmployeeUpdateSuccess=true}}}if(this.changeSetMapping.BASKET!==""){var i;var l=r.__batchResponses[0].__changeResponses.length;for(i=this.changeSetMapping.BASKET;i<l;i++){a=r.__batchResponses[0].__changeResponses[i];if(parseInt(a.statusCode)>=400){s.push(a.statusText);f=true;e+=JSON.parse(a.response.body).error.message.value+"\n";if(parseInt(a.statusCode)===412){c=true}b=true}else p=true}if(p&&f){if(b)this.fetchProductsOnFail();sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:this.oI18nModel.getResourceBundle().getText('PARTIAL_SAVE'),details:e},function(){});return}if(!p&&f){if(b)this.fetchProductsOnFail();sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:this.oI18nModel.getResourceBundle().getText('SAVE_FAILED'),details:e},function(){});return}}}else{if(this._is412Error(r)){sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('MSG_CONFLICTING_DATA')},jQuery.proxy(function(){this._refreshLead()},this));return}p=true;f=true;sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:this.oI18nModel.getResourceBundle().getText('SAVE_FAILED'),details:JSON.parse(r.__batchResponses[0].response.body).error.message.value},function(){});return}if(p&&!f){if((this.bHeaderUpdateSuccess||this.bStatusUpdateSuccess||this.bContactUpdateSuccess)&&!this.bEmployeeUpdateSuccess)this.refreshListItem();this.bSuccessSave=true;sap.ca.ui.message.showMessageToast(this.oAppImpl.getResourceBundle().getText('LEAD_SAVED'));this.bNavOnUpdate=true;var d="Leads(guid'"+this.headerGuid+"')";sap.ui.getCore().getEventBus().publish("cus.crm.leads","leadChanged",{contextPath:d});var g=this.getDetailController();if(g===null){window.history.go(-1);return}this.oRouter.attachRouteMatched(this.s3Controller.routeMatched,this.s3Controller);if(!jQuery.device.is.phone){if(!this.fullScreenMode)this.oRouter.navTo("detail",{contextPath:d},true);else this.oRouter.navTo("display",{contextPath:d},true)}else this._navBack()}cus.crm.lead.util.Util.refreshHeaderETag(this.sPath,this)},refreshListItem:function(){var p="/"+"Leads(guid'"+this.headerGuid+"')";var i=this.getItemFromSPath(p);if(!i){this.oModel.refresh();return}if(!this.s2Controller){return}if(!this.s2Controller.getList().getSelectedItem()){this.oModel.refresh();return}var d=this.s2Controller.getList().getSelectedItem().getBindingContext().getObject();var k;for(k in this.HeaderObject)d[k]=this.HeaderObject[k];this.s2Controller.getList().updateItems()},startDateChanged:function(e){this.byId('datePickerStartDate').setValue(this.byId('datePickerStartDate').getCustomData()[1].getValue())},fetchProductsOnFail:function(){this.deleteBuffer=[];this.oModel.read("Leads(guid'"+this.headerGuid+"')",null,["$expand=Products"],true,jQuery.proxy(function(o,r){var p={Products:r.data.Products.results};var l=p.Products.length;var i;this.BackendProducts={};for(i=0;i<l;i++){if(p.Products[i].ProductGuid===null)p.Products[i].Backend="CATEGORY";else p.Products[i].Backend="X";p.Products[i].OldValue=p.Products[i].Quantity;this.BackendProducts[p.Products[i].ItemGuid]=JSON.parse(JSON.stringify(p.Products[i]))}var d=this.byId('productsBasketEdit').getModel('json').getData();d.Products=p.Products;this.byId('productBasketEdit').getModel('json').updateBindings()},this))},getItemFromSPath:function(p){if(!this.s2Controller){return null}var a=this.s2Controller.getList().getItems();var i;var c=this.oModel.getContext(p);for(i=0;i<a.length;i++)if(c===a[i].getBindingContext())return a[i];return null},bindHeaderFormsExceptMainContact:function(d,e){this.HeaderObject=d;if(typeof this.HeaderObject["StartDate"]==="string"){this.HeaderObject["StartDate"]=new Date(this.HeaderObject["StartDate"])}if(typeof this.HeaderObject["EndDate"]==="string"){this.HeaderObject["EndDate"]=new Date(this.HeaderObject["EndDate"])}this.headerGuid=d.Guid;this.userStatusCode=d.UserStatusCode;if(e===false){this.currentDescription=d.Description;this.oSelectedContact.contactID=d.MainContactId;this.oSelectedContact.fullName=d.MainContactName;this.byId('inputMainContact').setValue(d.MainContactName)}this.byId('inputName').setValue(d.Description);this.byId('inputAccount').setText(d.ProspectName);this.byId('textLeadId').setText(d.Id);this.byId('leadTypetext').setText(d.ProcessTypeDescription);this.byId('datePickerStartDate').setValue(this.formatDate(d.StartDate));this.byId('datePickerEndDate').setValue(this.formatDate(d.EndDate));this.byId('datePickerStartDate').setValueState(sap.ui.core.ValueState.None);this.byId('datePickerEndDate').setValueState(sap.ui.core.ValueState.None);if(parseFloat(this.oVersioningModel.getData().BackendSchemaVersion)>=2.0){this.byId('inputEmpResponsible').setValue(d.EmployeeResponsibleName);this.oSelectedAccount.accountID=d.ProspectNumber;this.oSelectedEmployee.employeeID=d.EmployeeResponsibleNumber}if(this.HeaderObject.CampaignId!==""){if(this.HeaderObject.CampaignDescription!=="")this.byId('textCampaign').setValue(this.HeaderObject.CampaignDescription);else this.byId('textCampaign').setValue(this.HeaderObject.CampaignId)}var j=this.getView().getModel("json");j.oData=JSON.parse(JSON.stringify(d));j.updateBindings();this.UserStatuses=d.Statuses;this.byId('selectOrigin').setSelectedKey(d.OriginCode);this.byId('selectPriority').setSelectedKey(d.PriorityCode);this.byId('selectQualification').setSelectedKey(d.QualificationCode);this.byId('selectStatus').setSelectedKey(d.UserStatusCode)},getHeaderFooterOptions:function(){var b;var s=this.getDetailController();if(jQuery.device.is.phone||(this.fullScreenMode&&s===null)){b=jQuery.proxy(this.onBack,this)}else{b=null}return{onBack:b,sI18NDetailTitle:this.oResourceBundle.getText('EDIT'),oEditBtn:{sI18nBtnTxt:"SAVE",onBtnPressed:jQuery.proxy(this.onSave,this)},buttonList:[{sI18nBtnTxt:'CANCEL',onBtnPressed:jQuery.proxy(this.onCancel,this)}],bSuppressBookmarkButton:true}},onBack:function(){this.onCancel()},enableProductsAddButton:function(e){if(this.oAddProductsFragment.getContent()[0].getSelectedItems().length>0){this.oAddProductsFragment.getBeginButton().setEnabled(true)}else{this.oAddProductsFragment.getBeginButton().setEnabled(false)}},handleErrors:function(e){jQuery.sap.log.error(JSON.stringify(e));if(e.hasOwnProperty("message")&&e.hasOwnProperty("response")){sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:e.message,details:(typeof e.response.body=="string")?e.response.body:JSON.parse(e.response.body).error.message.value},function(r){})}},_areDatesSame:function(d,D){if(d===null&&D===null){return true}if(!(d instanceof Date&&D instanceof Date)){return false}if(d.getDate()!==D.getDate()){return false}if(d.getMonth()!==D.getMonth()){return false}if(d.getFullYear()!==D.getFullYear()){return false}return true},_hasUserStatusChanged:function(){return(this.userStatusCode!==this.byId('selectStatus').getSelectedKey())},_hasMainContact:function(){return(this.HeaderObject.MainContactId!==this.oSelectedContact.contactID||this.HeaderObject.MainContactName!==this.byId('inputMainContact').getValue())},_hasEmployeeChanged:function(){return(this.HeaderObject.EmployeeResponsibleNumber!==this.oSelectedEmployee.employeeID||this.HeaderObject.EmployeeResponsibleName!==this.byId('inputEmpResponsible').getValue())}});
