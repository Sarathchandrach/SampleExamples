/*
 * Copyright (C) 2009-2014 SAP SE or an SAP affiliate company. All rights reserved
 */
jQuery.sap.require("sap.ca.ui.quickoverview.EmployeeLaunch");jQuery.sap.require("sap.ca.ui.quickoverview.CompanyLaunch");jQuery.sap.require("cus.crm.lead.util.formatter");jQuery.sap.require("cus.crm.lead.util.schema");jQuery.sap.require("sap.m.MessageToast");jQuery.sap.require("sap.ca.scfld.md.controller.BaseDetailController");jQuery.sap.require("sap.ca.ui.model.type.FileSize");jQuery.sap.require("cus.crm.lead.util.Util");sap.ca.scfld.md.controller.BaseDetailController.extend("cus.crm.lead.view.S3",{Origins:[],Priorities:[],QualificationsLevels:[],bAcceptLead:false,bRejectLead:false,sHeaderGuid:"",nLeads:0,bAppLaunched:true,navToOtherApp:false,partnerFunctionMap:{},partnerDeterminationMap:{},accountListItemTemplate:new sap.m.ObjectListItem({title:'{json>name1}'}).addAttribute(new sap.m.ObjectAttribute({text:'{json>accountID}'})).addCustomData(new sap.ui.core.CustomData({key:'ID',value:'{json>accountID}'})),contactListItemTemplate:new sap.m.ObjectListItem({title:'{json>fullName}'}).addAttribute(new sap.m.ObjectAttribute({text:'{json>contactID}'})).addCustomData(new sap.ui.core.CustomData({key:'ID',value:'{json>contactID}'})),employeeListItemTemplate:new sap.m.ObjectListItem({title:'{json>fullName}'}).addAttribute(new sap.m.ObjectAttribute({text:'{json>employeeID}'})).addCustomData(new sap.ui.core.CustomData({key:'ID',value:'{json>employeeID}'})),onInit:function(){this.fullScreenMode=false;sap.ca.scfld.md.controller.BaseDetailController.prototype.onInit.call(this);jQuery.sap.includeStyleSheet(jQuery.sap.getModulePath("cus.crm.lead.css.Leads",".css"),"sap-ui-theme-sap.crm");this.oI18nModel=sap.ca.scfld.md.app.Application.getImpl().AppI18nModel;this.oResourceBundle=this.oI18nModel.getResourceBundle();this.oModel=this.getView().getModel();this.getView().setModel(new sap.ui.model.json.JSONModel());this.byId('salesteam').addCustomData(new sap.ui.core.CustomData({key:'controller',value:this}));this.sBackendVersion=cus.crm.lead.util.schema._getServiceSchemaVersion(this.oModel,"Lead");this.oVersioningModel=new sap.ui.model.json.JSONModel({});this._loadVersionSpecificUI(this.sBackendVersion);this.contactF4Fragment=new sap.ui.xmlfragment(this.createId("contactF4_S3"),'cus.crm.lead.fragment.ContactF4',this);this.contactF4Fragment.setModel(new sap.ui.model.json.JSONModel(),"json");this.contactF4Fragment.setModel(this.oI18nModel,'i18n');this.changeLogFragment=new sap.ui.xmlfragment(this.createId("changeLog_S3"),'cus.crm.lead.fragment.ChangeLog',this);this.changeLogFragment.setModel(new sap.ui.model.json.JSONModel());this.changeLogFragment.setModel(this.oI18nModel,'i18n');this.byId('salesteam').setModel(new sap.ui.model.json.JSONModel(),"json");this.byId('info').setModel(new sap.ui.model.json.JSONModel(),"json");this.byId('Product_Tab').setModel(new sap.ui.model.json.JSONModel(),"json");this.byId('S3_Header').setModel(new sap.ui.model.json.JSONModel(),"json");this.getView().setModel(new sap.ui.model.json.JSONModel(),"json");var f=this.byId('fileupload');var u=this.getView().getModel().sUrlParams;if(f.getUploadEnabled()){f.setXsrfToken(this.getXsrfToken());f.setEncodeUrl("/sap/bc/ui2/encode_file"+(u?'?'+u:''))}this.oRouter.attachRouteMatched(this.routeMatched,this)},getXsrfToken:function(){var t=this.oModel.getHeaders()['x-csrf-token'];if(!t){this.oModel.refreshSecurityToken(function(e,o){t=o.headers['x-csrf-token']},function(){sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:'Could not get XSRF token',details:''})},false)}return t},_loadVersionSpecificUI:function(b){if(parseFloat(b)>=2){this._loadWave4UI()}else{this._loadWave3UI()}},_loadWave3UI:function(){this.oVersioningModel.getData().sParticipantsNoDataTextKey='NO_CONTACTS';this.oVersioningModel.getData().setHeaderTextForParticipants=jQuery.proxy(function(r){},this);this.byId('salesTeam').insertContent(new sap.m.Button({text:"{i18n>ADDCONTACT}",icon:"sap-icon://add",press:jQuery.proxy(this.addContact,this),type:"Transparent",}),0)},_loadWave4UI:function(){this.oVersioningModel.getData().sParticipantsNoDataTextKey='NO_PARTICIPANTS1';this.oVersioningModel.getData().setHeaderTextForParticipants=jQuery.proxy(function(r){this.byId('salesteam').getHeaderToolbar().getContent()[0].setText(this.oResourceBundle.getText('PARTICIPANTS',[r.data.SalesTeam.results.length]))},this);this.byId('S3_Header').addAggregation("attributes",new sap.m.ObjectAttribute({text:"{json>/EmployeeResponsibleName}",active:true,press:jQuery.proxy(this.onEmpBusCardLaunch,this),customData:[new sap.ui.core.CustomData({key:"PartnerNumber",value:"{json>/EmployeeResponsibleNumber}"}),new sap.ui.core.CustomData({key:"PartnerFunctionCode",value:"00000014"}),new sap.ui.core.CustomData({key:"Image",value:"{json>/ContactImgSrc}"}),new sap.ui.core.CustomData({key:"Imager",value:"{json>/ImgSrc}"}),]}));this.byId('salesteam').setHeaderToolbar(new sap.m.Toolbar({content:[new sap.m.Label(),new sap.m.ToolbarSpacer(),new sap.m.Button({text:"",icon:"sap-icon://add",type:"Transparent",press:jQuery.proxy(this.showParticipantsF4,this)})]}))},_handleAddNote:function(e){var v=e.getParameter("value");if(v){var t=this;var m=this.oModel;var h=this.byId('info').getModel('json').getData().Guid;var E={HeaderGuid:h,Content:v};m.create('/LeadNotes',E,null,jQuery.proxy(function(){var t=this;m.read(t.sPath,null,["$expand=Notes"],true,function(o,r){t.byId('listItem').setModel(new sap.ui.model.json.JSONModel({LeadNotes:o.Notes.results}),"json")})},this),function(M){t.displayResponseErrorMessage(M,sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('SAVE_FAILED'))})}},displayResponseErrorMessage:function(m,d){var M;if(m.response){M=jQuery.parseJSON(m.response.body).error.message.value}sap.m.MessageToast.show(M||d)},selectedTab:function(c){var m=this.oModel;var t=c.getSource().getSelectedKey();var a=this;if(this.extHookCustomTabSelectHandler){this.extHookCustomTabSelectHandler(t)}var a=this;if(t=="Product"){}if(t=="Notes"){this.byId("listItem").setNoDataText(sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('LOADING_TEXT'));this.byId('listItem').getModel('json').setData({LeadNotes:[]});m.read(this.sPath,null,["$expand=Notes"],true,jQuery.proxy(function(o,r){var b=this.getView().byId("listItem");var j=new sap.ui.model.json.JSONModel();var d={LeadNotes:r.data.Notes.results};if(d.LeadNotes.length==0){a.byId("listItem").setNoDataText(sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('NO_NOTES'))}j.setData(d);b.setModel(j,"json")},this),jQuery.proxy(function(e){this.handleErrors(e)},this))}if(t=="Attachment"){var h=this.byId('info').getModel('json').getData().Guid;var a=this.getView();var f=a.byId("fileupload");if(f.getEditMode()==true){f.setEditMode(false)}m.refreshSecurityToken();var M=m.getHeaders();f.setXsrfToken(M['x-csrf-token']);var n=h.replace(/-/g,'');f.setCustomHeader("slug",n);m.read(this.sPath,null,["$expand=Attachments"],true,function(b,r){var d={LeadsAttachments:[]};var e=r.data.Attachments.results.length;var i;for(i=0;i<e;i++){var v=r.data.Attachments.results[i];var g=r.data.Attachments.results[i].Url;var U=v.__metadata.media_src;var o={name:v.Name,size:v.fileSize,url:(g==="")?U:g,uploadedDate:cus.crm.lead.util.formatter.formatDate(v.CreatedAt),contributor:v.CreatedBy,fileExtension:cus.crm.lead.util.formatter.mimeTypeFormatter(v.MimeType),fileId:v.DocumentID,media_src:v.__metadata.media_src};d.LeadsAttachments.push(o)}a.byId('fileupload').setModel(new sap.ui.model.json.JSONModel(d))},jQuery.proxy(this.handleErrors,this))}if(t=="Team"){var d;var l=[];var a=this;if(parseFloat(this.sBackendVersion)>=2.0){if(parseFloat(this.sBackendVersion)>=4){var u=cus.crm.lead.util.Util;if(u.getPartnerFunctions()===null){u.fetchPartnerFunctions(this.oModel)}this.partnerDeterminationMap=u.getPartnerFunctions()}else{if(!this.partnerDeterminationMap[this.transactionType]){this.oModel.read("LeadPartnerFctTypes",null,["TransactionType='"+this.transactionType+"'"],false,jQuery.proxy(function(o,r){this.partnerDeterminationMap[this.transactionType]=r.data.results},this),jQuery.proxy(function(e){this.handleErrors(e)},this))}this.partnerFunctionMap={}}}this.byId("salesteam").setNoDataText(this.oResourceBundle.getText('LOADING_TEXT'));this.byId('salesteam').getModel('json').setData({LeadSalesTeamSet:[]});m.read(this.sPath,null,["$expand=SalesTeam"],true,function(o,r){var b=a.getView().byId("salesteam");var e=new sap.ui.model.json.JSONModel();d={LeadSalesTeamSet:r.data.SalesTeam.results};a.oVersioningModel.getData().setHeaderTextForParticipants(r);if(d.LeadSalesTeamSet.length==0){a.byId("salesteam").setNoDataText(a.oResourceBundle.getText(a.oVersioningModel.getData().sParticipantsNoDataTextKey))}var B=[];for(var i=0;i<d.LeadSalesTeamSet.length;i++){var g=d.LeadSalesTeamSet[i].PartnerNumber;var p="/AccountCollection('"+g+"')?$expand=Logo";l[i]="sap-icon://person-placeholder";B.push(m.createBatchOperation(p,"GET"))};m.addBatchReadOperations(B);m.submitBatch(jQuery.proxy(function(R){for(var j=0;j<d.LeadSalesTeamSet.length;j++){if(R.__batchResponses[j].data&&R.__batchResponses[j].data.Logo&&R.__batchResponses[j].data.Logo.__metadata.media_src){var k=R.__batchResponses[j].data.Logo.__metadata.media_src?R.__batchResponses[j].data.Logo.__metadata.media_src:"sap-icon://person-placeholder";var U=k;l[j]=U.toString()}d.LeadSalesTeamSet[j].ImgSrc=l[j]}e.setData(d);b.setModel(e,"json")},this),jQuery.proxy(function(E){sap.m.MessageToast.show(sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('ERROR'))},this),true)})}},getParticipants:function(){var d;var l=[];var t=this;this.partnerFunctionMap={};this.byId("salesteam").setNoDataText(sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('LOADING_TEXT'));this.byId('salesteam').getModel('json').setData({LeadSalesTeamSet:[]});this.oModel.read(this.sPath,null,["$expand=SalesTeam"],true,function(o,r){t.bindS3Header(r.data);var a=t.getView().byId("salesteam");var b=new sap.ui.model.json.JSONModel();d={LeadSalesTeamSet:r.data.SalesTeam.results};t.oVersioningModel.getData().setHeaderTextForParticipants(r);if(d.LeadSalesTeamSet.length==0){t.byId("salesteam").setNoDataText(sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('NO_CONTACTS'))}var B=[];for(var i=0;i<d.LeadSalesTeamSet.length;i++){var c=d.LeadSalesTeamSet[i].PartnerNumber;var p="/AccountCollection('"+c+"')?$expand=Logo";l[i]="sap-icon://person-placeholder";B.push(t.oModel.createBatchOperation(p,"GET"))};t.oModel.addBatchReadOperations(B);t.oModel.submitBatch(jQuery.proxy(function(R){for(var j=0;j<d.LeadSalesTeamSet.length;j++){if(R.__batchResponses[j].data&&R.__batchResponses[j].data.Logo&&R.__batchResponses[j].data.Logo.__metadata.media_src){var m=R.__batchResponses[j].data.Logo.__metadata.media_src?R.__batchResponses[j].data.Logo.__metadata.media_src:"sap-icon://person-placeholder";var U=m;l[j]=U.toString()}d.LeadSalesTeamSet[j].ImgSrc=l[j]}b.setData(d);a.setModel(b,"json")},this),jQuery.proxy(function(e){sap.m.MessageToast.show(sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('ERROR'))},this),true)})},onUploadFile:function(r){var f;if(r.getParameters()&&r.getParameters().d)f=r.getParameters().d;else f=r.getParameters();if(f.__metadata.media_src)var U=f.__metadata.media_src;else var U=f.url;var d=parseInt((f.CreatedAt).substr(6));var n=decodeURIComponent(f.Name);var o={"fileExtension":cus.crm.lead.util.formatter.mimeTypeFormatter(f.MimeType),"contributor":f.CreatedBy,"uploadedDate":cus.crm.lead.util.formatter.formatDate(new Date(d)),"name":n,"url":U,"size":f.fileSize,"fileId":f.DocumentID,};this.byId('fileupload').commitFileUpload(o)},onDeleteFile:function(e){var P=e.getParameters();var U=P.media_src;var r;if(!U)r=P.url.split("(").pop();else r=U.split("(").pop();var p="LeadAttachments(";var u=p+r;this.oModel.remove(u);this.byId('fileupload').removeFile(P.fileId)},onAttachmentSelected:function(e){var s=e.getParameter('listItem').getBindingContext().getObject();var w=window.open(s.__metadata.media_src,'_blank');w.focus()},onEmployeeLaunchheader:function(e){var c=e.getSource().data("PartnerNumber");var p="/AccountCollection('"+c+"')";var l="sap-icon://person-placeholder";var m=this.oModel;m.read(p,null,["$expand=Logo"],false,function(o,r){jQuery.sap.log.info("oData account response");if(o.Logo&&o.Logo.__metadata){var M=o.Logo.__metadata.media_src?o.Logo.__metadata.media_src:"sap-icon://person-placeholder";var U=M.replace(/^https:\/\//i,'http://');l=U.toString()}});var m=this.oModel;var a=this.byId('info').getModel('json').getData().ProspectNumber;var b=e.getSource();var I=l;if(a&&c){this.AccountId=a;this.ContactId=c;var p="/ContactCollection(accountID='"+a+"',contactID='"+c+"')?$expand=WorkAddress,Account,Account/MainAddress,Account/MainContact,Account/MainContact/WorkAddress";var B=[];B.push(m.createBatchOperation(p,"GET"));m.addBatchReadOperations(B);m.submitBatch(jQuery.proxy(function(r){var d={Value:""};d.Value=r.__batchResponses[0].data;var C=jQuery.proxy(function(e){var n={};n.target={};n.target.semanticObject="ContactPerson";n.target.action="MyContacts";n.params={accountID:this.AccountId,contactID:this.ContactId,};this.navToOtherApp=true;return n},this);if(d.Value.Account){if(d.Value.Account.MainContact){if(d.Value.Account.MainContact.WorkAddress){if(d.Value.WorkAddress){if(d.Value.Account.MainAddress){var E={title:sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('CONTACT'),name:d.Value.fullName,imgurl:I,department:d.Value.department,contactmobile:d.Value.WorkAddress.mobilePhone,contactphone:d.Value.WorkAddress.phone,contactemail:d.Value.WorkAddress.email,contactemailsubj:"App Genrated Mail",companyname:d.Value.Account.name1,companyaddress:d.Value.Account.MainAddress.address,beforeExtNav:C,companycard:{title:sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('ACCOUNT'),imgurl:I,companyphone:d.Value.Account.MainAddress.phone,maincontactname:d.Value.Account.MainContact.fullName,maincontactmobile:d.Value.Account.MainContact.WorkAddress.mobilePhone,maincontactphone:d.Value.Account.MainContact.WorkAddress.phone,maincontactemail:d.Value.Account.MainContact.WorkAddress.email,maincontactemailsubj:"Automatic Mail for Maincontact",}};var o=new sap.ca.ui.quickoverview.EmployeeLaunch(E);o.openBy(b)}else{var E={title:sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('CONTACT'),name:d.Value.fullName,imgurl:I,department:d.Value.department,contactmobile:d.Value.WorkAddress.mobilePhone,contactphone:d.Value.WorkAddress.phone,contactemail:d.Value.WorkAddress.email,contactemailsubj:"App Genrated Mail",companyname:d.Value.Account.name1,beforeExtNav:C,companycard:{title:sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('ACCOUNT'),imgurl:"sap-icon://person-placeholder",maincontactname:d.Value.Account.MainContact.fullName,maincontactmobile:d.Value.Account.MainContact.WorkAddress.mobilePhone,maincontactphone:d.Value.Account.MainContact.WorkAddress.phone,maincontactemail:d.Value.Account.MainContact.WorkAddress.email,maincontactemailsubj:"Automatic Mail for Maincontact",}};var o=new sap.ca.ui.quickoverview.EmployeeLaunch(E);o.openBy(e.getSource())}}else{if(d.Value.Account.MainAddress){var E={title:sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('CONTACT'),name:d.Value.fullName,imgurl:I,department:d.Value.department,contactemailsubj:"App Genrated Mail",companyname:d.Value.Account.name1,companyaddress:d.Value.Account.MainAddress.address,beforeExtNav:C,companycard:{title:sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('ACCOUNT'),imgurl:"sap-icon://person-placeholder",companyphone:d.Value.Account.MainAddress.phone,maincontactname:d.Value.Account.MainContact.fullName,maincontactmobile:d.Value.Account.MainContact.WorkAddress.mobilePhone,maincontactphone:d.Value.Account.MainContact.WorkAddress.phone,maincontactemail:d.Value.Account.MainContact.WorkAddress.email,maincontactemailsubj:"Automatic Mail for Maincontact",}};var o=new sap.ca.ui.quickoverview.EmployeeLaunch(E);o.openBy(b)}else{var E={title:sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('CONTACT'),name:d.Value.fullName,imgurl:I,department:d.Value.department,contactemailsubj:"App Genrated Mail",companyname:d.Value.Account.name1,beforeExtNav:C,companycard:{title:sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('ACCOUNT'),imgurl:"sap-icon://person-placeholder",maincontactname:d.Value.Account.MainContact.fullName,maincontactmobile:d.Value.Account.MainContact.WorkAddress.mobilePhone,maincontactphone:d.Value.Account.MainContact.WorkAddress.phone,maincontactemail:d.Value.Account.MainContact.WorkAddress.email,maincontactemailsubj:"Automatic Mail for Maincontact",}};var o=new sap.ca.ui.quickoverview.EmployeeLaunch(E);o.openBy(b)}}}else{if(d.Value.WorkAddress){if(d.Value.Account.MainAddress){var E={title:sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('CONTACT'),name:d.Value.fullName,imgurl:I,department:d.Value.department,contactmobile:d.Value.WorkAddress.mobilePhone,contactphone:d.Value.WorkAddress.phone,contactemail:d.Value.WorkAddress.email,contactemailsubj:"App Genrated Mail",companyname:d.Value.Account.name1,companyaddress:d.Value.Account.MainAddress.address,beforeExtNav:C,companycard:{title:sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('ACCOUNT'),imgurl:"sap-icon://person-placeholder",companyphone:d.Value.Account.MainAddress.phone,maincontactname:d.Value.Account.MainContact.fullName,maincontactemailsubj:"Automatic Mail for Maincontact",}};var o=new sap.ca.ui.quickoverview.EmployeeLaunch(E);o.openBy(b)}else{var E={title:sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('CONTACT'),name:d.Value.fullName,imgurl:I,department:d.Value.department,contactmobile:d.Value.WorkAddress.mobilePhone,contactphone:d.Value.WorkAddress.phone,contactemail:d.Value.WorkAddress.email,contactemailsubj:"App Genrated Mail",companyname:d.Value.Account.name1,beforeExtNav:C,companycard:{title:sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('ACCOUNT'),imgurl:"sap-icon://person-placeholder",maincontactname:d.Value.Account.MainContact.fullName,maincontactemailsubj:"Automatic Mail for Maincontact",}};var o=new sap.ca.ui.quickoverview.EmployeeLaunch(E);o.openBy(b)}}else{if(d.Value.Account.MainAddress){var E={title:sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('CONTACT'),name:d.Value.fullName,imgurl:I,department:d.Value.department,contactemailsubj:"App Genrated Mail",companyname:d.Value.Account.name1,companyaddress:d.Value.Account.MainAddress.address,beforeExtNav:C,companycard:{title:sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('ACCOUNT'),imgurl:"sap-icon://person-placeholder",companyphone:d.Value.Account.MainAddress.phone,maincontactname:d.Value.Account.MainContact.fullName,maincontactemailsubj:"Automatic Mail for Maincontact",}};var o=new sap.ca.ui.quickoverview.EmployeeLaunch(E);o.openBy(b)}else{var E={title:sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('CONTACT'),name:d.Value.fullName,imgurl:I,department:d.Value.department,contactemailsubj:"App Genrated Mail",companyname:d.Value.Account.name1,beforeExtNav:C,companycard:{title:sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('ACCOUNT'),imgurl:"sap-icon://person-placeholder",maincontactname:d.Value.Account.MainContact.fullName,maincontactemailsubj:"Automatic Mail for Maincontact",}};var o=new sap.ca.ui.quickoverview.EmployeeLaunch(E);o.openBy(b)}}}}else{if(d.Value.WorkAddress){if(d.Value.Account.MainAddress){var E={title:sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('CONTACT'),name:d.Value.fullName,imgurl:I,department:d.Value.department,contactmobile:d.Value.WorkAddress.mobilePhone,contactphone:d.Value.WorkAddress.phone,contactemail:d.Value.WorkAddress.email,contactemailsubj:"App Genrated Mail",companyname:d.Value.Account.name1,companyaddress:d.Value.Account.MainAddress.address,beforeExtNav:C,companycard:{title:sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('ACCOUNT'),imgurl:"sap-icon://person-placeholder",companyphone:d.Value.Account.MainAddress.phone,}};var o=new sap.ca.ui.quickoverview.EmployeeLaunch(E);o.openBy(b)}else{var E={title:sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('CONTACT'),name:d.Value.fullName,imgurl:I,department:d.Value.department,contactmobile:d.Value.WorkAddress.mobilePhone,contactphone:d.Value.WorkAddress.phone,contactemail:d.Value.WorkAddress.email,contactemailsubj:"App Genrated Mail",companyname:d.Value.Account.name1,beforeExtNav:C,companycard:{title:sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('ACCOUNT'),imgurl:"sap-icon://person-placeholder",}};var o=new sap.ca.ui.quickoverview.EmployeeLaunch(E);o.openBy(b)}}else{if(d.Value.Account.MainAddress){var E={title:sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('CONTACT'),name:d.Value.fullName,imgurl:I,department:d.Value.department,contactemailsubj:"App Genrated Mail",companyname:d.Value.Account.name1,companyaddress:d.Value.Account.MainAddress.address,beforeExtNav:C,companycard:{title:sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('ACCOUNT'),imgurl:"sap-icon://person-placeholder",companyphone:d.Value.Account.MainAddress.phone,}};var o=new sap.ca.ui.quickoverview.EmployeeLaunch(E);o.openBy(b)}else{var E={title:sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('CONTACT'),name:d.Value.fullName,imgurl:I,department:d.Value.department,contactemailsubj:"App Genrated Mail",companyname:d.Value.Account.name1,beforeExtNav:C,companycard:{title:sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('ACCOUNT'),imgurl:"sap-icon://person-placeholder",}};var o=new sap.ca.ui.quickoverview.EmployeeLaunch(E);o.openBy(b)}}}}else{sap.m.MessageToast.show(sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('ACCOUNT_IS_NULL_S3'))}},this),jQuery.proxy(function(E){sap.m.MessageToast.show(sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('NOT_IN_MAIN_CONTACT'))},this),true)}else{sap.m.MessageToast.show(sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('NOT_IN_MAIN_CONTACT'))}},onEmpBusCardLaunch:function(e){if(e.getSource().data("PartnerNumber")!==''){var p="/EmployeeCollection('"+e.getSource().data("PartnerNumber")+"')";var u="$expand=WorkAddress,Company,Photo";var s=e.getSource();var t=this;this.oModel.read(p,null,[u],true,function(o,r){jQuery.sap.log.info("oData employee response");var T=t.oResourceBundle.getText("EMPLOYEE");var E="";var a="";var b="";var c="";var C="";var d="";var f="";var P="";if(o.WorkAddress){E=o.WorkAddress.mobilePhone;a=o.WorkAddress.phone;b=o.WorkAddress.email;c=o.WorkAddress.department;C=o.WorkAddress.address}if(o.Company&&o.Company.name1){d=o.Company.name1}if(o.fullName&&o.fullName!==""){f=o.fullName}if(o.Photo&&o.Photo.__metadata){var m=cus.crm.lead.util.formatter.formatPhotoUrl(o.Photo.__metadata.media_src);P=cus.crm.lead.util.formatter.urlConverter(m)}var g={title:T,name:f,imgurl:P,department:c,contactmobile:E,contactphone:a,contactemail:b,contactemailsubj:"",companyname:d,companyaddress:C};var h=new sap.ca.ui.quickoverview.EmployeeLaunch(g);h.openBy(s)},function(E){jQuery.sap.log.error("oData request for employee failed")})}},onEmployeeLaunch:function(e){if(e.getSource().data("PartnerFunctionCode")==="00000014"){this.onEmpBusCardLaunch(e);return}var m=this.oModel;var a=this.byId('info').getModel('json').getData().ProspectNumber;var b=e.getSource();var c=e.getSource().data("PartnerNumber");var P=e.getSource().data("PartnerFunctionCode");var I=e.getSource().data("Image");if(P=="00000015"){var d;if(a&&c){this.AccountId=a;this.ContactId=c;var p="/ContactCollection(accountID='"+a+"',contactID='"+c+"')?$expand=WorkAddress,Account,Account/MainAddress,Account/MainContact,Account/MainContact/WorkAddress";var B=[];B.push(m.createBatchOperation(p,"GET"),o);m.addBatchReadOperations(B);m.submitBatch(jQuery.proxy(function(r){var d={Value:""};d.Value=r.__batchResponses[0].data;var C=jQuery.proxy(function(e){var n={};n.target={};n.target.semanticObject="ContactPerson";n.target.action="MyContacts";n.params={accountID:this.AccountId,contactID:this.ContactId,};this.navToOtherApp=true;return n},this);if(d.Value.Account){if(d.Value.Account.MainContact){if(d.Value.Account.MainContact.WorkAddress){if(d.Value.WorkAddress){if(d.Value.Account.MainAddress){var E={title:sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('CONTACT'),name:d.Value.fullName,imgurl:I,department:d.Value.department,contactmobile:d.Value.WorkAddress.mobilePhone,contactphone:d.Value.WorkAddress.phone,contactemail:d.Value.WorkAddress.email,contactemailsubj:"App Genrated Mail",companyname:d.Value.Account.name1,companyaddress:d.Value.Account.MainAddress.address,beforeExtNav:C,companycard:{title:sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('ACCOUNT'),imgurl:I,companyphone:d.Value.Account.MainAddress.phone,maincontactname:d.Value.Account.MainContact.fullName,maincontactmobile:d.Value.Account.MainContact.WorkAddress.mobilePhone,maincontactphone:d.Value.Account.MainContact.WorkAddress.phone,maincontactemail:d.Value.Account.MainContact.WorkAddress.email,maincontactemailsubj:"Automatic Mail for Maincontact",}};var f=new sap.ca.ui.quickoverview.EmployeeLaunch(E);f.openBy(b)}else{var E={title:sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('CONTACT'),name:d.Value.fullName,imgurl:I,department:d.Value.department,contactmobile:d.Value.WorkAddress.mobilePhone,contactphone:d.Value.WorkAddress.phone,contactemail:d.Value.WorkAddress.email,contactemailsubj:"App Genrated Mail",companyname:d.Value.Account.name1,beforeExtNav:C,companycard:{title:sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('ACCOUNT'),imgurl:"sap-icon://person-placeholder",maincontactname:d.Value.Account.MainContact.fullName,maincontactmobile:d.Value.Account.MainContact.WorkAddress.mobilePhone,maincontactphone:d.Value.Account.MainContact.WorkAddress.phone,maincontactemail:d.Value.Account.MainContact.WorkAddress.email,maincontactemailsubj:"Automatic Mail for Maincontact",}};var f=new sap.ca.ui.quickoverview.EmployeeLaunch(E);f.openBy(e.getSource())}}else{if(d.Value.Account.MainAddress){var E={title:sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('CONTACT'),name:d.Value.fullName,imgurl:I,department:d.Value.department,contactemailsubj:"App Genrated Mail",companyname:d.Value.Account.name1,companyaddress:d.Value.Account.MainAddress.address,beforeExtNav:C,companycard:{title:sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('ACCOUNT'),imgurl:"sap-icon://person-placeholder",companyphone:d.Value.Account.MainAddress.phone,maincontactname:d.Value.Account.MainContact.fullName,maincontactmobile:d.Value.Account.MainContact.WorkAddress.mobilePhone,maincontactphone:d.Value.Account.MainContact.WorkAddress.phone,maincontactemail:d.Value.Account.MainContact.WorkAddress.email,maincontactemailsubj:"Automatic Mail for Maincontact",}};var f=new sap.ca.ui.quickoverview.EmployeeLaunch(E);f.openBy(b)}else{var E={title:sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('CONTACT'),name:d.Value.fullName,imgurl:I,department:d.Value.department,contactemailsubj:"App Genrated Mail",companyname:d.Value.Account.name1,beforeExtNav:C,companycard:{title:sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('ACCOUNT'),imgurl:"sap-icon://person-placeholder",maincontactname:d.Value.Account.MainContact.fullName,maincontactmobile:d.Value.Account.MainContact.WorkAddress.mobilePhone,maincontactphone:d.Value.Account.MainContact.WorkAddress.phone,maincontactemail:d.Value.Account.MainContact.WorkAddress.email,maincontactemailsubj:"Automatic Mail for Maincontact",}};var f=new sap.ca.ui.quickoverview.EmployeeLaunch(E);f.openBy(b)}}}else{if(d.Value.WorkAddress){if(d.Value.Account.MainAddress){var E={title:sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('CONTACT'),name:d.Value.fullName,imgurl:I,department:d.Value.department,contactmobile:d.Value.WorkAddress.mobilePhone,contactphone:d.Value.WorkAddress.phone,contactemail:d.Value.WorkAddress.email,contactemailsubj:"App Genrated Mail",companyname:d.Value.Account.name1,companyaddress:d.Value.Account.MainAddress.address,beforeExtNav:C,companycard:{title:sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('ACCOUNT'),imgurl:"sap-icon://person-placeholder",companyphone:d.Value.Account.MainAddress.phone,maincontactname:d.Value.Account.MainContact.fullName,maincontactemailsubj:"Automatic Mail for Maincontact",}};var f=new sap.ca.ui.quickoverview.EmployeeLaunch(E);f.openBy(b)}else{var E={title:sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('CONTACT'),name:d.Value.fullName,imgurl:I,department:d.Value.department,contactmobile:d.Value.WorkAddress.mobilePhone,contactphone:d.Value.WorkAddress.phone,contactemail:d.Value.WorkAddress.email,contactemailsubj:"App Genrated Mail",companyname:d.Value.Account.name1,beforeExtNav:C,companycard:{title:sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('ACCOUNT'),imgurl:"sap-icon://person-placeholder",maincontactname:d.Value.Account.MainContact.fullName,maincontactemailsubj:"Automatic Mail for Maincontact",}};var f=new sap.ca.ui.quickoverview.EmployeeLaunch(E);f.openBy(b)}}else{if(d.Value.Account.MainAddress){var E={title:sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('CONTACT'),name:d.Value.fullName,imgurl:I,department:d.Value.department,contactemailsubj:"App Genrated Mail",companyname:d.Value.Account.name1,companyaddress:d.Value.Account.MainAddress.address,beforeExtNav:C,companycard:{title:sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('ACCOUNT'),imgurl:"sap-icon://person-placeholder",companyphone:d.Value.Account.MainAddress.phone,maincontactname:d.Value.Account.MainContact.fullName,maincontactemailsubj:"Automatic Mail for Maincontact",}};var f=new sap.ca.ui.quickoverview.EmployeeLaunch(E);f.openBy(b)}else{var E={title:sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('CONTACT'),name:d.Value.fullName,imgurl:I,department:d.Value.department,contactemailsubj:"App Genrated Mail",companyname:d.Value.Account.name1,beforeExtNav:C,companycard:{title:sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('ACCOUNT'),imgurl:"sap-icon://person-placeholder",maincontactname:d.Value.Account.MainContact.fullName,maincontactemailsubj:"Automatic Mail for Maincontact",}};var f=new sap.ca.ui.quickoverview.EmployeeLaunch(E);f.openBy(b)}}}}else{if(d.Value.WorkAddress){if(d.Value.Account.MainAddress){var E={title:sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('CONTACT'),name:d.Value.fullName,imgurl:I,department:d.Value.department,contactmobile:d.Value.WorkAddress.mobilePhone,contactphone:d.Value.WorkAddress.phone,contactemail:d.Value.WorkAddress.email,contactemailsubj:"App Genrated Mail",companyname:d.Value.Account.name1,companyaddress:d.Value.Account.MainAddress.address,beforeExtNav:C,companycard:{title:sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('ACCOUNT'),imgurl:"sap-icon://person-placeholder",companyphone:d.Value.Account.MainAddress.phone,}};var f=new sap.ca.ui.quickoverview.EmployeeLaunch(E);f.openBy(b)}else{var E={title:sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('CONTACT'),name:d.Value.fullName,imgurl:I,department:d.Value.department,contactmobile:d.Value.WorkAddress.mobilePhone,contactphone:d.Value.WorkAddress.phone,contactemail:d.Value.WorkAddress.email,contactemailsubj:"App Genrated Mail",companyname:d.Value.Account.name1,beforeExtNav:C,companycard:{title:sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('ACCOUNT'),imgurl:"sap-icon://person-placeholder",}};var f=new sap.ca.ui.quickoverview.EmployeeLaunch(E);f.openBy(b)}}else{if(d.Value.Account.MainAddress){var E={title:sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('CONTACT'),name:d.Value.fullName,imgurl:I,department:d.Value.department,contactemailsubj:"App Genrated Mail",companyname:d.Value.Account.name1,companyaddress:d.Value.Account.MainAddress.address,beforeExtNav:C,companycard:{title:sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('ACCOUNT'),imgurl:"sap-icon://person-placeholder",companyphone:d.Value.Account.MainAddress.phone,}};var f=new sap.ca.ui.quickoverview.EmployeeLaunch(E);f.openBy(b)}else{var E={title:sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('CONTACT'),name:d.Value.fullName,imgurl:I,department:d.Value.department,contactemailsubj:"App Genrated Mail",companyname:d.Value.Account.name1,beforeExtNav:C,companycard:{title:sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('ACCOUNT'),imgurl:"sap-icon://person-placeholder",}};var f=new sap.ca.ui.quickoverview.EmployeeLaunch(E);f.openBy(b)}}}}else{sap.m.MessageToast.show(sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('ACCOUNT_IS_NULL_S3'))}},this),jQuery.proxy(function(E){sap.m.MessageToast.show(sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('NOT_IN_MAIN_CONTACT'))},this),true)}else{sap.m.MessageToast.show(sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('NOT_IN_MAIN_CONTACT'))}}else if(P=="00000021"){this.accountNum=a;if(a){var p="AccountCollection(accountID='"+a+"')?$expand=MainAddress,MainContact/WorkAddress,MainContact";var B=[];B.push(m.createBatchOperation(p,"GET"));m.addBatchReadOperations(B);m.submitBatch(jQuery.proxy(function(r){var M={Value:""};M.Value=r.__batchResponses[0].data;var C=jQuery.proxy(function(e){var n={};n.target={};n.target.semanticObject="Account";n.target.action="MyAccounts&/detail/AccountCollection('"+a+"')";this.navToOtherApp=true;return n},this);if(M.Value.MainContact){if(M.Value.MainContact.WorkAddress){if(M.Value.MainAddress){var f={title:sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('ACCOUNT'),imgurl:I,companyname:M.Value.name1,companyphone:M.Value.MainAddress.phone,companyaddress:M.Value.MainAddress.address,maincontactname:M.Value.MainContact.fullName,maincontactmobile:M.Value.MainContact.WorkAddress.mobilePhone,maincontactphone:M.Value.MainContact.WorkAddress.phone,maincontactemail:M.Value.MainContact.WorkAddress.email,maincontactemailsubj:"Automatic Mail for Maincontact",beforeExtNav:C,};var g=new sap.ca.ui.quickoverview.CompanyLaunch(f);g.openBy(b)}else{var f={title:sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('ACCOUNT'),imgurl:I,companyname:M.Value.name1,maincontactname:M.Value.MainContact.fullName,maincontactmobile:M.Value.MainContact.WorkAddress.mobilePhone,maincontactphone:M.Value.MainContact.WorkAddress.phone,maincontactemail:M.Value.MainContact.WorkAddress.email,maincontactemailsubj:"Automatic Mail for Maincontact",beforeExtNav:C,};var g=new sap.ca.ui.quickoverview.CompanyLaunch(f);g.openBy(b)}}else{if(M.Value.MainAddress){var f={title:sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('ACCOUNT'),imgurl:I,companyname:M.Value.name1,companyphone:M.Value.MainAddress.phone,companyaddress:M.Value.MainAddress.address,maincontactname:M.Value.MainContact.fullName,beforeExtNav:C,};var g=new sap.ca.ui.quickoverview.CompanyLaunch(f);g.openBy(b)}else{var f={title:sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('ACCOUNT'),imgurl:I,companyname:M.Value.name1,maincontactname:M.Value.MainContact.fullName,beforeExtNav:C,};var g=new sap.ca.ui.quickoverview.CompanyLaunch(f);g.openBy(b)}}}else{if(M.Value.MainAddress){var f={title:sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('ACCOUNT'),imgurl:I,companyname:M.Value.name1,companyphone:M.Value.MainAddress.phone,companyaddress:M.Value.MainAddress.address,beforeExtNav:C,};var g=new sap.ca.ui.quickoverview.CompanyLaunch(f);g.openBy(b)}else{var f={title:sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('ACCOUNT'),imgurl:I,companyname:M.Value.name1,beforeExtNav:C,};var g=new sap.ca.ui.quickoverview.CompanyLaunch(f);g.openBy(b)}}},this),jQuery.proxy(function(E){sap.m.MessageToast.show(sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('ERROR'))},this),true)}}else{sap.m.MessageToast.show(sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('BCARD_ONLY_FOR_CONTACTS'))}},onLogChange:function(e){this.changeLogFragment.open(e)},onCancelLogChange:function(e){this.changeLogFragment.close()},showContactF4:function(e){var t=this.contactF4Fragment.getContent()[0].getInfoToolbar();var a=t.getContent()[0];var s=this.contactF4Fragment.getSubHeader().getContentLeft()[0].getValue();if(this.HeaderObject.ProspectNumber!=""){t.setVisible(true);a.setText(this.oI18nModel.getResourceBundle().getText('FILTER_BY')+" "+this.HeaderObject.ProspectName);this.contactF4Fragment.getModel('json').setData({ContactCollection:[]});this.contactF4Fragment.getContent()[0].setNoDataText(this.oResourceBundle.getText('LOADING'));this.oModel.read("/AccountCollection(accountID='"+this.HeaderObject.ProspectNumber+"')/Contacts",null,["$filter=substringof'"+s+"',fullName)"],true,jQuery.proxy(function(o,r){this.contactF4Fragment.getModel('json').setData({ContactCollection:r.data.results});if(r.data.results.length===0)this.contactF4Fragment.getContent()[0].setNoDataText(this.oResourceBundle.getText('NO_CONTACTS'))},this),jQuery.proxy(function(E){this.contactF4Fragment.getModel('json').setData({ContactCollection:[]});this.contactF4Fragment.getContent()[0].setNoDataText(this.oResourceBundle.getText('NO_CONTACTS'))},this))}else{t.setVisible(false);this.contactF4Fragment.getModel('json').setData({ContactCollection:[]});this.contactF4Fragment.getContent()[0].setNoDataText(this.oResourceBundle.getText('LOADING'));this.oModel.read("ContactCollection",null,null,true,jQuery.proxy(function(o,r){this.contactF4Fragment.getModel('json').setData({ContactCollection:r.data.results});if(r.data.results.length===0)this.contactF4Fragment.getContent()[0].setNoDataText(this.oResourceBundle.getText('NO_CONTACTS'))},this),jQuery.proxy(function(E){this.contactF4Fragment.getContent()[0].setNoDataText(this.oResourceBundle.getText('NO_CONTACTS'))},this))}this.contactF4Fragment.open()},addContact:function(){var t=this.contactF4Fragment.getContent()[0].getInfoToolbar();var a=t.getContent()[0];var L=this.byId('info').getModel('json').getData();if(L.ProspectNumber!=""){t.setVisible(true);a.setText(this.oI18nModel.getResourceBundle().getText('FILTER_BY')+" "+L.ProspectName);this.oModel.read("/AccountCollection(accountID='"+L.ProspectNumber+"')/Contacts",null,null,true,jQuery.proxy(function(o,r){this.contactF4Fragment.getModel('json').setData({ContactCollection:r.data.results})},this),jQuery.proxy(function(e){this.contactF4Fragment.getModel('json').setData({ContactCollection:[]})},this))}else{t.setVisible(false);this.oModel.read("ContactCollection",null,null,true,jQuery.proxy(function(o,r){this.contactF4Fragment.getModel('json').setData({ContactCollection:r.data.results})},this),function(e){})}this.contactF4Fragment.open()},searchParticipants:function(){var s=this.participantsF4Fragment.getContent()[0];this.participantsF4Fragment.getBeginButton().setEnabled(false);s.fireChange({selectedItem:s.getSelectedItem()})},onPartnerFunctionChange:function(e){this.checkMinMaxRules(null);var c=e.getParameter('selectedItem').getKey();var a=e.getParameter('selectedItem').getText();var s=this.participantsF4Fragment.getContent()[1].getValue();this.participantsF4Fragment.getBeginButton().setEnabled(false);this.participantsF4Fragment.getContent()[2].setNoDataText(this.oResourceBundle.getText("LOADING"));this.participantsF4Fragment.getContent()[1].setPlaceholder(this.oResourceBundle.getText('SEARCH_PARTICIPANTS'));switch(c){case"0005":case"0008":this.oModel.read("EmployeeCollection",null,["$filter=substringof('"+s+"',fullName)"],false,jQuery.proxy(function(o,r){this.participantsF4Fragment.getModel('json').getData().Employees=r.data.results;this.participantsF4Fragment.getModel('json').updateBindings();this.participantsF4Fragment.getContent()[2].bindItems("json>/Employees",this.employeeListItemTemplate,null,[])},this),jQuery.proxy(function(E){},this));break;case"0007":this.oModel.read("ContactCollection",null,["$filter=substringof('"+s+"',fullName)"],false,jQuery.proxy(function(o,r){this.participantsF4Fragment.getModel('json').getData().Contacts=r.data.results;this.participantsF4Fragment.getModel('json').updateBindings();this.participantsF4Fragment.getContent()[2].bindItems("json>/Contacts",this.contactListItemTemplate,null,[])},this),jQuery.proxy(function(E){},this));break;default:this.oModel.read("AccountCollection",null,["$filter=substringof('"+s+"',name1)"],false,jQuery.proxy(function(o,r){this.participantsF4Fragment.getModel('json').getData().Accounts=r.data.results;this.participantsF4Fragment.getModel('json').updateBindings();this.participantsF4Fragment.getContent()[2].bindItems("json>/Accounts",this.accountListItemTemplate,null,[])},this),jQuery.proxy(function(E){},this));break}this.participantsF4Fragment.getContent()[2].setNoDataText(this.oResourceBundle.getText("NO_PARTICIPANTS"))},enableAddParticipantsButton:function(){var p=this.participantsF4Fragment.getContent()[2];if(p.getSelectedItems().length>0){this.participantsF4Fragment.getBeginButton().setEnabled(true)}else{this.participantsF4Fragment.getBeginButton().setEnabled(false)}},getCountForPartnerFunction:function(p){var c=0;var a=this.byId('salesteam').getModel('json').getData().LeadSalesTeamSet;for(var i=0;i<a.length;i++){if(a[i].PartnerFunctionCode===p){c++}}return c},checkMinMaxRules:function(e){var c=this.participantsF4Fragment.getContent()[0].getSelectedItem().getBindingContext('json').getObject().PartnerFunctionCode;var a=this.participantsF4Fragment.getContent()[0].getSelectedItem().getBindingContext('json').getObject().PartnerFunctionName;var o=this.byId('salesteam').getModel('json').oData.LeadSalesTeamSet;if(e){var s=e.getParameters().listItem.getTitle();var b=e.getParameters().listItem.data("ID");for(var i=0;i<o.length;i++){if(o[i].PartnerNumber==b&&o[i].PartnerFunctionCode==c){sap.m.MessageToast.show(this.oResourceBundle.getText('PARTICIPANT_EXISTS',[s,a]),{duration:3500});e.getParameters().listItem.setSelected(false);return}}}var n=this.participantsF4Fragment.getContent()[2].getSelectedItems().length;var C=this.participantsF4Fragment.getContent()[0].getSelectedItem().getBindingContext('json').getObject();var d=this.getCountForPartnerFunction(C.PartnerFunctionCode);if(n+d>C.CountHigh){if(e){e.getParameters().listItem.setSelected(false)}if(C.CountHigh===1){sap.m.MessageToast.show(this.oResourceBundle.getText('TOO_MANY_PARTICIPANTS_1',[C.CountHigh]),{duration:3500})}else{sap.m.MessageToast.show(this.oResourceBundle.getText('TOO_MANY_PARTICIPANTS',[C.CountHigh]),{duration:3500})}this.enableAddParticipantsButton();return}if(n+d<C.CountLow){if(C.CountLow===1){sap.m.MessageToast.show(this.oResourceBundle.getText('TOO_FEW_PARTICIPANTS',[C.CountLow]),{duration:3500})}else{sap.m.MessageToast.show(this.oResourceBundle.getText('TOO_FEW_PARTICIPANTS',[C.CountLow]),{duration:3500})}this.enableAddParticipantsButton();return}this.enableAddParticipantsButton()},onDeleteParticipant:function(e){var c=e.getSource().getBindingContext('json').getObject();var C=this.getRuleForPartnerFunction(c.PartnerFunctionCode);if(this.getCountForPartnerFunction(c.PartnerFunctionCode)-1<C.CountLow){if(C.CountLow===1){sap.ca.ui.message.showMessageToast(this.oResourceBundle.getText('MUST_HAVE_PARTICIPANTS_1',[C.CountLow]))}else{sap.ca.ui.message.showMessageToast(this.oResourceBundle.getText('MUST_HAVE_PARTICIPANTS',[C.CountLow]))}return}var p=["LeadSalesTeamSet(HeaderGuid=guid'",this.headerGuid,"',PartnerNumber='",c.PartnerNumber,"',PartnerFunctionCode='",c.PartnerFunctionCode,"')"].join("");this.oModel.remove(p,null,jQuery.proxy(function(){this.getParticipants();this.getDataForDetailScreen(false);this.oModel.refresh()},this),jQuery.proxy(function(E){this.handleErrors(E)},this))},getRuleForPartnerFunction:function(p){for(var i=0;i<this.partnerDeterminationMap[this.transactionType].length;i++){if(this.partnerDeterminationMap[this.transactionType][i].PartnerFunctionCode===p){return this.partnerDeterminationMap[this.transactionType][i]}}return null},showParticipantsF4:function(){var s;if(!this.participantsF4Fragment){this.participantsF4Fragment=new sap.ui.xmlfragment(this.createId("participantsF4_S3"),'cus.crm.lead.fragment.ParticipantsF4',this);this.participantsF4Fragment.setModel(new sap.ui.model.json.JSONModel({}),"json");this.participantsF4Fragment.setModel(this.oI18nModel,'i18n');var s=this.participantsF4Fragment.getContent()[0];s.attachChange(null,this.onPartnerFunctionChange,this)}s=this.participantsF4Fragment.getContent()[0];this.participantsF4Fragment.getBeginButton().setEnabled(false);this.participantsF4Fragment.getModel('json').getData().PartnerFunctions=this.partnerDeterminationMap[this.transactionType];this.participantsF4Fragment.getModel('json').updateBindings();if(s.getItems().length>0){s.setSelectedItem(s.getItems()[0]);s.fireChange({selectedItem:s.getItems()[0]})}this.participantsF4Fragment.open()},addParticipants:function(){this.oModel.clearBatch();var c=[];var a=this.participantsF4Fragment.getContent()[0].getSelectedItem().getBindingContext('json').getObject().PartnerFunctionCode;var h=this.byId('info').getModel('json').getData().Guid;var b=this.participantsF4Fragment.getContent()[2].getSelectedItems();var e;for(var i=0;i<b.length;i++){e={HeaderGuid:h,PartnerNumber:b[i].data("ID"),PartnerFunctionCode:a};c.push(this.oModel.createBatchOperation("LeadSalesTeamSet","POST",e,null))}if(c.length>0){this.oModel.addBatchChangeOperations(c);this.oModel.submitBatch(jQuery.proxy(function(r){this.getParticipants();this.getDataForDetailScreen(false);this.participantsF4Fragment.getContent()[2].removeSelections();this.participantsF4Fragment.getContent()[1].clear();this.participantsF4Fragment.close();this.handleAddParticipantsBatchResponses(r)},this),jQuery.proxy(function(E){this.handleErrors(E)},this))}},setContact:function(e){var m=this.oModel;this.oSelectedContact=e.getParameter('listItem').getBindingContext('json').getObject();var h=this.byId('info').getModel('json').getData().Guid;m.refreshSecurityToken();m.update("LeadSalesTeamSet(PartnerNumber='"+this.oSelectedContact.contactID+"',PartnerFunctionCode='00000015',HeaderGuid=guid'"+h+"')",{HeaderGuid:h,PartnerNumber:this.oSelectedContact.contactID,PartnerFunctionCode:'00000015'},{fnSuccess:jQuery.proxy(function(){this.contactF4Fragment.getSubHeader().getContentLeft()[0].clear();var d;var l=[];var t=this;this.getParticipants();cus.crm.lead.util.Util.refreshHeaderETag(this.sPath,this)},this),fnError:jQuery.proxy(function(E){if(E.response.statusCode===412){cus.crm.lead.util.Util.show412ErrorDialog(this,jQuery.proxy(function(){cus.crm.lead.util.Util.refreshHeaderETag(this.sPath,this)},this));return}this.handleErrors(E)},this),bMerge:true});this.contactF4Fragment.getContent()[0].removeSelections();this.contactF4Fragment.close()},closeToolbar:function(e){this.contactF4Fragment.getContent()[0].getInfoToolbar().setVisible(false);this.contactF4Fragment.getModel('json').setData({ContactCollection:[]});this.contactF4Fragment.getContent()[0].setNoDataText(this.oResourceBundle.getText('LOADING'));this.oModel.read("ContactCollection",null,null,true,jQuery.proxy(function(o,r){this.contactF4Fragment.getModel('json').setData({ContactCollection:r.data.results});if(r.data.results.length===0)this.contactF4Fragment.getContent()[0].setNoDataText(this.oResourceBundle.getText('NO_CONTACTS'))},this),jQuery.proxy(function(E){this.contactF4Fragment.getModel('json').setData({ContactCollection:[]});this.contactF4Fragment.getContent()[0].setNoDataText(this.oResourceBundle.getText('NO_CONTACTS'))},this))},closeContactF4:function(e){this.contactF4Fragment.close();this.contactF4Fragment.getSubHeader().getContentLeft()[0].clear()},closeParticipantsF4:function(e){this.participantsF4Fragment.getContent()[2].removeSelections();this.participantsF4Fragment.getContent()[1].clear();this.participantsF4Fragment.close()},searchContact:function(e){var s;var t=this.contactF4Fragment.getContent()[0].getInfoToolbar();t.setVisible(false);var E=e.getParameters();if(E.hasOwnProperty("newValue")){s=E.newValue;if(s.length<4)return}else s=E.query;this.contactF4Fragment.getContent()[0].getInfoToolbar().setVisible(false);this.contactF4Fragment.getModel('json').setData({ContactCollection:[]});this.contactF4Fragment.getContent()[0].setNoDataText(this.oResourceBundle.getText('LOADING'));this.oModel.read("ContactCollection",null,{"filter":"fullName eq '"+s+"'"},true,jQuery.proxy(function(o,r){this.contactF4Fragment.getModel('json').setData({ContactCollection:r.data.results});if(r.data.results.length===0)this.contactF4Fragment.getContent()[0].setNoDataText(this.oResourceBundle.getText('NO_CONTACTS'))},this),jQuery.proxy(function(o){this.contactF4Fragment.getModel('json').setData({ContactCollection:[]});this.contactF4Fragment.getContent()[0].setNoDataText(this.oResourceBundle.getText('NO_CONTACTS'))},this))},cliked:function(e){var a=this.getView().byId("acsheet2");a.openBy(e.getSource())},onEdit:function(){var c=this.sPath;var a=this.byId('info').getModel('json').getData().Guid;var t=this;var m=this.oModel;this.sBackendVersion=cus.crm.lead.util.schema._getServiceSchemaVersion(this.oModel,"Lead");if(parseFloat(this.sBackendVersion)>=3){m.read("EditAuthorizationCheck",null,{ObjectGuid:m.formatValue(a,"Edm.Guid")},false,function(d,r){if(r.data.EditAuthorizationCheck.ActionSuccessful=="X"){if(!t.fullScreenMode){t.oRouter.navTo("edit",{contextPath:c},!jQuery.device.is.phone)}else{t.oRouter.navTo("editFullScreen",{contextPath:c},!jQuery.device.is.phone)}}else{sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:r.data.EditAuthorizationCheck.Message,details:null})}},null)}else{if(!t.fullScreenMode){t.oRouter.navTo("edit",{contextPath:c},!jQuery.device.is.phone)}else{t.oRouter.navTo("editFullScreen",{contextPath:c},!jQuery.device.is.phone)}}},_refresh:function(c,e,d){sap.ca.scfld.md.controller.BaseDetailController.prototype._refresh.apply(this,[c,e,d])},onAccept:function(){sap.ca.ui.dialog.confirmation.open({question:this.oResourceBundle.getText('CONFIRM_LEAD_ACCEPT',[this.byId('info').getModel('json').getData().Description]),title:this.oResourceBundle.getText('S3_POSITIVE'),confirmButtonLabel:this.oResourceBundle.getText('OK')},jQuery.proxy(this.acceptLead,this))},acceptLead:function(r){if(r.isConfirmed===false)return;this.oModel.bRefreshAfterChange=true;this.bAcceptLead=true;var m=this.oModel;var i=this.byId('info').getModel('json').getData().Id;m.create("AcceptLead",null,{success:jQuery.proxy(function(){this.oModel.bRefreshAfterChange=false;this.oModel.refresh();this.byId('accept').setVisible(false);this.byId('reject').setVisible(false);this.byId('edit').setVisible(true);this.getDataForDetailScreen(true)},this),error:jQuery.proxy(function(e){this.handleErrors(e);this.bAcceptLead=false;this.oModel.bRefreshAfterChange=false},this),async:true,urlParameters:["ObjectId='"+i+"'"]})},onReject:function(){sap.ca.ui.dialog.confirmation.open({question:this.oResourceBundle.getText('CONFIRM_LEAD_REJECT',[this.byId('info').getModel('json').getData().Description]),title:this.oResourceBundle.getText('S3_NEGATIVE'),confirmButtonLabel:this.oResourceBundle.getText('OK')},jQuery.proxy(this.rejectLead,this))},rejectLead:function(r){if(r.isConfirmed===false)return;this.oModel.bRefreshAfterChange=true;this.bRejectLead=true;var m=this.oModel;var i=this.byId('info').getModel('json').getData().Id;m.create("RejectLead",null,{success:jQuery.proxy(function(){this.oModel.refresh();this.oModel.bRefreshAfterChange=false},this),error:jQuery.proxy(function(e){this.handleErrors(e);this.bRejectLead=false;this.oModel.bRefreshAfterChange=false},this),async:true,urlParameters:["ObjectId='"+i+"'"]})},cancelPopupAccept:function(){this.byId("accept1").close()},cancelPopupReject:function(){this.byId("reject1").close()},navToEmpty:function(){this.oRouter.navTo("noData")},onBeforeRendering:function(){this.getView().getModel('controllers').getData().s3Controller=this;if(this.byId('info')&&this.byId('info').getModel('json')){var h=this.byId('info').getModel('json').getData();if(h.SystemStatusCode=='I1002'&&h.EmployeeResponsibleNumber===this.EmployeeForUser){this.byId('accept').setVisible(true);this.byId('reject').setVisible(true);this.byId('edit').setVisible(false)}else{this.byId('accept').setVisible(false);this.byId('reject').setVisible(false);this.byId('edit').setVisible(true)}}},navBack:function(e){this.oRouter.navTo("master")},handleErrors:function(e){jQuery.sap.log.error(JSON.stringify(e));if(e.hasOwnProperty("message")&&e.hasOwnProperty("response")){sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:e.message,details:(typeof e.response.body=="string")?e.response.body:JSON.parse(e.response.body).error.message.value},function(r){})}},handleCustomizationBatchResponses:function(r){var e="";var a="";var f=false;if(r.__batchResponses[0].statusCode==="200"){this.Origins=r.__batchResponses[0].data.results;this.Origins.splice(0,0,{LanguageCode:"",OriginCode:"",OriginText:""})}else{f=true;a=r.__batchResponses[0].statusText;e=JSON.parse(r.__batchResponses[0].response.body).error.message.value+"\n";this.Origins.push([{LanguageCode:"",OriginCode:"",OriginText:""}])}if(r.__batchResponses[1].statusCode==="200"){this.Priorities=r.__batchResponses[1].data.results;this.Priorities.splice(0,0,{LanguageCode:"",PriorityCode:"",PriorityText:""})}else{f=true;a=r.__batchResponses[1].statusText;e=JSON.parse(r.__batchResponses[1].response.body).error.message.value+"\n";this.Priorities.push([{LanguageCode:"",PriorityCode:"",PriorityText:""}])}if(r.__batchResponses[2].statusCode==="200"){this.QualificationsLevels=r.__batchResponses[2].data.results;this.QualificationsLevels.splice(0,0,{LanguageCode:"",QualificationCode:"",})}else{f=true;a=r.__batchResponses[2].statusText;e=JSON.parse(r.__batchResponses[2].response.body).error.message.value+"\n";this.QualificationsLevels.push([{LanguageCode:"",QualificationCode:""}])}if(f){jQuery.sap.log.error(e);sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:a,details:e},function(R){})}},handleExpandBatchResponse:function(r){},getDataForDetailScreen:function(s){if(parseFloat(this.sBackendVersion)>=4){var a=this.getView().getModel("controllers").getData().s4Controller;if(a&&a.bSuccessSave){delete a.bSuccessSave}else{cus.crm.lead.util.Util.refreshHeaderETag(this.sPath,this)}}if(this.bAppLaunched){this.oModel.addBatchReadOperations([this.oModel.createBatchOperation("Origins","GET")]);this.oModel.addBatchReadOperations([this.oModel.createBatchOperation("Priorities","GET")]);this.oModel.addBatchReadOperations([this.oModel.createBatchOperation("QualificationsLevels","GET")]);if(this.sBackendVersion>=4.0){this.oModel.addBatchReadOperations([this.oModel.createBatchOperation("EmployeeForUserSet","GET")])}else{this.oModel.addBatchReadOperations([this.oModel.createBatchOperation("EmployeeForUser","GET")])}this.oModel.addBatchReadOperations([this.oModel.createBatchOperation(this.sPath+"?$expand=Products,ChangeDocs","GET")]);if(parseFloat(this.sBackendVersion)>=4){var u=cus.crm.lead.util.Util;if(u.getPartnerFunctions()===null){this.oModel.addBatchReadOperations([this.oModel.createBatchOperation("PartnerFunctions","GET")])}}if(this.extHookGetAdditionalCustomizing){this.extHookGetAdditionalCustomizing()}this.oModel.submitBatch(jQuery.proxy(this.handleBatchResponses,this),jQuery.proxy(this.handleErrors,this));this.bAppLaunched=false}else this.oModel.read(this.sPath,null,["$expand=Products,ChangeDocs"],true,jQuery.proxy(function(o,r){this.bindInfoAndProducts(r.data,s)},this),jQuery.proxy(this.handleErrors,this));if(this.extHookGetAdditionalData){this.extHookGetAdditionalData()}},handleBatchResponses:function(r){var f=false;var e="";var a="";this.bAppLaunched=false;if(r.__batchResponses[0].statusCode==="200"){this.Origins=r.__batchResponses[0].data.results;this.Origins.splice(0,0,{LanguageCode:"",OriginCode:"",OriginText:""})}else{f=true;e=r.__batchResponses[0].statusText;a=JSON.parse(r.__batchResponses[0].response.body).error.message.value+"\n";this.Origins.push([{LanguageCode:"",OriginCode:"",OriginText:""}])}if(r.__batchResponses[1].statusCode==="200"){this.Priorities=r.__batchResponses[1].data.results;this.Priorities.splice(0,0,{LanguageCode:"",PriorityCode:"",PriorityText:""})}else{f=true;e=r.__batchResponses[1].statusText;a=JSON.parse(r.__batchResponses[1].response.body).error.message.value+"\n";this.Priorities.push([{LanguageCode:"",PriorityCode:"",PriorityText:""}])}if(r.__batchResponses[2].statusCode==="200"){this.QualificationsLevels=r.__batchResponses[2].data.results;this.QualificationsLevels.splice(0,0,{LanguageCode:"",QualificationCode:"",})}else{f=true;e=r.__batchResponses[2].statusText;a=JSON.parse(r.__batchResponses[2].response.body).error.message.value+"\n";this.QualificationsLevels.push([{LanguageCode:"",QualificationCode:""}])}if(r.__batchResponses[3].statusCode==="200"){if(this.sBackendVersion>=4.0){this.EmployeeForUser=r.__batchResponses[3].data.results[0].EmployeeResponsibleNumber}else{this.EmployeeForUser=r.__batchResponses[3].data.EmployeeForUser.EmployeeResponsibleNumber}}else{f=true;e=r.__batchResponses[3].statusText;a=JSON.parse(r.__batchResponses[3].response.body).error.message.value+"\n";this.QualificationsLevels.push([{LanguageCode:"",QualificationCode:""}])}if(f){sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:e,details:a},function(R){var i=0;i++})}if(r.__batchResponses[4].hasOwnProperty("data"))this.bindInfoAndProducts(r.__batchResponses[4].data,true);else this.handleErrors(r.__batchResponses[4]);if(parseFloat(this.sBackendVersion)>=4){if(r.__batchResponses[5]&&r.__batchResponses[5].hasOwnProperty("data")){var u=cus.crm.lead.util.Util;u.aggregatePartnerFunctions(r.__batchResponses[5].data.results);this.partnerDeterminationmap=u.getPartnerFunctions()}else{this.handleErrors(r.__batchResponses[5])}}if(this.extHookHandleBatchResponses){this.extHookHandleBatchResponses(r)}},bindS3Header:function(d){var s=this.byId('S3_Header');var p="/AccountCollection('"+d.ProspectNumber+"')";var l="sap-icon://person-placeholder";this.oModel.read(p,null,["$expand=Logo"],false,function(o,r){jQuery.sap.log.info("oData account response");if(o.Logo&&o.Logo.__metadata){var m=o.Logo.__metadata.media_src?o.Logo.__metadata.media_src:"sap-icon://person-placeholder";l=m.toString()}d.ImgSrc=l;if(s&&s.getModel('json'))s.getModel('json').setData(d)},jQuery.proxy(this.handleErrors,this))},bindInfoAndProducts:function(d,s){var i=this.byId('info');var p=this.byId('Product_Tab');this.headerGuid=d.Guid;this.transactionType=d.ProcessType;if(i&&i.getModel('json'))i.getModel('json').setData(d);if(p&&p.getModel('json'))p.getModel('json').setData({Products:d.Products.results});if(d.Products.results.length===0)this.byId('icntab').getItems()[1].setVisible(false);else this.byId('icntab').getItems()[1].setVisible(true);if(d.ChangeDocs.results.length===0)this.byId('changelog').setVisible(false);else{this.byId('changelog').setVisible(true);this.changeLogFragment.getModel().setData({LeadChangeDocs:d.ChangeDocs.results})}this.setFooterButtons(this.byId('info').getModel('json').getData());if(s){this.setDefaultTabToInfo()}this.bindS3Header(d)},getBackFunction:function(){if(this.fullScreenMode)return function(){window.history.back(1)};else return undefined},getS4Controller:function(){if(!sap.ca.scfld.md.app.Application.getImpl().hasOwnProperty("oSplitContainer"))return null;var d=sap.ca.scfld.md.app.Application.getImpl().oSplitContainer.getDetailPages();if(d.length>0){var i;for(i=0;i<d.length;i++)if(d[i].getViewName()=="cus.crm.lead.view.S4")return d[i].getController()}return null},setDefaultTabToInfo:function(){var t=this.byId('icntab');if(t&&t.getItems().length>0){if(t.getSelectedKey()!=="info")t.setSelectedKey("Info");t.setExpanded(true)}},setFooterButtons:function(h){if(h.SystemStatusCode=='I1002'&&h.EmployeeResponsibleNumber===this.EmployeeForUser){this.byId('accept').setVisible(true);this.byId('reject').setVisible(true);this.byId('edit').setVisible(false)}else{this.byId('accept').setVisible(false);this.byId('reject').setVisible(false);this.byId('edit').setVisible(true)}},routeMatched:function(e){if(e.getParameter("name")==="detail"){this.oRouter.detachRouteMatched(this.routeMatched,this);if(this.navToOtherApp){this.navToOtherApp=false;return}var s=this.getS4Controller();if(s&&s.bCancel){s.bCancel=false;this.setDefaultTabToInfo();return}if(s&&s.bEmployeeUpdateSuccess){s.bEmployeeUpdateSuccess=false;this.oModel.refresh()}this.byId('S3_Header').setIcon("sap-icon://person-placeholder");this.sPath=e.getParameter("arguments").contextPath;this.getDataForDetailScreen(true)}else if(e.getParameter("name")==="display"){this.fullScreenMode=true;this.byId('detailPage').setShowNavButton(true);this.oRouter.detachRouteMatched(this.routeMatched,this);if(this.navToOtherApp){this.navToOtherApp=false;return}var s=this.getS4Controller();if(s&&s.bCancel){s.bCancel=false;this.setDefaultTabToInfo();return}if(s&&s.bEmployeeUpdateSuccess){s.bEmployeeUpdateSuccess=false;this.oModel.refresh()}this.byId('S3_Header').setIcon("sap-icon://person-placeholder");this.sPath=e.getParameter("arguments").contextPath;this.getDataForDetailScreen(true)}},onRenameFile:function(e){var n=e.getParameters().newFilename;var f=e.getParameters().fileId;var o={"newFileName":n+"","fileId":f+""};var P=e.getParameters();var U=P.media_src;var r;if(!U)r=P.url.split("(").pop();else r=U.split("(").pop();var p="LeadAttachments(";var u=p+r;this.oModel.setHeaders(o);this.oModel.addBatchChangeOperations([this.oModel.createBatchOperation(u,"PUT",o,null)])},onSaveClicked:function(f){this.oModel.submitBatch();var E=null;if(f)E="*";var s=true;var a=this.byId("fileupload");if(s){a.commitPendingRenames()}else{a.abandonPendingRenames()}},handleAddParticipantsBatchResponses:function(r){var e="";var f=false;if(r.__batchResponses[0].hasOwnProperty("__changeResponses")){var c=r.__batchResponses[0].__changeResponses;for(var i=0;i<c.length;i++){if(parseInt(c[i])>=400){f=true;e+=(c[i].response.body).error.message.value+"\n"}}if(f){sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:this.oResourceBundle.getText('PARTIAL_SAVE'),details:e},function(){})}}},onAccountBusCardLaunch:function(e){var a=e.getSource().data("PartnerNumber");var I=e.getSource().data("Image");var m=this.oModel;var b=e.getSource();if(a){var p="AccountCollection(accountID='"+a+"')?$expand=MainAddress,MainContact/WorkAddress,MainContact";var B=[];B.push(m.createBatchOperation(p,"GET"));m.addBatchReadOperations(B);m.submitBatch(jQuery.proxy(function(r){var M={Value:""};M.Value=r.__batchResponses[0].data;var c=jQuery.proxy(function(E){var n={};n.target={};n.target.semanticObject="Account";n.target.action="MyAccounts&/detail/AccountCollection('"+a+"')";this.navToOtherApp=true;return n},this);if(M.Value.MainContact){if(M.Value.MainContact.WorkAddress){if(M.Value.MainAddress){var C={title:sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('ACCOUNT'),imgurl:I,companyname:M.Value.name1,companyphone:M.Value.MainAddress.phone,companyaddress:M.Value.MainAddress.address,maincontactname:M.Value.MainContact.fullName,maincontactmobile:M.Value.MainContact.WorkAddress.mobilePhone,maincontactphone:M.Value.MainContact.WorkAddress.phone,maincontactemail:M.Value.MainContact.WorkAddress.email,maincontactemailsubj:"Automatic Mail for Maincontact",beforeExtNav:c,};var o=new sap.ca.ui.quickoverview.CompanyLaunch(C);o.openBy(b)}else{var C={title:sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('ACCOUNT'),imgurl:I,companyname:M.Value.name1,maincontactname:M.Value.MainContact.fullName,maincontactmobile:M.Value.MainContact.WorkAddress.mobilePhone,maincontactphone:M.Value.MainContact.WorkAddress.phone,maincontactemail:M.Value.MainContact.WorkAddress.email,maincontactemailsubj:"Automatic Mail for Maincontact",beforeExtNav:c,};var o=new sap.ca.ui.quickoverview.CompanyLaunch(C);o.openBy(b)}}else{if(M.Value.MainAddress){var C={title:sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('ACCOUNT'),imgurl:I,companyname:M.Value.name1,companyphone:M.Value.MainAddress.phone,companyaddress:M.Value.MainAddress.address,maincontactname:M.Value.MainContact.fullName,beforeExtNav:c,};var o=new sap.ca.ui.quickoverview.CompanyLaunch(C);o.openBy(b)}else{var C={title:sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('ACCOUNT'),imgurl:I,companyname:M.Value.name1,maincontactname:M.Value.MainContact.fullName,beforeExtNav:c,};var o=new sap.ca.ui.quickoverview.CompanyLaunch(C);o.openBy(b)}}}else{if(M.Value.MainAddress){var C={title:sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('ACCOUNT'),imgurl:I,companyname:M.Value.name1,companyphone:M.Value.MainAddress.phone,companyaddress:M.Value.MainAddress.address,beforeExtNav:c,};var o=new sap.ca.ui.quickoverview.CompanyLaunch(C);o.openBy(b)}else{var C={title:sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('ACCOUNT'),imgurl:I,companyname:M.Value.name1,beforeExtNav:c,};var o=new sap.ca.ui.quickoverview.CompanyLaunch(C);o.openBy(b)}}},this),jQuery.proxy(function(E){sap.m.MessageToast.show(sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('ERROR'))},this),true)}}});
